"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/uploadthing";
exports.ids = ["vendor-chunks/uploadthing"];
exports.modules = {

/***/ "(ssr)/./node_modules/uploadthing/client/index.js":
/*!**************************************************!*\
  !*** ./node_modules/uploadthing/client/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UploadAbortedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError),\n/* harmony export */   genUploader: () => (/* binding */ genUploader),\n/* harmony export */   generateClientDropzoneAccept: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateClientDropzoneAccept),\n/* harmony export */   generateMimeTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateMimeTypes),\n/* harmony export */   generatePermittedFileTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generatePermittedFileTypes),\n/* harmony export */   isValidFileSize: () => (/* binding */ isValidFileSize),\n/* harmony export */   isValidFileType: () => (/* binding */ isValidFileType),\n/* harmony export */   version: () => (/* binding */ version)\n/* harmony export */ });\n/* harmony import */ var effect_Array__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! effect/Array */ \"(ssr)/./node_modules/effect/dist/esm/Array.js\");\n/* harmony import */ var effect_Function__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/Function */ \"(ssr)/./node_modules/effect/dist/esm/Function.js\");\n/* harmony import */ var effect_Micro__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Micro */ \"(ssr)/./node_modules/effect/dist/esm/Micro.js\");\n/* harmony import */ var effect_Option__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! effect/Option */ \"(ssr)/./node_modules/effect/dist/esm/Option.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uploadthing/shared */ \"(ssr)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var std_env__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! std-env */ \"(ssr)/./node_modules/std-env/dist/index.mjs\");\n\n\n\n\n\n\n\n\nvar version$1 = \"6.13.3\";\n\nconst uploadMultipartWithProgress = (file, presigned, opts)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.gen(function*() {\n        let uploadedBytes = 0;\n        const etags = yield* effect_Micro__WEBPACK_IMPORTED_MODULE_1__.forEach(presigned.urls, (url, index)=>{\n            const offset = presigned.chunkSize * index;\n            const end = Math.min(offset + presigned.chunkSize, file.size);\n            const chunk = file.slice(offset, end);\n            return uploadPart({\n                url,\n                chunk: chunk,\n                contentDisposition: presigned.contentDisposition,\n                fileType: file.type,\n                fileName: file.name,\n                onProgress: (delta)=>{\n                    uploadedBytes += delta;\n                    const percent = uploadedBytes / file.size * 100;\n                    opts.onUploadProgress?.({\n                        file: file.name,\n                        progress: percent\n                    });\n                }\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((tag)=>({\n                    tag,\n                    partNumber: index + 1\n                })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.retry({\n                while: (error)=>error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError,\n                times: std_env__WEBPACK_IMPORTED_MODULE_2__.isTest ? 3 : 10,\n                schedule: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.exponentialDelay)()\n            }));\n        }, {\n            concurrency: \"inherit\"\n        }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tapError((error)=>opts.reportEventToUT(\"failure\", {\n                fileKey: presigned.key,\n                uploadId: presigned.uploadId,\n                fileName: file.name,\n                storageProviderError: String(error)\n            })));\n        // Tell the server that the upload is complete\n        yield* opts.reportEventToUT(\"multipart-complete\", {\n            uploadId: presigned.uploadId,\n            fileKey: presigned.key,\n            etags\n        });\n    });\nconst uploadPart = (opts)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.async((resume)=>{\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"PUT\", opts.url, true);\n        xhr.setRequestHeader(\"Content-Type\", opts.fileType);\n        xhr.setRequestHeader(\"Content-Disposition\", (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.contentDisposition)(opts.contentDisposition, opts.fileName));\n        xhr.addEventListener(\"load\", ()=>{\n            const etag = xhr.getResponseHeader(\"Etag\");\n            if (xhr.status >= 200 && xhr.status <= 299 && etag) {\n                return resume(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.succeed(etag));\n            }\n            return resume(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError()));\n        });\n        xhr.addEventListener(\"error\", ()=>resume(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError())));\n        let lastProgress = 0;\n        xhr.upload.addEventListener(\"progress\", (e)=>{\n            const delta = e.loaded - lastProgress;\n            lastProgress += delta;\n            opts.onProgress(delta);\n        });\n        xhr.send(opts.chunk);\n        // Cleanup function that runs on interruption\n        return effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>xhr.abort());\n    });\n\nconst uploadPresignedPostWithProgress = (file, presigned, opts)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.async((resume)=>{\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", presigned.url);\n        xhr.setRequestHeader(\"Accept\", \"application/xml\");\n        xhr.upload.addEventListener(\"progress\", ({ loaded, total })=>{\n            opts.onUploadProgress?.({\n                file: file.name,\n                progress: loaded / total * 100\n            });\n        });\n        xhr.addEventListener(\"load\", ()=>resume(xhr.status >= 200 && xhr.status < 300 ? effect_Micro__WEBPACK_IMPORTED_MODULE_1__.succeed(null) : opts.reportEventToUT(\"failure\", {\n                fileKey: presigned.key,\n                uploadId: null,\n                fileName: file.name,\n                storageProviderError: xhr.responseText\n            })));\n        xhr.addEventListener(\"error\", ()=>resume(opts.reportEventToUT(\"failure\", {\n                fileKey: presigned.key,\n                uploadId: null,\n                fileName: file.name\n            })));\n        const formData = new FormData();\n        Object.entries(presigned.fields).forEach(([k, v])=>formData.append(k, v));\n        formData.append(\"file\", file); // File data **MUST GO LAST**\n        xhr.send(formData);\n        return effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>{\n            xhr.abort();\n        });\n    });\n\nconst maybeParseResponseXML = (maybeXml)=>{\n    const codeMatch = maybeXml.match(/<Code>(.*?)<\\/Code>/s);\n    const messageMatch = maybeXml.match(/<Message>(.*?)<\\/Message>/s);\n    const code = codeMatch?.[1];\n    const message = messageMatch?.[1];\n    if (!code || !message) return null;\n    return {\n        code: s3CodeToUploadThingCode[code] ?? DEFAULT_ERROR_CODE,\n        message\n    };\n};\n/**\n * Map S3 error codes to UploadThing error codes\n *\n * This is a subset of the S3 error codes, based on what seemed most likely to\n * occur in uploadthing. For a full list of S3 error codes, see:\n * https://docs.aws.amazon.com/AmazonS3/latest/API/ErrorResponses.html\n */ const DEFAULT_ERROR_CODE = \"UPLOAD_FAILED\";\nconst s3CodeToUploadThingCode = {\n    AccessDenied: \"FORBIDDEN\",\n    EntityTooSmall: \"TOO_SMALL\",\n    EntityTooLarge: \"TOO_LARGE\",\n    ExpiredToken: \"FORBIDDEN\",\n    IncorrectNumberOfFilesInPostRequest: \"TOO_MANY_FILES\",\n    InternalError: \"INTERNAL_SERVER_ERROR\",\n    KeyTooLongError: \"KEY_TOO_LONG\",\n    MaxMessageLengthExceeded: \"TOO_LARGE\"\n};\n\nconst createAPIRequestUrl = (config)=>{\n    const url = new URL(config.url);\n    const queryParams = new URLSearchParams(url.search);\n    queryParams.set(\"actionType\", config.actionType);\n    queryParams.set(\"slug\", config.slug);\n    url.search = queryParams.toString();\n    return url;\n};\n/**\n * Creates a \"client\" for reporting events to the UploadThing server via the user's API endpoint.\n * Events are handled in \"./handler.ts starting at L112\"\n */ const createUTReporter = (cfg)=>(type, payload)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.gen(function*() {\n            const url = createAPIRequestUrl({\n                url: cfg.url,\n                slug: cfg.endpoint,\n                actionType: type\n            });\n            let headers = typeof cfg.headers === \"function\" ? cfg.headers() : cfg.headers;\n            if (headers instanceof Promise) {\n                headers = yield* effect_Micro__WEBPACK_IMPORTED_MODULE_1__.promise(()=>headers);\n            }\n            const response = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url, {\n                method: \"POST\",\n                body: JSON.stringify(payload),\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"x-uploadthing-package\": cfg.package,\n                    \"x-uploadthing-version\": version$1,\n                    ...headers\n                }\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), /**\n         * We don't _need_ to validate the response here, just cast it for now.\n         * As of now, @effect/schema includes quite a few bytes we cut out by this...\n         * We have \"strong typing\" on the backend that ensures the shape should match.\n         */ effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_3__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"FetchError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: `Failed to report event \"${type}\" to UploadThing server`,\n                    cause: e\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"BadRequestError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getErrorTypeFromStatusCode)(e.status),\n                    message: e.getMessage(),\n                    cause: e.json\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"InvalidJson\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: \"Failed to parse response from UploadThing server\",\n                    cause: e\n                }))));\n            switch(type){\n                case \"failure\":\n                    {\n                        // why isn't this narrowed automatically?\n                        const p = payload;\n                        const parsed = maybeParseResponseXML(p.storageProviderError ?? \"\");\n                        if (parsed?.message) {\n                            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                                code: parsed.code,\n                                message: parsed.message\n                            });\n                        } else {\n                            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                                code: \"UPLOAD_FAILED\",\n                                message: `Failed to upload file ${p.fileName} to S3`,\n                                cause: p.storageProviderError\n                            });\n                        }\n                    }\n            }\n            return response;\n        });\n\nconst version = version$1;\n/**\n * Validate that a file is of a valid type given a route config\n * @public\n */ const isValidFileType = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((type)=>file.type.includes(type)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Validate that a file is of a valid size given a route config\n * @public\n */ const isValidFileSize = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((type)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fileSizeToBytes)(routeConfig[type].maxFileSize)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((maxFileSize)=>file.size <= maxFileSize), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Generate a typed uploader for a given FileRouter\n * @public\n */ const genUploader = (initOpts)=>{\n    return (endpoint, opts)=>uploadFilesInternal(endpoint, {\n            ...opts,\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            package: initOpts.package,\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            input: opts.input\n        }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, {\n            fetch: globalThis.fetch.bind(globalThis),\n            baseHeaders: {\n                \"x-uploadthing-version\": version$1,\n                \"x-uploadthing-api-key\": undefined,\n                \"x-uploadthing-fe-package\": initOpts.package,\n                \"x-uploadthing-be-adapter\": undefined\n            }\n        }), (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(e, opts.signal ? {\n                signal: opts.signal\n            } : {})).then((exit)=>{\n            if (exit._tag === \"Right\") {\n                return exit.right;\n            } else if (exit.left._tag === \"Interrupt\") {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n            }\n            throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(exit.left);\n        });\n};\nconst uploadFilesInternal = (endpoint, opts)=>{\n    // classic service right here\n    const reportEventToUT = createUTReporter({\n        endpoint: String(endpoint),\n        package: opts.package,\n        url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(opts.url),\n        headers: opts.headers\n    });\n    return reportEventToUT(\"upload\", {\n        input: \"input\" in opts ? opts.input : null,\n        files: opts.files.map((f)=>({\n                name: f.name,\n                size: f.size,\n                type: f.type\n            }))\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((responses)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.forEach(responses, (presigned)=>uploadFile(String(endpoint), {\n                ...opts,\n                reportEventToUT\n            }, presigned).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.onInterrupt(reportEventToUT(\"failure\", {\n                fileKey: presigned.key,\n                uploadId: \"uploadId\" in presigned ? presigned.uploadId : null,\n                fileName: presigned.fileName\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.ignore))), {\n            concurrency: 6\n        })));\n};\nconst isPollingResponse = (input)=>{\n    if (!(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.isObject)(input)) return false;\n    if (input.status === \"done\") return \"callbackData\" in input;\n    return input.status === \"still waiting\";\n};\nconst isPollingDone = (input)=>{\n    return input.status === \"done\";\n};\nconst uploadFile = (slug, opts, presigned)=>effect_Array__WEBPACK_IMPORTED_MODULE_4__.findFirst(opts.files, (file)=>file.name === presigned.fileName).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fromOption, effect_Micro__WEBPACK_IMPORTED_MODULE_1__.mapError(()=>{\n        // eslint-disable-next-line no-console\n        console.error(\"No file found for presigned URL\", presigned);\n        return new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"NOT_FOUND\",\n            message: \"No file found for presigned URL\",\n            cause: `Expected file with name ${presigned.fileName} but got '${opts.files.join(\",\")}'`\n        });\n    }), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tap((file)=>opts.onUploadBegin?.({\n            file: file.name\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tap((file)=>\"urls\" in presigned ? uploadMultipartWithProgress(file, presigned, opts) : uploadPresignedPostWithProgress(file, presigned, opts)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.zip((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(presigned.pollingUrl, {\n        headers: {\n            authorization: presigned.pollingJwt\n        }\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"BadRequestError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getErrorTypeFromStatusCode)(e.status),\n            message: e.message,\n            cause: e\n        }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.filterOrFailCause(isPollingResponse, (_)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeDie(\"received a non PollingResponse from the polling endpoint\")), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.filterOrFail(isPollingDone, ()=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError()), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(({ callbackData })=>callbackData), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.retry({\n        while: (res)=>res._tag === \"RetryError\",\n        schedule: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.exponentialDelay)()\n    }), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.when(()=>!opts.skipPolling), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Option__WEBPACK_IMPORTED_MODULE_5__.getOrNull), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_3__.unsafeCoerce))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(([file, serverData])=>({\n            name: file.name,\n            size: file.size,\n            key: presigned.key,\n            serverData,\n            url: presigned.fileUrl,\n            appUrl: presigned.appUrl,\n            customId: presigned.customId,\n            type: file.type\n        })));\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQW9DO0FBQ1c7QUFDVDtBQUNFO0FBQzRPO0FBQzlJO0FBQ3JHOztBQUVqQzs7QUFFQSw2REFBNkQsNkNBQVM7QUFDdEU7QUFDQSw2QkFBNkIsaURBQWE7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYSxPQUFPLDZDQUFTO0FBQzdCO0FBQ0E7QUFDQSxpQkFBaUIsSUFBSSwrQ0FBVztBQUNoQyxpREFBaUQsMkRBQVU7QUFDM0QsdUJBQXVCLDJDQUFNO0FBQzdCLDBCQUEwQixxRUFBZ0I7QUFDMUMsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBLFNBQVMsT0FBTyxrREFBYztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTCwyQkFBMkIsK0NBQVc7QUFDdEM7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELHVFQUFrQjtBQUN0RTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsaURBQWE7QUFDM0M7QUFDQSwwQkFBMEIsOENBQVUsS0FBSywyREFBVTtBQUNuRCxTQUFTO0FBQ1QsaURBQWlELDhDQUFVLEtBQUssMkRBQVU7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsZUFBZSw4Q0FBVTtBQUN6QixLQUFLOztBQUVMLGlFQUFpRSwrQ0FBVztBQUM1RTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsZUFBZTtBQUNsRTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULHdGQUF3RixpREFBYTtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNB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QVMsSUFBSSw2Q0FBUyw2SUFBNkksNkNBQVMsQ0FBQyw2REFBUTtBQUNyTDtBQUNBO0FBQ0E7QUFDQSxLQUFLLE9BQU8saURBQWEsQ0FBQyxrRUFBaUIsR0FBRyxrREFBYyx5QkFBeUIsOENBQVUsS0FBSyxpRUFBZ0I7QUFDcEgsa0JBQWtCLCtFQUEwQjtBQUM1QztBQUNBO0FBQ0EsU0FBUyxLQUFLLDJEQUF1Qix5QkFBeUIsa0RBQWMsK0RBQStELHNEQUFrQix3QkFBd0IsMkRBQVUsS0FBSyw2Q0FBUyxJQUFJLGNBQWMsa0JBQWtCLCtDQUFXO0FBQzVQO0FBQ0Esa0JBQWtCLHFFQUFnQjtBQUNsQyxLQUFLLEdBQUcsOENBQVUseUJBQXlCLDZDQUFTLENBQUMsb0RBQWdCLEdBQUcsNkNBQVMsQ0FBQyx5REFBWSxLQUFLLDZDQUFTO0FBQzVHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUV5RCIsInNvdXJjZXMiOlsid2VicGFjazovL2Nhc2Vjb2JyYS1kZXYvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzPzk2MzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQXJyIGZyb20gJ2VmZmVjdC9BcnJheSc7XG5pbXBvcnQgeyB1bnNhZmVDb2VyY2UgfSBmcm9tICdlZmZlY3QvRnVuY3Rpb24nO1xuaW1wb3J0ICogYXMgTWljcm8gZnJvbSAnZWZmZWN0L01pY3JvJztcbmltcG9ydCAqIGFzIE9wdGlvbiBmcm9tICdlZmZlY3QvT3B0aW9uJztcbmltcG9ydCB7IFJldHJ5RXJyb3IsIGV4cG9uZW50aWFsRGVsYXksIGNvbnRlbnREaXNwb3NpdGlvbiwgZmV0Y2hFZmYsIHBhcnNlUmVzcG9uc2VKc29uLCBVcGxvYWRUaGluZ0Vycm9yLCBnZXRFcnJvclR5cGVGcm9tU3RhdHVzQ29kZSwgZ2V0VHlwZUZyb21GaWxlTmFtZSwgb2JqZWN0S2V5cywgZmlsZVNpemVUb0J5dGVzLCByZXNvbHZlTWF5YmVVcmxBcmcsIEZldGNoQ29udGV4dCwgVXBsb2FkQWJvcnRlZEVycm9yLCBpc09iamVjdCB9IGZyb20gJ0B1cGxvYWR0aGluZy9zaGFyZWQnO1xuZXhwb3J0IHsgVXBsb2FkQWJvcnRlZEVycm9yLCBnZW5lcmF0ZUNsaWVudERyb3B6b25lQWNjZXB0LCBnZW5lcmF0ZU1pbWVUeXBlcywgZ2VuZXJhdGVQZXJtaXR0ZWRGaWxlVHlwZXMgfSBmcm9tICdAdXBsb2FkdGhpbmcvc2hhcmVkJztcbmltcG9ydCB7IGlzVGVzdCB9IGZyb20gJ3N0ZC1lbnYnO1xuXG52YXIgdmVyc2lvbiQxID0gXCI2LjEzLjNcIjtcblxuY29uc3QgdXBsb2FkTXVsdGlwYXJ0V2l0aFByb2dyZXNzID0gKGZpbGUsIHByZXNpZ25lZCwgb3B0cyk9Pk1pY3JvLmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGxldCB1cGxvYWRlZEJ5dGVzID0gMDtcbiAgICAgICAgY29uc3QgZXRhZ3MgPSB5aWVsZCogTWljcm8uZm9yRWFjaChwcmVzaWduZWQudXJscywgKHVybCwgaW5kZXgpPT57XG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBwcmVzaWduZWQuY2h1bmtTaXplICogaW5kZXg7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihvZmZzZXQgKyBwcmVzaWduZWQuY2h1bmtTaXplLCBmaWxlLnNpemUpO1xuICAgICAgICAgICAgY29uc3QgY2h1bmsgPSBmaWxlLnNsaWNlKG9mZnNldCwgZW5kKTtcbiAgICAgICAgICAgIHJldHVybiB1cGxvYWRQYXJ0KHtcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgY2h1bms6IGNodW5rLFxuICAgICAgICAgICAgICAgIGNvbnRlbnREaXNwb3NpdGlvbjogcHJlc2lnbmVkLmNvbnRlbnREaXNwb3NpdGlvbixcbiAgICAgICAgICAgICAgICBmaWxlVHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgb25Qcm9ncmVzczogKGRlbHRhKT0+e1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZEJ5dGVzICs9IGRlbHRhO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gdXBsb2FkZWRCeXRlcyAvIGZpbGUuc2l6ZSAqIDEwMDtcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IHBlcmNlbnRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkucGlwZShNaWNyby5tYXAoKHRhZyk9Pih7XG4gICAgICAgICAgICAgICAgICAgIHRhZyxcbiAgICAgICAgICAgICAgICAgICAgcGFydE51bWJlcjogaW5kZXggKyAxXG4gICAgICAgICAgICAgICAgfSkpLCBNaWNyby5yZXRyeSh7XG4gICAgICAgICAgICAgICAgd2hpbGU6IChlcnJvcik9PmVycm9yIGluc3RhbmNlb2YgUmV0cnlFcnJvcixcbiAgICAgICAgICAgICAgICB0aW1lczogaXNUZXN0ID8gMyA6IDEwLFxuICAgICAgICAgICAgICAgIHNjaGVkdWxlOiBleHBvbmVudGlhbERlbGF5KClcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IFwiaW5oZXJpdFwiXG4gICAgICAgIH0pLnBpcGUoTWljcm8udGFwRXJyb3IoKGVycm9yKT0+b3B0cy5yZXBvcnRFdmVudFRvVVQoXCJmYWlsdXJlXCIsIHtcbiAgICAgICAgICAgICAgICBmaWxlS2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgICAgIHVwbG9hZElkOiBwcmVzaWduZWQudXBsb2FkSWQsXG4gICAgICAgICAgICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICBzdG9yYWdlUHJvdmlkZXJFcnJvcjogU3RyaW5nKGVycm9yKVxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgLy8gVGVsbCB0aGUgc2VydmVyIHRoYXQgdGhlIHVwbG9hZCBpcyBjb21wbGV0ZVxuICAgICAgICB5aWVsZCogb3B0cy5yZXBvcnRFdmVudFRvVVQoXCJtdWx0aXBhcnQtY29tcGxldGVcIiwge1xuICAgICAgICAgICAgdXBsb2FkSWQ6IHByZXNpZ25lZC51cGxvYWRJZCxcbiAgICAgICAgICAgIGZpbGVLZXk6IHByZXNpZ25lZC5rZXksXG4gICAgICAgICAgICBldGFnc1xuICAgICAgICB9KTtcbiAgICB9KTtcbmNvbnN0IHVwbG9hZFBhcnQgPSAob3B0cyk9Pk1pY3JvLmFzeW5jKChyZXN1bWUpPT57XG4gICAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICB4aHIub3BlbihcIlBVVFwiLCBvcHRzLnVybCwgdHJ1ZSk7XG4gICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIG9wdHMuZmlsZVR5cGUpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtRGlzcG9zaXRpb25cIiwgY29udGVudERpc3Bvc2l0aW9uKG9wdHMuY29udGVudERpc3Bvc2l0aW9uLCBvcHRzLmZpbGVOYW1lKSk7XG4gICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKT0+e1xuICAgICAgICAgICAgY29uc3QgZXRhZyA9IHhoci5nZXRSZXNwb25zZUhlYWRlcihcIkV0YWdcIik7XG4gICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8PSAyOTkgJiYgZXRhZykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bWUoTWljcm8uc3VjY2VlZChldGFnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdW1lKE1pY3JvLmZhaWwobmV3IFJldHJ5RXJyb3IoKSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCAoKT0+cmVzdW1lKE1pY3JvLmZhaWwobmV3IFJldHJ5RXJyb3IoKSkpKTtcbiAgICAgICAgbGV0IGxhc3RQcm9ncmVzcyA9IDA7XG4gICAgICAgIHhoci51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsIChlKT0+e1xuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBlLmxvYWRlZCAtIGxhc3RQcm9ncmVzcztcbiAgICAgICAgICAgIGxhc3RQcm9ncmVzcyArPSBkZWx0YTtcbiAgICAgICAgICAgIG9wdHMub25Qcm9ncmVzcyhkZWx0YSk7XG4gICAgICAgIH0pO1xuICAgICAgICB4aHIuc2VuZChvcHRzLmNodW5rKTtcbiAgICAgICAgLy8gQ2xlYW51cCBmdW5jdGlvbiB0aGF0IHJ1bnMgb24gaW50ZXJydXB0aW9uXG4gICAgICAgIHJldHVybiBNaWNyby5zeW5jKCgpPT54aHIuYWJvcnQoKSk7XG4gICAgfSk7XG5cbmNvbnN0IHVwbG9hZFByZXNpZ25lZFBvc3RXaXRoUHJvZ3Jlc3MgPSAoZmlsZSwgcHJlc2lnbmVkLCBvcHRzKT0+TWljcm8uYXN5bmMoKHJlc3VtZSk9PntcbiAgICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci5vcGVuKFwiUE9TVFwiLCBwcmVzaWduZWQudXJsKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJBY2NlcHRcIiwgXCJhcHBsaWNhdGlvbi94bWxcIik7XG4gICAgICAgIHhoci51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsICh7IGxvYWRlZCwgdG90YWwgfSk9PntcbiAgICAgICAgICAgIG9wdHMub25VcGxvYWRQcm9ncmVzcz8uKHtcbiAgICAgICAgICAgICAgICBmaWxlOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IGxvYWRlZCAvIHRvdGFsICogMTAwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKT0+cmVzdW1lKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDAgPyBNaWNyby5zdWNjZWVkKG51bGwpIDogb3B0cy5yZXBvcnRFdmVudFRvVVQoXCJmYWlsdXJlXCIsIHtcbiAgICAgICAgICAgICAgICBmaWxlS2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgICAgIHVwbG9hZElkOiBudWxsLFxuICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgc3RvcmFnZVByb3ZpZGVyRXJyb3I6IHhoci5yZXNwb25zZVRleHRcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgKCk9PnJlc3VtZShvcHRzLnJlcG9ydEV2ZW50VG9VVChcImZhaWx1cmVcIiwge1xuICAgICAgICAgICAgICAgIGZpbGVLZXk6IHByZXNpZ25lZC5rZXksXG4gICAgICAgICAgICAgICAgdXBsb2FkSWQ6IG51bGwsXG4gICAgICAgICAgICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZVxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgT2JqZWN0LmVudHJpZXMocHJlc2lnbmVkLmZpZWxkcykuZm9yRWFjaCgoW2ssIHZdKT0+Zm9ybURhdGEuYXBwZW5kKGssIHYpKTtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZmlsZVwiLCBmaWxlKTsgLy8gRmlsZSBkYXRhICoqTVVTVCBHTyBMQVNUKipcbiAgICAgICAgeGhyLnNlbmQoZm9ybURhdGEpO1xuICAgICAgICByZXR1cm4gTWljcm8uc3luYygoKT0+e1xuICAgICAgICAgICAgeGhyLmFib3J0KCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG5jb25zdCBtYXliZVBhcnNlUmVzcG9uc2VYTUwgPSAobWF5YmVYbWwpPT57XG4gICAgY29uc3QgY29kZU1hdGNoID0gbWF5YmVYbWwubWF0Y2goLzxDb2RlPiguKj8pPFxcL0NvZGU+L3MpO1xuICAgIGNvbnN0IG1lc3NhZ2VNYXRjaCA9IG1heWJlWG1sLm1hdGNoKC88TWVzc2FnZT4oLio/KTxcXC9NZXNzYWdlPi9zKTtcbiAgICBjb25zdCBjb2RlID0gY29kZU1hdGNoPy5bMV07XG4gICAgY29uc3QgbWVzc2FnZSA9IG1lc3NhZ2VNYXRjaD8uWzFdO1xuICAgIGlmICghY29kZSB8fCAhbWVzc2FnZSkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29kZTogczNDb2RlVG9VcGxvYWRUaGluZ0NvZGVbY29kZV0gPz8gREVGQVVMVF9FUlJPUl9DT0RFLFxuICAgICAgICBtZXNzYWdlXG4gICAgfTtcbn07XG4vKipcbiAqIE1hcCBTMyBlcnJvciBjb2RlcyB0byBVcGxvYWRUaGluZyBlcnJvciBjb2Rlc1xuICpcbiAqIFRoaXMgaXMgYSBzdWJzZXQgb2YgdGhlIFMzIGVycm9yIGNvZGVzLCBiYXNlZCBvbiB3aGF0IHNlZW1lZCBtb3N0IGxpa2VseSB0b1xuICogb2NjdXIgaW4gdXBsb2FkdGhpbmcuIEZvciBhIGZ1bGwgbGlzdCBvZiBTMyBlcnJvciBjb2Rlcywgc2VlOlxuICogaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FtYXpvblMzL2xhdGVzdC9BUEkvRXJyb3JSZXNwb25zZXMuaHRtbFxuICovIGNvbnN0IERFRkFVTFRfRVJST1JfQ09ERSA9IFwiVVBMT0FEX0ZBSUxFRFwiO1xuY29uc3QgczNDb2RlVG9VcGxvYWRUaGluZ0NvZGUgPSB7XG4gICAgQWNjZXNzRGVuaWVkOiBcIkZPUkJJRERFTlwiLFxuICAgIEVudGl0eVRvb1NtYWxsOiBcIlRPT19TTUFMTFwiLFxuICAgIEVudGl0eVRvb0xhcmdlOiBcIlRPT19MQVJHRVwiLFxuICAgIEV4cGlyZWRUb2tlbjogXCJGT1JCSURERU5cIixcbiAgICBJbmNvcnJlY3ROdW1iZXJPZkZpbGVzSW5Qb3N0UmVxdWVzdDogXCJUT09fTUFOWV9GSUxFU1wiLFxuICAgIEludGVybmFsRXJyb3I6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgS2V5VG9vTG9uZ0Vycm9yOiBcIktFWV9UT09fTE9OR1wiLFxuICAgIE1heE1lc3NhZ2VMZW5ndGhFeGNlZWRlZDogXCJUT09fTEFSR0VcIlxufTtcblxuY29uc3QgY3JlYXRlQVBJUmVxdWVzdFVybCA9IChjb25maWcpPT57XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChjb25maWcudXJsKTtcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXModXJsLnNlYXJjaCk7XG4gICAgcXVlcnlQYXJhbXMuc2V0KFwiYWN0aW9uVHlwZVwiLCBjb25maWcuYWN0aW9uVHlwZSk7XG4gICAgcXVlcnlQYXJhbXMuc2V0KFwic2x1Z1wiLCBjb25maWcuc2x1Zyk7XG4gICAgdXJsLnNlYXJjaCA9IHF1ZXJ5UGFyYW1zLnRvU3RyaW5nKCk7XG4gICAgcmV0dXJuIHVybDtcbn07XG4vKipcbiAqIENyZWF0ZXMgYSBcImNsaWVudFwiIGZvciByZXBvcnRpbmcgZXZlbnRzIHRvIHRoZSBVcGxvYWRUaGluZyBzZXJ2ZXIgdmlhIHRoZSB1c2VyJ3MgQVBJIGVuZHBvaW50LlxuICogRXZlbnRzIGFyZSBoYW5kbGVkIGluIFwiLi9oYW5kbGVyLnRzIHN0YXJ0aW5nIGF0IEwxMTJcIlxuICovIGNvbnN0IGNyZWF0ZVVUUmVwb3J0ZXIgPSAoY2ZnKT0+KHR5cGUsIHBheWxvYWQpPT5NaWNyby5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gY3JlYXRlQVBJUmVxdWVzdFVybCh7XG4gICAgICAgICAgICAgICAgdXJsOiBjZmcudXJsLFxuICAgICAgICAgICAgICAgIHNsdWc6IGNmZy5lbmRwb2ludCxcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiB0eXBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBoZWFkZXJzID0gdHlwZW9mIGNmZy5oZWFkZXJzID09PSBcImZ1bmN0aW9uXCIgPyBjZmcuaGVhZGVycygpIDogY2ZnLmhlYWRlcnM7XG4gICAgICAgICAgICBpZiAoaGVhZGVycyBpbnN0YW5jZW9mIFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzID0geWllbGQqIE1pY3JvLnByb21pc2UoKCk9PmhlYWRlcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCogZmV0Y2hFZmYodXJsLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctcGFja2FnZVwiOiBjZmcucGFja2FnZSxcbiAgICAgICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogdmVyc2lvbiQxLFxuICAgICAgICAgICAgICAgICAgICAuLi5oZWFkZXJzXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkucGlwZShNaWNyby5hbmRUaGVuKHBhcnNlUmVzcG9uc2VKc29uKSwgLyoqXG4gICAgICAgICAqIFdlIGRvbid0IF9uZWVkXyB0byB2YWxpZGF0ZSB0aGUgcmVzcG9uc2UgaGVyZSwganVzdCBjYXN0IGl0IGZvciBub3cuXG4gICAgICAgICAqIEFzIG9mIG5vdywgQGVmZmVjdC9zY2hlbWEgaW5jbHVkZXMgcXVpdGUgYSBmZXcgYnl0ZXMgd2UgY3V0IG91dCBieSB0aGlzLi4uXG4gICAgICAgICAqIFdlIGhhdmUgXCJzdHJvbmcgdHlwaW5nXCIgb24gdGhlIGJhY2tlbmQgdGhhdCBlbnN1cmVzIHRoZSBzaGFwZSBzaG91bGQgbWF0Y2guXG4gICAgICAgICAqLyBNaWNyby5tYXAodW5zYWZlQ29lcmNlKSwgTWljcm8uY2F0Y2hUYWcoXCJGZXRjaEVycm9yXCIsIChlKT0+TWljcm8uZmFpbChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfQ0xJRU5UX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gcmVwb3J0IGV2ZW50IFwiJHt0eXBlfVwiIHRvIFVwbG9hZFRoaW5nIHNlcnZlcmAsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlXG4gICAgICAgICAgICAgICAgfSkpKSwgTWljcm8uY2F0Y2hUYWcoXCJCYWRSZXF1ZXN0RXJyb3JcIiwgKGUpPT5NaWNyby5mYWlsKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogZ2V0RXJyb3JUeXBlRnJvbVN0YXR1c0NvZGUoZS5zdGF0dXMpLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlLmdldE1lc3NhZ2UoKSxcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGUuanNvblxuICAgICAgICAgICAgICAgIH0pKSksIE1pY3JvLmNhdGNoVGFnKFwiSW52YWxpZEpzb25cIiwgKGUpPT5NaWNyby5mYWlsKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9DTElFTlRfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcGFyc2UgcmVzcG9uc2UgZnJvbSBVcGxvYWRUaGluZyBzZXJ2ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgICAgIHN3aXRjaCh0eXBlKXtcbiAgICAgICAgICAgICAgICBjYXNlIFwiZmFpbHVyZVwiOlxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3aHkgaXNuJ3QgdGhpcyBuYXJyb3dlZCBhdXRvbWF0aWNhbGx5P1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHBheWxvYWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBtYXliZVBhcnNlUmVzcG9uc2VYTUwocC5zdG9yYWdlUHJvdmlkZXJFcnJvciA/PyBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZWQ/Lm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogcGFyc2VkLmNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHBhcnNlZC5tZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIlVQTE9BRF9GQUlMRURcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byB1cGxvYWQgZmlsZSAke3AuZmlsZU5hbWV9IHRvIFMzYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IHAuc3RvcmFnZVByb3ZpZGVyRXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9KTtcblxuY29uc3QgdmVyc2lvbiA9IHZlcnNpb24kMTtcbi8qKlxuICogVmFsaWRhdGUgdGhhdCBhIGZpbGUgaXMgb2YgYSB2YWxpZCB0eXBlIGdpdmVuIGEgcm91dGUgY29uZmlnXG4gKiBAcHVibGljXG4gKi8gY29uc3QgaXNWYWxpZEZpbGVUeXBlID0gKGZpbGUsIHJvdXRlQ29uZmlnKT0+TWljcm8ucnVuU3luYyhnZXRUeXBlRnJvbUZpbGVOYW1lKGZpbGUubmFtZSwgb2JqZWN0S2V5cyhyb3V0ZUNvbmZpZykpLnBpcGUoTWljcm8ubWFwKCh0eXBlKT0+ZmlsZS50eXBlLmluY2x1ZGVzKHR5cGUpKSwgTWljcm8ub3JFbHNlU3VjY2VlZCgoKT0+ZmFsc2UpKSk7XG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYSBmaWxlIGlzIG9mIGEgdmFsaWQgc2l6ZSBnaXZlbiBhIHJvdXRlIGNvbmZpZ1xuICogQHB1YmxpY1xuICovIGNvbnN0IGlzVmFsaWRGaWxlU2l6ZSA9IChmaWxlLCByb3V0ZUNvbmZpZyk9Pk1pY3JvLnJ1blN5bmMoZ2V0VHlwZUZyb21GaWxlTmFtZShmaWxlLm5hbWUsIG9iamVjdEtleXMocm91dGVDb25maWcpKS5waXBlKE1pY3JvLmZsYXRNYXAoKHR5cGUpPT5maWxlU2l6ZVRvQnl0ZXMocm91dGVDb25maWdbdHlwZV0ubWF4RmlsZVNpemUpKSwgTWljcm8ubWFwKChtYXhGaWxlU2l6ZSk9PmZpbGUuc2l6ZSA8PSBtYXhGaWxlU2l6ZSksIE1pY3JvLm9yRWxzZVN1Y2NlZWQoKCk9PmZhbHNlKSkpO1xuLyoqXG4gKiBHZW5lcmF0ZSBhIHR5cGVkIHVwbG9hZGVyIGZvciBhIGdpdmVuIEZpbGVSb3V0ZXJcbiAqIEBwdWJsaWNcbiAqLyBjb25zdCBnZW5VcGxvYWRlciA9IChpbml0T3B0cyk9PntcbiAgICByZXR1cm4gKGVuZHBvaW50LCBvcHRzKT0+dXBsb2FkRmlsZXNJbnRlcm5hbChlbmRwb2ludCwge1xuICAgICAgICAgICAgLi4ub3B0cyxcbiAgICAgICAgICAgIHVybDogcmVzb2x2ZU1heWJlVXJsQXJnKGluaXRPcHRzPy51cmwpLFxuICAgICAgICAgICAgcGFja2FnZTogaW5pdE9wdHMucGFja2FnZSxcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLW1lbWJlci1hY2Nlc3NcbiAgICAgICAgICAgIGlucHV0OiBvcHRzLmlucHV0XG4gICAgICAgIH0pLnBpcGUoTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB7XG4gICAgICAgICAgICBmZXRjaDogZ2xvYmFsVGhpcy5mZXRjaC5iaW5kKGdsb2JhbFRoaXMpLFxuICAgICAgICAgICAgYmFzZUhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uJDEsXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWFwaS1rZXlcIjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1mZS1wYWNrYWdlXCI6IGluaXRPcHRzLnBhY2thZ2UsXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWJlLWFkYXB0ZXJcIjogdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCAoZSk9Pk1pY3JvLnJ1blByb21pc2VFeGl0KGUsIG9wdHMuc2lnbmFsID8ge1xuICAgICAgICAgICAgICAgIHNpZ25hbDogb3B0cy5zaWduYWxcbiAgICAgICAgICAgIH0gOiB7fSkpLnRoZW4oKGV4aXQpPT57XG4gICAgICAgICAgICBpZiAoZXhpdC5fdGFnID09PSBcIlJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXhpdC5yaWdodDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXhpdC5sZWZ0Ll90YWcgPT09IFwiSW50ZXJydXB0XCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkQWJvcnRlZEVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChleGl0LmxlZnQpO1xuICAgICAgICB9KTtcbn07XG5jb25zdCB1cGxvYWRGaWxlc0ludGVybmFsID0gKGVuZHBvaW50LCBvcHRzKT0+e1xuICAgIC8vIGNsYXNzaWMgc2VydmljZSByaWdodCBoZXJlXG4gICAgY29uc3QgcmVwb3J0RXZlbnRUb1VUID0gY3JlYXRlVVRSZXBvcnRlcih7XG4gICAgICAgIGVuZHBvaW50OiBTdHJpbmcoZW5kcG9pbnQpLFxuICAgICAgICBwYWNrYWdlOiBvcHRzLnBhY2thZ2UsXG4gICAgICAgIHVybDogcmVzb2x2ZU1heWJlVXJsQXJnKG9wdHMudXJsKSxcbiAgICAgICAgaGVhZGVyczogb3B0cy5oZWFkZXJzXG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcG9ydEV2ZW50VG9VVChcInVwbG9hZFwiLCB7XG4gICAgICAgIGlucHV0OiBcImlucHV0XCIgaW4gb3B0cyA/IG9wdHMuaW5wdXQgOiBudWxsLFxuICAgICAgICBmaWxlczogb3B0cy5maWxlcy5tYXAoKGYpPT4oe1xuICAgICAgICAgICAgICAgIG5hbWU6IGYubmFtZSxcbiAgICAgICAgICAgICAgICBzaXplOiBmLnNpemUsXG4gICAgICAgICAgICAgICAgdHlwZTogZi50eXBlXG4gICAgICAgICAgICB9KSlcbiAgICB9KS5waXBlKE1pY3JvLmZsYXRNYXAoKHJlc3BvbnNlcyk9Pk1pY3JvLmZvckVhY2gocmVzcG9uc2VzLCAocHJlc2lnbmVkKT0+dXBsb2FkRmlsZShTdHJpbmcoZW5kcG9pbnQpLCB7XG4gICAgICAgICAgICAgICAgLi4ub3B0cyxcbiAgICAgICAgICAgICAgICByZXBvcnRFdmVudFRvVVRcbiAgICAgICAgICAgIH0sIHByZXNpZ25lZCkucGlwZShNaWNyby5vbkludGVycnVwdChyZXBvcnRFdmVudFRvVVQoXCJmYWlsdXJlXCIsIHtcbiAgICAgICAgICAgICAgICBmaWxlS2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgICAgIHVwbG9hZElkOiBcInVwbG9hZElkXCIgaW4gcHJlc2lnbmVkID8gcHJlc2lnbmVkLnVwbG9hZElkIDogbnVsbCxcbiAgICAgICAgICAgICAgICBmaWxlTmFtZTogcHJlc2lnbmVkLmZpbGVOYW1lXG4gICAgICAgICAgICB9KS5waXBlKE1pY3JvLmlnbm9yZSkpKSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IDZcbiAgICAgICAgfSkpKTtcbn07XG5jb25zdCBpc1BvbGxpbmdSZXNwb25zZSA9IChpbnB1dCk9PntcbiAgICBpZiAoIWlzT2JqZWN0KGlucHV0KSkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChpbnB1dC5zdGF0dXMgPT09IFwiZG9uZVwiKSByZXR1cm4gXCJjYWxsYmFja0RhdGFcIiBpbiBpbnB1dDtcbiAgICByZXR1cm4gaW5wdXQuc3RhdHVzID09PSBcInN0aWxsIHdhaXRpbmdcIjtcbn07XG5jb25zdCBpc1BvbGxpbmdEb25lID0gKGlucHV0KT0+e1xuICAgIHJldHVybiBpbnB1dC5zdGF0dXMgPT09IFwiZG9uZVwiO1xufTtcbmNvbnN0IHVwbG9hZEZpbGUgPSAoc2x1Zywgb3B0cywgcHJlc2lnbmVkKT0+QXJyLmZpbmRGaXJzdChvcHRzLmZpbGVzLCAoZmlsZSk9PmZpbGUubmFtZSA9PT0gcHJlc2lnbmVkLmZpbGVOYW1lKS5waXBlKE1pY3JvLmZyb21PcHRpb24sIE1pY3JvLm1hcEVycm9yKCgpPT57XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJObyBmaWxlIGZvdW5kIGZvciBwcmVzaWduZWQgVVJMXCIsIHByZXNpZ25lZCk7XG4gICAgICAgIHJldHVybiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJObyBmaWxlIGZvdW5kIGZvciBwcmVzaWduZWQgVVJMXCIsXG4gICAgICAgICAgICBjYXVzZTogYEV4cGVjdGVkIGZpbGUgd2l0aCBuYW1lICR7cHJlc2lnbmVkLmZpbGVOYW1lfSBidXQgZ290ICcke29wdHMuZmlsZXMuam9pbihcIixcIil9J2BcbiAgICAgICAgfSk7XG4gICAgfSksIE1pY3JvLnRhcCgoZmlsZSk9Pm9wdHMub25VcGxvYWRCZWdpbj8uKHtcbiAgICAgICAgICAgIGZpbGU6IGZpbGUubmFtZVxuICAgICAgICB9KSksIE1pY3JvLnRhcCgoZmlsZSk9PlwidXJsc1wiIGluIHByZXNpZ25lZCA/IHVwbG9hZE11bHRpcGFydFdpdGhQcm9ncmVzcyhmaWxlLCBwcmVzaWduZWQsIG9wdHMpIDogdXBsb2FkUHJlc2lnbmVkUG9zdFdpdGhQcm9ncmVzcyhmaWxlLCBwcmVzaWduZWQsIG9wdHMpKSwgTWljcm8uemlwKGZldGNoRWZmKHByZXNpZ25lZC5wb2xsaW5nVXJsLCB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IHByZXNpZ25lZC5wb2xsaW5nSnd0XG4gICAgICAgIH1cbiAgICB9KS5waXBlKE1pY3JvLmZsYXRNYXAocGFyc2VSZXNwb25zZUpzb24pLCBNaWNyby5jYXRjaFRhZyhcIkJhZFJlcXVlc3RFcnJvclwiLCAoZSk9Pk1pY3JvLmZhaWwobmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogZ2V0RXJyb3JUeXBlRnJvbVN0YXR1c0NvZGUoZS5zdGF0dXMpLFxuICAgICAgICAgICAgbWVzc2FnZTogZS5tZXNzYWdlLFxuICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgfSkpKSwgTWljcm8uZmlsdGVyT3JGYWlsQ2F1c2UoaXNQb2xsaW5nUmVzcG9uc2UsIChfKT0+TWljcm8uY2F1c2VEaWUoXCJyZWNlaXZlZCBhIG5vbiBQb2xsaW5nUmVzcG9uc2UgZnJvbSB0aGUgcG9sbGluZyBlbmRwb2ludFwiKSksIE1pY3JvLmZpbHRlck9yRmFpbChpc1BvbGxpbmdEb25lLCAoKT0+bmV3IFJldHJ5RXJyb3IoKSksIE1pY3JvLm1hcCgoeyBjYWxsYmFja0RhdGEgfSk9PmNhbGxiYWNrRGF0YSksIE1pY3JvLnJldHJ5KHtcbiAgICAgICAgd2hpbGU6IChyZXMpPT5yZXMuX3RhZyA9PT0gXCJSZXRyeUVycm9yXCIsXG4gICAgICAgIHNjaGVkdWxlOiBleHBvbmVudGlhbERlbGF5KClcbiAgICB9KSwgTWljcm8ud2hlbigoKT0+IW9wdHMuc2tpcFBvbGxpbmcpLCBNaWNyby5tYXAoT3B0aW9uLmdldE9yTnVsbCksIE1pY3JvLm1hcCh1bnNhZmVDb2VyY2UpKSksIE1pY3JvLm1hcCgoW2ZpbGUsIHNlcnZlckRhdGFdKT0+KHtcbiAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgIGtleTogcHJlc2lnbmVkLmtleSxcbiAgICAgICAgICAgIHNlcnZlckRhdGEsXG4gICAgICAgICAgICB1cmw6IHByZXNpZ25lZC5maWxlVXJsLFxuICAgICAgICAgICAgYXBwVXJsOiBwcmVzaWduZWQuYXBwVXJsLFxuICAgICAgICAgICAgY3VzdG9tSWQ6IHByZXNpZ25lZC5jdXN0b21JZCxcbiAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZVxuICAgICAgICB9KSkpO1xuXG5leHBvcnQgeyBnZW5VcGxvYWRlciwgaXNWYWxpZEZpbGVTaXplLCBpc1ZhbGlkRmlsZVR5cGUsIHZlcnNpb24gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/uploadthing/client/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/internal/types.js":
/*!****************************************************!*\
  !*** ./node_modules/uploadthing/internal/types.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* binding */ UTFiles),\n/* harmony export */   VALID_ACTION_TYPES: () => (/* binding */ VALID_ACTION_TYPES),\n/* harmony export */   VALID_UT_HOOKS: () => (/* binding */ VALID_UT_HOOKS),\n/* harmony export */   isActionType: () => (/* binding */ isActionType),\n/* harmony export */   isUploadThingHook: () => (/* binding */ isUploadThingHook)\n/* harmony export */ });\n/**\n * Marker used to append a `customId` to the incoming file data in `.middleware()`\n * @example\n * ```ts\n * .middleware((opts) => {\n *   return {\n *     [UTFiles]: opts.files.map((file) => ({\n *       ...file,\n *       customId: generateId(),\n *     }))\n *   };\n * })\n * ```\n */ const UTFiles = Symbol(\"uploadthing-custom-id-symbol\");\n/**\n * Valid options for the `?actionType` query param\n */ const VALID_ACTION_TYPES = [\n    \"upload\",\n    \"failure\",\n    \"multipart-complete\"\n];\nconst isActionType = (input)=>typeof input === \"string\" && VALID_ACTION_TYPES.includes(input);\n/**\n * Valid options for the `uploadthing-hook` header\n * for requests coming from UT server\n */ const VALID_UT_HOOKS = [\n    \"callback\"\n];\nconst isUploadThingHook = (input)=>typeof input === \"string\" && VALID_UT_HOOKS.includes(input);\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFd0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jYXNlY29icmEtZGV2Ly4vbm9kZV9tb2R1bGVzL3VwbG9hZHRoaW5nL2ludGVybmFsL3R5cGVzLmpzP2IxYjIiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNYXJrZXIgdXNlZCB0byBhcHBlbmQgYSBgY3VzdG9tSWRgIHRvIHRoZSBpbmNvbWluZyBmaWxlIGRhdGEgaW4gYC5taWRkbGV3YXJlKClgXG4gKiBAZXhhbXBsZVxuICogYGBgdHNcbiAqIC5taWRkbGV3YXJlKChvcHRzKSA9PiB7XG4gKiAgIHJldHVybiB7XG4gKiAgICAgW1VURmlsZXNdOiBvcHRzLmZpbGVzLm1hcCgoZmlsZSkgPT4gKHtcbiAqICAgICAgIC4uLmZpbGUsXG4gKiAgICAgICBjdXN0b21JZDogZ2VuZXJhdGVJZCgpLFxuICogICAgIH0pKVxuICogICB9O1xuICogfSlcbiAqIGBgYFxuICovIGNvbnN0IFVURmlsZXMgPSBTeW1ib2woXCJ1cGxvYWR0aGluZy1jdXN0b20taWQtc3ltYm9sXCIpO1xuLyoqXG4gKiBWYWxpZCBvcHRpb25zIGZvciB0aGUgYD9hY3Rpb25UeXBlYCBxdWVyeSBwYXJhbVxuICovIGNvbnN0IFZBTElEX0FDVElPTl9UWVBFUyA9IFtcbiAgICBcInVwbG9hZFwiLFxuICAgIFwiZmFpbHVyZVwiLFxuICAgIFwibXVsdGlwYXJ0LWNvbXBsZXRlXCJcbl07XG5jb25zdCBpc0FjdGlvblR5cGUgPSAoaW5wdXQpPT50eXBlb2YgaW5wdXQgPT09IFwic3RyaW5nXCIgJiYgVkFMSURfQUNUSU9OX1RZUEVTLmluY2x1ZGVzKGlucHV0KTtcbi8qKlxuICogVmFsaWQgb3B0aW9ucyBmb3IgdGhlIGB1cGxvYWR0aGluZy1ob29rYCBoZWFkZXJcbiAqIGZvciByZXF1ZXN0cyBjb21pbmcgZnJvbSBVVCBzZXJ2ZXJcbiAqLyBjb25zdCBWQUxJRF9VVF9IT09LUyA9IFtcbiAgICBcImNhbGxiYWNrXCJcbl07XG5jb25zdCBpc1VwbG9hZFRoaW5nSG9vayA9IChpbnB1dCk9PnR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIiAmJiBWQUxJRF9VVF9IT09LUy5pbmNsdWRlcyhpbnB1dCk7XG5cbmV4cG9ydCB7IFVURmlsZXMsIFZBTElEX0FDVElPTl9UWVBFUywgVkFMSURfVVRfSE9PS1MsIGlzQWN0aW9uVHlwZSwgaXNVcGxvYWRUaGluZ0hvb2sgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/internal/types.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/next/index.js":
/*!************************************************!*\
  !*** ./node_modules/uploadthing/next/index.js ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* reexport safe */ _internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles),\n/* harmony export */   createNextRouteHandler: () => (/* binding */ createNextRouteHandler),\n/* harmony export */   createRouteHandler: () => (/* binding */ createRouteHandler),\n/* harmony export */   createUploadthing: () => (/* binding */ createUploadthing)\n/* harmony export */ });\n/* harmony import */ var _server_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../server/index.js */ \"(rsc)/./node_modules/uploadthing/server/index.js\");\n/* harmony import */ var _internal_types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/types.js */ \"(rsc)/./node_modules/uploadthing/internal/types.js\");\n\n\n\nfunction defaultErrorFormatter(error) {\n    return {\n        message: error.message\n    };\n}\n\nfunction internalCreateBuilder(initDef = {}) {\n    const _def = {\n        // Default router config\n        routerConfig: {\n            image: {\n                maxFileSize: \"4MB\"\n            }\n        },\n        inputParser: {\n            parse: ()=>undefined,\n            _input: undefined,\n            _output: undefined\n        },\n        middleware: ()=>({}),\n        onUploadError: ()=>({}),\n        errorFormatter: initDef.errorFormatter ?? defaultErrorFormatter,\n        // Overload with properties passed in\n        ...initDef\n    };\n    return {\n        input (userParser) {\n            return internalCreateBuilder({\n                ..._def,\n                inputParser: userParser\n            });\n        },\n        middleware (userMiddleware) {\n            return internalCreateBuilder({\n                ..._def,\n                middleware: userMiddleware\n            });\n        },\n        onUploadComplete (userUploadComplete) {\n            return {\n                _def,\n                resolver: userUploadComplete\n            };\n        },\n        onUploadError (userOnUploadError) {\n            return internalCreateBuilder({\n                ..._def,\n                onUploadError: userOnUploadError\n            });\n        }\n    };\n}\nfunction createBuilder(opts) {\n    return (input)=>{\n        return internalCreateBuilder({\n            routerConfig: input,\n            ...opts\n        });\n    };\n}\n\nconst createUploadthing = (opts)=>createBuilder(opts);\nconst createRouteHandler = (opts)=>{\n    const handlers = (0,_server_index_js__WEBPACK_IMPORTED_MODULE_1__.INTERNAL_DO_NOT_USE_createRouteHandlerCore)(opts, \"nextjs-app\");\n    return {\n        POST: (req)=>handlers.POST(req),\n        GET: (req)=>handlers.GET(req)\n    };\n};\n/**\n * @deprecated Use {@link createRouteHandler} instead\n */ const createNextRouteHandler = createRouteHandler;\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvbmV4dC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBZ0Y7QUFDakM7O0FBRS9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCwyQkFBMkI7QUFDM0IsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxxQkFBcUIsNEZBQTBDO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUM7O0FBRXlFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FzZWNvYnJhLWRldi8uL25vZGVfbW9kdWxlcy91cGxvYWR0aGluZy9uZXh0L2luZGV4LmpzP2I2MDMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSU5URVJOQUxfRE9fTk9UX1VTRV9jcmVhdGVSb3V0ZUhhbmRsZXJDb3JlIH0gZnJvbSAnLi4vc2VydmVyL2luZGV4LmpzJztcbmV4cG9ydCB7IFVURmlsZXMgfSBmcm9tICcuLi9pbnRlcm5hbC90eXBlcy5qcyc7XG5cbmZ1bmN0aW9uIGRlZmF1bHRFcnJvckZvcm1hdHRlcihlcnJvcikge1xuICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2VcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoaW5pdERlZiA9IHt9KSB7XG4gICAgY29uc3QgX2RlZiA9IHtcbiAgICAgICAgLy8gRGVmYXVsdCByb3V0ZXIgY29uZmlnXG4gICAgICAgIHJvdXRlckNvbmZpZzoge1xuICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICBtYXhGaWxlU2l6ZTogXCI0TUJcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnB1dFBhcnNlcjoge1xuICAgICAgICAgICAgcGFyc2U6ICgpPT51bmRlZmluZWQsXG4gICAgICAgICAgICBfaW5wdXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIF9vdXRwdXQ6IHVuZGVmaW5lZFxuICAgICAgICB9LFxuICAgICAgICBtaWRkbGV3YXJlOiAoKT0+KHt9KSxcbiAgICAgICAgb25VcGxvYWRFcnJvcjogKCk9Pih7fSksXG4gICAgICAgIGVycm9yRm9ybWF0dGVyOiBpbml0RGVmLmVycm9yRm9ybWF0dGVyID8/IGRlZmF1bHRFcnJvckZvcm1hdHRlcixcbiAgICAgICAgLy8gT3ZlcmxvYWQgd2l0aCBwcm9wZXJ0aWVzIHBhc3NlZCBpblxuICAgICAgICAuLi5pbml0RGVmXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbnB1dCAodXNlclBhcnNlcikge1xuICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICAgICAgLi4uX2RlZixcbiAgICAgICAgICAgICAgICBpbnB1dFBhcnNlcjogdXNlclBhcnNlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG1pZGRsZXdhcmUgKHVzZXJNaWRkbGV3YXJlKSB7XG4gICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICAuLi5fZGVmLFxuICAgICAgICAgICAgICAgIG1pZGRsZXdhcmU6IHVzZXJNaWRkbGV3YXJlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRDb21wbGV0ZSAodXNlclVwbG9hZENvbXBsZXRlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIF9kZWYsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZXI6IHVzZXJVcGxvYWRDb21wbGV0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRFcnJvciAodXNlck9uVXBsb2FkRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgb25VcGxvYWRFcnJvcjogdXNlck9uVXBsb2FkRXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUJ1aWxkZXIob3B0cykge1xuICAgIHJldHVybiAoaW5wdXQpPT57XG4gICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgcm91dGVyQ29uZmlnOiBpbnB1dCxcbiAgICAgICAgICAgIC4uLm9wdHNcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cblxuY29uc3QgY3JlYXRlVXBsb2FkdGhpbmcgPSAob3B0cyk9PmNyZWF0ZUJ1aWxkZXIob3B0cyk7XG5jb25zdCBjcmVhdGVSb3V0ZUhhbmRsZXIgPSAob3B0cyk9PntcbiAgICBjb25zdCBoYW5kbGVycyA9IElOVEVSTkFMX0RPX05PVF9VU0VfY3JlYXRlUm91dGVIYW5kbGVyQ29yZShvcHRzLCBcIm5leHRqcy1hcHBcIik7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgUE9TVDogKHJlcSk9PmhhbmRsZXJzLlBPU1QocmVxKSxcbiAgICAgICAgR0VUOiAocmVxKT0+aGFuZGxlcnMuR0VUKHJlcSlcbiAgICB9O1xufTtcbi8qKlxuICogQGRlcHJlY2F0ZWQgVXNlIHtAbGluayBjcmVhdGVSb3V0ZUhhbmRsZXJ9IGluc3RlYWRcbiAqLyBjb25zdCBjcmVhdGVOZXh0Um91dGVIYW5kbGVyID0gY3JlYXRlUm91dGVIYW5kbGVyO1xuXG5leHBvcnQgeyBjcmVhdGVOZXh0Um91dGVIYW5kbGVyLCBjcmVhdGVSb3V0ZUhhbmRsZXIsIGNyZWF0ZVVwbG9hZHRoaW5nIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/next/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/server/index.js":
/*!**************************************************!*\
  !*** ./node_modules/uploadthing/server/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   INTERNAL_DO_NOT_USE_createRouteHandlerCore: () => (/* binding */ INTERNAL_DO_NOT_USE_createRouteHandlerCore),\n/* harmony export */   UTApi: () => (/* binding */ UTApi),\n/* harmony export */   UTFile: () => (/* binding */ UTFile),\n/* harmony export */   UTFiles: () => (/* reexport safe */ _internal_types_js__WEBPACK_IMPORTED_MODULE_2__.UTFiles),\n/* harmony export */   UploadThingError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError),\n/* harmony export */   createRouteHandler: () => (/* binding */ createRouteHandler),\n/* harmony export */   createServerHandler: () => (/* binding */ createServerHandler),\n/* harmony export */   createUploadthing: () => (/* binding */ createUploadthing),\n/* harmony export */   extractRouterConfig: () => (/* binding */ extractRouterConfig)\n/* harmony export */ });\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uploadthing/shared */ \"(rsc)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @effect/schema/Schema */ \"(rsc)/./node_modules/@effect/schema/dist/esm/Schema.js\");\n/* harmony import */ var effect_Effect__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! effect/Effect */ \"(rsc)/./node_modules/effect/dist/esm/Effect.js\");\n/* harmony import */ var effect_Duration__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! effect/Duration */ \"(rsc)/./node_modules/effect/dist/esm/Duration.js\");\n/* harmony import */ var effect_Schedule__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! effect/Schedule */ \"(rsc)/./node_modules/effect/dist/esm/Schedule.js\");\n/* harmony import */ var consola_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! consola/core */ \"(rsc)/./node_modules/consola/dist/core.mjs\");\n/* harmony import */ var effect_Logger__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! effect/Logger */ \"(rsc)/./node_modules/effect/dist/esm/Logger.js\");\n/* harmony import */ var effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! effect/LogLevel */ \"(rsc)/./node_modules/effect/dist/esm/LogLevel.js\");\n/* harmony import */ var std_env__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! std-env */ \"(rsc)/./node_modules/std-env/dist/index.mjs\");\n/* harmony import */ var effect_Context__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! effect/Context */ \"(rsc)/./node_modules/effect/dist/esm/Context.js\");\n/* harmony import */ var effect_Data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! effect/Data */ \"(rsc)/./node_modules/effect/dist/esm/Data.js\");\n/* harmony import */ var _internal_types_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../internal/types.js */ \"(rsc)/./node_modules/uploadthing/internal/types.js\");\n/* harmony import */ var _uploadthing_mime_types__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @uploadthing/mime-types */ \"(rsc)/./node_modules/@uploadthing/mime-types/dist/index.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar version = \"6.13.3\";\n\nfunction defaultErrorFormatter(error) {\n    return {\n        message: error.message\n    };\n}\nfunction formatError(error, router) {\n    const errorFormatter = router[Object.keys(router)[0]]?._def.errorFormatter ?? defaultErrorFormatter;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return errorFormatter(error);\n}\n\nconst ContentDispositionSchema = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.ValidContentDispositions);\n_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.ValidACLs);\n/**\n * =============================================================================\n * ======================== File Type Hierarchy ===============================\n * =============================================================================\n */ /**\n * Properties from the web File object, this is what the client sends when initiating an upload\n */ class FileUploadData extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"FileUploadData\")({\n    name: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    size: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number,\n    type: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String\n}) {\n}\n/**\n * `.middleware()` can add a customId to the incoming file data\n */ class FileUploadDataWithCustomId extends FileUploadData.extend(\"FileUploadDataWithCustomId\")({\n    customId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String)\n}) {\n}\n/**\n * When files are uploaded, we get back\n * - a key\n * - a direct URL for the file\n * - an app-specific URL for the file (useful for scoping eg. for optimization allowed origins)\n */ class UploadedFileData extends FileUploadDataWithCustomId.extend(\"UploadedFileData\")({\n    key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    url: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    appUrl: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String\n}) {\n}\n/**\n * =============================================================================\n * ======================== Server Response Schemas ============================\n * =============================================================================\n */ class PresignedBase extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"PresignedBaseSchema\")({\n    key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    fileName: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    fileType: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    fileUrl: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    appUrl: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    pollingJwt: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    pollingUrl: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    contentDisposition: ContentDispositionSchema,\n    customId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String)\n}) {\n}\nclass MPUResponse extends PresignedBase.extend(\"MPUResponseSchema\")({\n    urls: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Array(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n    uploadId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    chunkSize: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number,\n    chunkCount: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number\n}) {\n}\nclass PSPResponse extends PresignedBase.extend(\"PSPResponseSchema\")({\n    url: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    fields: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Record(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String, _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String)\n}) {\n}\nconst PresignedURLResponse = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Array(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Union(PSPResponse, MPUResponse));\nclass PollUploadResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"PollUploadResponse\")({\n    status: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    fileData: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.optional(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n        fileKey: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n        fileName: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n        fileSize: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number,\n        fileType: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n        metadata: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n        customId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n        callbackUrl: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.optional(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n        callbackSlug: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.optional(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String)\n    }))\n}) {\n}\nclass FailureCallbackResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"FailureCallbackResponse\")({\n    success: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Boolean,\n    message: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.optional(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String)\n}) {\n}\nclass ServerCallbackPostResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"ServerCallbackPostResponse\")({\n    status: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String\n}) {\n}\n/**\n * =============================================================================\n * ======================== Client Action Payloads ============================\n * =============================================================================\n */ class UploadActionPayload extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"UploadActionPayload\")({\n    files: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Array(FileUploadData),\n    input: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Unknown\n}) {\n}\nclass FailureActionPayload extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"FailureActionPayload\")({\n    fileKey: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    uploadId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n    storageProviderError: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.optional(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n    fileName: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String\n}) {\n}\nclass MultipartCompleteActionPayload extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"MultipartCompleteActionPayload\")({\n    fileKey: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    uploadId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n    etags: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Array(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n        tag: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n        partNumber: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number\n    }))\n}) {\n}\n\nconst isValidResponse = (response)=>{\n    if (!response.ok) return false;\n    if (response.status >= 400) return false;\n    if (!response.headers.has(\"x-uploadthing-version\")) return false;\n    return true;\n};\nconst conditionalDevServer = (presigned, apiKey)=>{\n    return effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        const file = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(`/v6/pollUpload/${presigned.key}`)).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(PollUploadResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((res)=>res.status === \"done\" && res.fileData ? effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed(res.fileData) : effect_Effect__WEBPACK_IMPORTED_MODULE_4__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError())), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.retry({\n            while: (err)=>err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError,\n            schedule: effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.exponential(10, 4).pipe(// 10ms, 40ms, 160ms, 640ms...\n            effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.union(effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.spaced(1000)), effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.compose(effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.elapsed), effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.whileOutput(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.lessThanOrEqualTo(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.minutes(1))))\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"RetryError\", ()=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\",\n                message: \"File took too long to upload\"\n            })));\n        let callbackUrl = file.callbackUrl + `?slug=${file.callbackSlug}`;\n        if (!callbackUrl.startsWith(\"http\")) callbackUrl = \"http://\" + callbackUrl;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logInfo(`SIMULATING FILE UPLOAD WEBHOOK CALLBACK`, callbackUrl);\n        const payload = JSON.stringify({\n            status: \"uploaded\",\n            metadata: JSON.parse(file.metadata ?? \"{}\"),\n            file: new UploadedFileData({\n                url: presigned.fileUrl,\n                appUrl: presigned.appUrl,\n                key: presigned.key,\n                name: file.fileName,\n                size: file.fileSize,\n                customId: file.customId,\n                type: file.fileType\n            })\n        });\n        const signature = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tryPromise({\n            try: ()=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.signPayload)(payload, apiKey),\n            catch: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to sign payload\",\n                    cause: e\n                })\n        });\n        const callbackResponse = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(callbackUrl, {\n            method: \"POST\",\n            body: payload,\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"uploadthing-hook\": \"callback\",\n                \"x-uploadthing-signature\": signature\n            }\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"FetchError\", ()=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed(new Response(null, {\n                status: 500\n            }))));\n        if (isValidResponse(callbackResponse)) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logInfo(\"Successfully simulated callback for file\", presigned.key);\n        } else {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(`\nFailed to simulate callback for file '${file.fileKey}'. Is your webhook configured correctly?\n  - Make sure the URL '${callbackUrl}' is accessible without any authentication. You can verify this by running 'curl -X POST ${callbackUrl}' in your terminal\n  - Still facing issues? Read https://docs.uploadthing.com/faq for common issues\n`.trim());\n        }\n        return file;\n    });\n};\n\nconst colorize = (str, level)=>{\n    // TODO: Maybe check is shell supports colors\n    switch(level){\n        case \"error\":\n        case \"fatal\":\n            return `\\x1b[41m\\x1b[30m${str}\\x1b[0m`;\n        case \"warn\":\n            return `\\x1b[43m\\x1b[30m${str}\\x1b[0m`;\n        case \"info\":\n        case \"log\":\n            return `\\x1b[44m\\x1b[30m${str}\\x1b[0m`;\n        case \"debug\":\n            return `\\x1b[47m\\x1b[30m${str}\\x1b[0m`;\n        case \"trace\":\n            return `\\x1b[47m\\x1b[30m${str}\\x1b[0m`;\n        case \"success\":\n            return `\\x1b[42m\\x1b[30m${str}\\x1b[0m`;\n        default:\n            return str;\n    }\n};\nconst icons = {\n    fatal: \"\",\n    error: \"\",\n    warn: \"\",\n    info: \"\",\n    log: \"\",\n    debug: \"\",\n    trace: \"\",\n    success: \"\"\n};\nfunction formatStack(stack) {\n    const cwd = \"cwd\" in std_env__WEBPACK_IMPORTED_MODULE_7__.process && typeof std_env__WEBPACK_IMPORTED_MODULE_7__.process.cwd === \"function\" ? std_env__WEBPACK_IMPORTED_MODULE_7__.process.cwd() : \"__UnknownCWD__\";\n    return \"  \" + stack.split(\"\\n\").splice(1).map((l)=>l.trim().replace(\"file://\", \"\").replace(cwd + \"/\", \"\")).join(\"\\n  \");\n}\nfunction formatArgs(args) {\n    const fmtArgs = args.map((arg)=>{\n        if ((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.isObject)(arg) && typeof arg.stack === \"string\") {\n            return arg.message + \"\\n\" + formatStack(arg.stack);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return arg;\n    });\n    return fmtArgs.map((arg)=>{\n        if (typeof arg === \"string\") {\n            return arg;\n        }\n        return JSON.stringify(arg, null, 4);\n    });\n}\nconst logger = (0,consola_core__WEBPACK_IMPORTED_MODULE_1__.createConsola)({\n    reporters: [\n        {\n            log: (logObj)=>{\n                const { type, tag, date, args } = logObj;\n                const icon = icons[type];\n                const logPrefix = colorize(` ${icon} ${tag} ${date.toLocaleTimeString()} `, type);\n                const lines = formatArgs(args).join(\" \") // concat all arguments to one space-separated string (like console does)\n                .split(\"\\n\") // split all the newlines (e.g. from logged JSON.stringified objects)\n                .map((l)=>logPrefix + \" \" + l) // prepend the log prefix to each line\n                .join(\"\\n\"); // join all the lines back together\n                // eslint-disable-next-line no-console\n                console.log(lines);\n            }\n        }\n    ],\n    defaults: {\n        tag: \"UPLOADTHING\"\n    }\n});\nconst effectLoggerLevelToConsolaLevel = {\n    All: \"verbose\",\n    Fatal: \"error\",\n    Error: \"error\",\n    Info: \"info\",\n    Debug: \"debug\",\n    Trace: \"trace\",\n    Warning: \"warn\",\n    None: \"silent\"\n};\nconst withMinimalLogLevel = (level = \"info\")=>{\n    logger.level = consola_core__WEBPACK_IMPORTED_MODULE_1__.LogLevels[level];\n    return effect_Logger__WEBPACK_IMPORTED_MODULE_8__.withMinimumLogLevel({\n        silent: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.None,\n        error: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.Error,\n        warn: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.Warning,\n        info: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.Info,\n        debug: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.Debug,\n        trace: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.Trace,\n        verbose: effect_LogLevel__WEBPACK_IMPORTED_MODULE_9__.All\n    }[level]);\n};\nconst ConsolaLogger = effect_Logger__WEBPACK_IMPORTED_MODULE_8__.replace(effect_Logger__WEBPACK_IMPORTED_MODULE_8__.defaultLogger, effect_Logger__WEBPACK_IMPORTED_MODULE_8__.make(({ logLevel, message })=>{\n    // FIXME: Probably log other stuff than just message?\n    logger[effectLoggerLevelToConsolaLevel[logLevel._tag]](message);\n}));\n\nconst uploadMultipart = (file, presigned)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(`Uploading file ${file.name} with ${presigned.urls.length} chunks of size ${presigned.chunkSize} bytes each`);\n        const etags = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.forEach(presigned.urls, (url, index)=>{\n            const offset = presigned.chunkSize * index;\n            const end = Math.min(offset + presigned.chunkSize, file.size);\n            const chunk = file.slice(offset, end);\n            return uploadPart({\n                url,\n                chunk: chunk,\n                contentDisposition: presigned.contentDisposition,\n                contentType: file.type,\n                fileName: file.name,\n                maxRetries: 10,\n                key: presigned.key,\n                uploadId: presigned.uploadId\n            }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((etag)=>({\n                    tag: etag,\n                    partNumber: index + 1\n                })), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"RetryError\", (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.die(e)));\n        }, {\n            concurrency: \"inherit\"\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"File\", file.name, \"uploaded successfully.\");\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Completing multipart upload...\");\n        yield* completeMultipartUpload(presigned, etags);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Multipart upload complete.\");\n    });\n/**\n * Used by server uploads where progress is not needed.\n * Uses normal fetch API.\n */ const uploadPart = (opts)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(opts.url, {\n        method: \"PUT\",\n        body: opts.chunk,\n        headers: {\n            \"Content-Type\": opts.contentType,\n            \"Content-Disposition\": (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.contentDisposition)(opts.contentDisposition, opts.fileName)\n        }\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((res)=>res.ok && res.headers.get(\"Etag\") ? effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed(res.headers.get(\"Etag\")) : effect_Effect__WEBPACK_IMPORTED_MODULE_4__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError())), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.retry({\n        while: (res)=>res instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError,\n        schedule: effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.exponential(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.millis(10), 4).pipe(// 10ms, 40ms, 160ms, 640ms...\n        effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.andThenEither(effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.spaced(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.seconds(1))), effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.compose(effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.elapsed), effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.whileOutput(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.lessThanOrEqualTo(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.minutes(1)))),\n        times: opts.maxRetries\n    }), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapErrorTag(\"RetryError\", ()=>// Max retries exceeded, tell UT server that upload failed\n        abortMultipartUpload({\n            key: opts.key,\n            uploadId: opts.uploadId\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((res)=>{\n            new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\",\n                message: `Failed to upload file ${opts.fileName} to S3`,\n                cause: res\n            });\n        }))));\nconst completeMultipartUpload = (presigned, etags)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(\"/v6/completeMultipart\"), {\n        method: \"POST\",\n        body: JSON.stringify({\n            fileKey: presigned.key,\n            uploadId: presigned.uploadId,\n            etags\n        }),\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n        success: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Boolean,\n        message: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.optional(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String)\n    }))), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.withSpan(\"completeMultipartUpload\", {\n        attributes: {\n            etags,\n            presigned\n        }\n    }));\nconst abortMultipartUpload = (presigned)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(\"/v6/failureCallback\"), {\n        method: \"POST\",\n        body: JSON.stringify({\n            fileKey: presigned.key,\n            uploadId: presigned.uploadId\n        }),\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(FailureCallbackResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.withSpan(\"abortMultipartUpload\", {\n        attributes: {\n            presigned\n        }\n    }));\n\nfunction getParseFn(parser) {\n    if (typeof parser.parse === \"function\") {\n        return parser.parse;\n    }\n    throw new Error(\"Invalid parser\");\n}\n\nconst getApiKey = (apiKey)=>{\n    if (apiKey) return apiKey;\n    if (std_env__WEBPACK_IMPORTED_MODULE_7__.process.env.UPLOADTHING_SECRET) return std_env__WEBPACK_IMPORTED_MODULE_7__.process.env.UPLOADTHING_SECRET;\n    return undefined;\n};\nconst getApiKeyOrThrow = (apiKey)=>{\n    const key = getApiKey(apiKey);\n    if (!key?.startsWith(\"sk_\")) {\n        throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"MISSING_ENV\",\n            message: \"Missing or invalid API key. API keys must start with `sk_`.\"\n        });\n    }\n    return key;\n};\n\nclass FileSizeMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, max, actual){\n        const reason = `You uploaded a ${type} file that was ${(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.bytesToFileSize)(actual)}, but the limit for that type is ${max}`;\n        super({\n            reason\n        });\n        this._tag = \"FileSizeMismatch\";\n        this.name = \"FileSizeMismatchError\";\n    }\n}\nclass FileCountMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, boundtype, bound, actual){\n        const reason = `You uploaded ${actual} file(s) of type '${type}', but the ${boundtype} for that type is ${bound}`;\n        super({\n            reason\n        });\n        this._tag = \"FileCountMismatch\";\n        this.name = \"FileCountMismatchError\";\n    }\n}\n// Verify that the uploaded files doesn't violate the route config,\n// e.g. uploading more videos than allowed, or a file that is larger than allowed.\n// This is double-checked on infra side, but we want to fail early to avoid network latency.\nconst assertFilesMeetConfig = (files, routeConfig)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        const counts = {};\n        for (const file of files){\n            const type = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig));\n            counts[type] = (counts[type] ?? 0) + 1;\n            const sizeLimit = routeConfig[type]?.maxFileSize;\n            if (!sizeLimit) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.InvalidRouteConfigError(type, \"maxFileSize\");\n            }\n            const sizeLimitBytes = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fileSizeToBytes)(sizeLimit);\n            if (file.size > sizeLimitBytes) {\n                return yield* new FileSizeMismatch(type, sizeLimit, file.size);\n            }\n        }\n        for(const _key in counts){\n            const key = _key;\n            const config = routeConfig[key];\n            if (!config) return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.InvalidRouteConfigError(key);\n            const count = counts[key];\n            const min = config.minFileCount;\n            const max = config.maxFileCount;\n            if (min > max) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid config during file count - minFileCount > maxFileCount\",\n                    cause: `minFileCount must be less than maxFileCount for key ${key}. got: ${min} > ${max}`\n                });\n            }\n            if (count < min) {\n                return yield* new FileCountMismatch(key, \"minimum\", min, count);\n            }\n            if (count > max) {\n                return yield* new FileCountMismatch(key, \"maximum\", max, count);\n            }\n        }\n        return null;\n    });\nclass RequestInput extends /** #__PURE__ */ effect_Context__WEBPACK_IMPORTED_MODULE_11__.Tag(\"uploadthing/RequestInput\")() {\n}\nconst parseAndValidateRequest = (input, opts, adapter)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        const req = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.isEffect(input.req) ? input.req : effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed(input.req);\n        // Get inputs from query and params\n        const url = new URL(req.url);\n        const headers = req.headers;\n        const params = url.searchParams;\n        const action = params.get(\"actionType\");\n        const slug = params.get(\"slug\");\n        const hook = headers.get(\"uploadthing-hook\");\n        const utFrontendPackage = headers.get(\"x-uploadthing-package\") ?? \"unknown\";\n        const clientVersion = headers.get(\"x-uploadthing-version\");\n        const apiKey = getApiKey(opts.config?.uploadthingSecret);\n        if (clientVersion != null && clientVersion !== version) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(`Client version mismatch. Server version: ${version}, Client version: ${clientVersion}`);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Client version mismatch\",\n                cause: `Server version: ${version}, Client version: ${clientVersion}`\n            });\n        }\n        if (!slug) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"No slug provided in params:\", params);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"No slug provided in params\"\n            });\n        }\n        if (slug && typeof slug !== \"string\") {\n            const msg = `Expected slug to be of type 'string', got '${typeof slug}'`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"`slug` must be a string\",\n                cause: msg\n            });\n        }\n        if (!apiKey) {\n            const msg = `No secret provided, please set UPLOADTHING_SECRET in your env file or in the config`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"MISSING_ENV\",\n                message: `No secret provided`,\n                cause: msg\n            });\n        }\n        if (!apiKey.startsWith(\"sk_\")) {\n            const msg = `Invalid secret provided, UPLOADTHING_SECRET must start with 'sk_'`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"MISSING_ENV\",\n                message: \"Invalid API key. API keys must start with 'sk_'.\",\n                cause: msg\n            });\n        }\n        if (utFrontendPackage && typeof utFrontendPackage !== \"string\") {\n            const msg = `Expected x-uploadthing-package to be of type 'string', got '${typeof utFrontendPackage}'`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"`x-uploadthing-package` must be a string. eg. '@uploadthing/react'\",\n                cause: msg\n            });\n        }\n        const uploadable = opts.router[slug];\n        if (!uploadable) {\n            const msg = `No file route found for slug ${slug}`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"NOT_FOUND\",\n                message: msg\n            });\n        }\n        if (action && !(0,_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.isActionType)(action)) {\n            const msg = `Expected ${_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.VALID_ACTION_TYPES.map((x)=>`\"${x}\"`).join(\", \").replace(/,(?!.*,)/, \" or\")} but got \"${action}\"`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Invalid action type\", msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                cause: `Invalid action type ${action}`,\n                message: msg\n            });\n        }\n        if (hook && !(0,_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.isUploadThingHook)(hook)) {\n            const msg = `Expected ${_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.VALID_UT_HOOKS.map((x)=>`\"${x}\"`).join(\", \").replace(/,(?!.*,)/, \" or\")} but got \"${hook}\"`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Invalid uploadthing hook\", msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                cause: `Invalid uploadthing hook ${hook}`,\n                message: msg\n            });\n        }\n        if (!action && !hook || action && hook) {\n            const msg = `Exactly one of 'actionType' or 'uploadthing-hook' must be provided`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: msg\n            });\n        }\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\" All request input is valid\");\n        // FIXME: This should probably provide the full context at once instead of\n        // partially in the `runRequestHandlerAsync` and partially in here...\n        // Ref: https://discord.com/channels/@me/1201977154577891369/1207441839972548669\n        const contextValue = yield* _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext;\n        contextValue.baseHeaders[\"x-uploadthing-api-key\"] = apiKey;\n        contextValue.baseHeaders[\"x-uploadthing-fe-package\"] = utFrontendPackage;\n        contextValue.baseHeaders[\"x-uploadthing-be-adapter\"] = adapter;\n        const { isDev = std_env__WEBPACK_IMPORTED_MODULE_7__.isDevelopment } = opts.config ?? {};\n        if (isDev) yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logInfo(\"UploadThing dev server is now running!\");\n        const base = {\n            req,\n            config: opts.config ?? {},\n            middlewareArgs: input.middlewareArgs,\n            isDev,\n            apiKey,\n            slug,\n            uploadable,\n            hook: null,\n            action: null\n        };\n        return action ? {\n            ...base,\n            action: action\n        } : {\n            ...base,\n            hook: hook\n        };\n    });\n\nconst resolveCallbackUrl = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n    const { config, req, isDev } = yield* RequestInput;\n    let callbackUrl = new URL(req.url);\n    if (config?.callbackUrl) {\n        callbackUrl = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getFullApiUrl)(config.callbackUrl);\n    } else if (std_env__WEBPACK_IMPORTED_MODULE_7__.process.env.UPLOADTHING_URL) {\n        callbackUrl = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getFullApiUrl)(std_env__WEBPACK_IMPORTED_MODULE_7__.process.env.UPLOADTHING_URL);\n    }\n    if (isDev || !callbackUrl.host.includes(\"localhost\")) {\n        return callbackUrl;\n    }\n    // Production builds have to have a public URL so UT can send webhook\n    // Parse the URL from the headers\n    let parsedFromHeaders = req.headers.get(\"origin\") ?? req.headers.get(\"referer\") ?? req.headers.get(\"host\") ?? req.headers.get(\"x-forwarded-host\");\n    if (parsedFromHeaders && !parsedFromHeaders.includes(\"http\")) {\n        parsedFromHeaders = (req.headers.get(\"x-forwarded-proto\") ?? \"https\") + \"://\" + parsedFromHeaders;\n    }\n    if (!parsedFromHeaders || parsedFromHeaders.includes(\"localhost\")) {\n        // Didn't find a valid URL in the headers, log a warning and use the original url anyway\n        effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logWarning(\"You are using a localhost callback url in production which is not supported.\", \"Read more and learn how to fix it here: https://docs.uploadthing.com/faq#my-callback-runs-in-development-but-not-in-production\");\n        return callbackUrl;\n    }\n    return yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getFullApiUrl)(parsedFromHeaders);\n});\n\n/**\n * Allows adapters to be fully async/await instead of providing services and running Effect programs\n */ const runRequestHandlerAsync = (handler, args, config)=>handler(args).pipe(withMinimalLogLevel(config?.logLevel), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provide(ConsolaLogger), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, {\n        fetch: config?.fetch ?? globalThis.fetch,\n        baseHeaders: {\n            \"x-uploadthing-version\": version,\n            // These are filled in later in `parseAndValidateRequest`\n            \"x-uploadthing-api-key\": undefined,\n            \"x-uploadthing-be-adapter\": undefined,\n            \"x-uploadthing-fe-package\": undefined\n        }\n    }), asHandlerOutput, effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runPromise);\nconst asHandlerOutput = (effect)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchAll(effect, (error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed({\n            success: false,\n            error\n        }));\nconst handleRequest = RequestInput.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(({ action, hook })=>{\n    if (hook === \"callback\") return handleCallbackRequest;\n    switch(action){\n        case \"upload\":\n            return handleUploadAction;\n        case \"multipart-complete\":\n            return handleMultipartCompleteAction;\n        case \"failure\":\n            return handleMultipartFailureAction;\n    }\n}), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.map((output)=>({\n        success: true,\n        ...output\n    })));\nconst buildRequestHandler = (opts, adapter)=>(input)=>handleRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provideServiceEffect(RequestInput, parseAndValidateRequest(input, opts, adapter)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTags({\n            InvalidJson: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"An error occured while parsing input/output\",\n                    cause: e\n                }),\n            BadRequestError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: e.getMessage(),\n                    cause: e,\n                    data: e.json\n                }),\n            FetchError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: typeof e.error === \"string\" ? e.error : e.message,\n                    cause: e,\n                    data: e.error\n                }),\n            ParseError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"An error occured while parsing input/output\",\n                    cause: e\n                })\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(e.message)));\nconst handleCallbackRequest = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n    const { req, uploadable, apiKey } = yield* RequestInput;\n    const verified = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tryPromise({\n        try: async ()=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.verifySignature)(await req.clone().text(), req.headers.get(\"x-uploadthing-signature\"), apiKey),\n        catch: ()=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            })\n    });\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Signature verified:\", verified);\n    if (!verified) {\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Invalid signature\");\n        return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"BAD_REQUEST\",\n            message: \"Invalid signature\"\n        });\n    }\n    const requestInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.flatMap((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseRequestJson)(req), _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n        status: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n        file: UploadedFileData,\n        metadata: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Record(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String, _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Unknown)\n    })));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Handling callback request with input:\", requestInput);\n    const serverData = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tryPromise({\n        try: async ()=>uploadable.resolver({\n                file: requestInput.file,\n                metadata: requestInput.metadata\n            }),\n        catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: \"Failed to run onUploadComplete\",\n                cause: error\n            })\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.\", error)));\n    const payload = {\n        fileKey: requestInput.file.key,\n        callbackData: serverData ?? null\n    };\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"'onUploadComplete' callback finished. Sending response to UploadThing:\", payload);\n    yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(\"/v6/serverCallback\"), {\n        method: \"POST\",\n        body: JSON.stringify(payload),\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(ServerCallbackPostResponse)));\n    return {\n        body: null\n    };\n});\nconst runRouteMiddleware = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        const { uploadable, middlewareArgs } = yield* RequestInput;\n        const { files, input } = opts;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Running middleware\");\n        const metadata = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tryPromise({\n            try: async ()=>uploadable._def.middleware({\n                    ...middlewareArgs,\n                    input,\n                    files\n                }),\n            catch: (error)=>error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError ? error : new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run middleware\",\n                    cause: error\n                })\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"An error occured in your middleware function\", error)));\n        if (metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.UTFiles] && metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.UTFiles].length !== files.length) {\n            const msg = `Expected files override to have the same length as original files, got ${metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.UTFiles].length} but expected ${files.length}`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Files override must have the same length as files\",\n                cause: msg\n            });\n        }\n        // Attach customIds from middleware to the files\n        const filesWithCustomIds = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.forEach(files, (file, idx)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n                const theirs = metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_2__.UTFiles]?.[idx];\n                if (theirs && theirs.size !== file.size) {\n                    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logWarning(\"File size mismatch. Reverting to original size\");\n                }\n                return {\n                    name: theirs?.name ?? file.name,\n                    size: file.size,\n                    customId: theirs?.customId\n                };\n            }));\n        return {\n            metadata,\n            filesWithCustomIds\n        };\n    });\nconst handleUploadAction = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n    const opts = yield* RequestInput;\n    const { files, input } = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.flatMap((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseRequestJson)(opts.req), _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(UploadActionPayload));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Handling upload request with input:\", {\n        files,\n        input\n    });\n    // validate the input\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Parsing user input\");\n    const inputParser = opts.uploadable._def.inputParser;\n    const parsedInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tryPromise({\n        try: async ()=>getParseFn(inputParser)(input),\n        catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid input\",\n                cause: error\n            })\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"An error occured trying to parse input\", error)));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Input parsed successfully\", parsedInput);\n    const { metadata, filesWithCustomIds } = yield* runRouteMiddleware({\n        input: parsedInput,\n        files\n    });\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Parsing route config\", opts.uploadable._def.routerConfig);\n    const parsedConfig = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fillInputRouteConfig)(opts.uploadable._def.routerConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"InvalidRouteConfig\", (err)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"BAD_REQUEST\",\n            message: \"Invalid config\",\n            cause: err\n        })));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Route config parsed successfully\", parsedConfig);\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Validating files meet the config requirements\", files);\n    yield* assertFilesMeetConfig(files, parsedConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.mapError((e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"BAD_REQUEST\",\n            message: `Invalid config: ${e._tag}`,\n            cause: \"reason\" in e ? e.reason : e.message\n        })));\n    const callbackUrl = yield* resolveCallbackUrl.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Failed to resolve callback URL\", error)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"InvalidURL\", (err)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"INTERNAL_SERVER_ERROR\",\n            message: err.message\n        })));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Retrieving presigned URLs from UploadThing. Callback URL is:\", callbackUrl.href);\n    const presignedUrls = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(\"/v6/prepareUpload\"), {\n        method: \"POST\",\n        body: JSON.stringify({\n            files: filesWithCustomIds,\n            routeConfig: parsedConfig,\n            metadata,\n            callbackUrl: callbackUrl.origin + callbackUrl.pathname,\n            callbackSlug: opts.slug\n        }),\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(PresignedURLResponse)));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"UploadThing responded with:\", presignedUrls);\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Sending presigned URLs to client\");\n    let promise = undefined;\n    if (opts.isDev) {\n        const fetchContext = yield* _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext;\n        promise = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.forEach(presignedUrls, (presigned)=>conditionalDevServer(presigned, opts.apiKey).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.either), {\n            concurrency: 10\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provide(ConsolaLogger), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, fetchContext), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runPromise);\n    }\n    return {\n        body: presignedUrls,\n        cleanup: promise\n    };\n});\nconst handleMultipartCompleteAction = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n    const opts = yield* RequestInput;\n    const requestInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.flatMap((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseRequestJson)(opts.req), _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(MultipartCompleteActionPayload));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Handling multipart-complete request with input:\", requestInput);\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Notifying UploadThing that multipart upload is complete\");\n    const completionResponse = yield* completeMultipartUpload({\n        key: requestInput.fileKey,\n        uploadId: requestInput.uploadId\n    }, requestInput.etags);\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"UploadThing responded with:\", completionResponse);\n    return {\n        body: null\n    };\n});\nconst handleMultipartFailureAction = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n    const { req, uploadable } = yield* RequestInput;\n    const { fileKey, uploadId } = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.flatMap((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseRequestJson)(req), _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(FailureActionPayload));\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Handling failure request with input:\", {\n        fileKey,\n        uploadId\n    });\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Notifying UploadThing that upload failed\");\n    const failureResponse = yield* abortMultipartUpload({\n        key: fileKey,\n        uploadId\n    });\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"UploadThing responded with:\", failureResponse);\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Running 'onUploadError' callback\");\n    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__[\"try\"]({\n        try: ()=>{\n            uploadable._def.onUploadError({\n                error: new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"UPLOAD_FAILED\",\n                    message: `Upload failed for ${fileKey}`\n                }),\n                fileKey\n            });\n        },\n        catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"INTERNAL_SERVER_ERROR\",\n                message: \"Failed to run onUploadError\",\n                cause: error\n            })\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Failed to run onUploadError. You probably shouldn't be throwing errors here.\", error)));\n    return {\n        body: null\n    };\n});\nconst buildPermissionsInfoHandler = (opts)=>{\n    return ()=>{\n        const permissions = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(opts.router).map((slug)=>{\n            const route = opts.router[slug];\n            const config = effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fillInputRouteConfig)(route._def.routerConfig));\n            return {\n                slug,\n                config\n            };\n        });\n        return permissions;\n    };\n};\n\nfunction incompatibleNodeGuard() {\n    if (typeof std_env__WEBPACK_IMPORTED_MODULE_7__.process === \"undefined\") return;\n    let major;\n    let minor;\n    const maybeNodeVersion = std_env__WEBPACK_IMPORTED_MODULE_7__.process.versions?.node?.split(\".\");\n    if (maybeNodeVersion) {\n        [major, minor] = maybeNodeVersion.map((v)=>parseInt(v, 10));\n    }\n    const maybeNodePath = std_env__WEBPACK_IMPORTED_MODULE_7__.process.env?.NODE;\n    if (!major && maybeNodePath) {\n        const nodeVersion = /v(\\d+)\\.(\\d+)\\.(\\d+)/.exec(maybeNodePath)?.[0];\n        if (nodeVersion) {\n            [major, minor] = nodeVersion.substring(1).split(\".\").map((v)=>parseInt(v, 10));\n        }\n    }\n    if (!major || !minor) return;\n    // Require ^18.13.0\n    if (major > 18) return;\n    if (major === 18 && minor >= 13) return;\n    effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runSync(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(`YOU ARE USING A LEGACY (${major}.${minor}) NODE VERSION WHICH ISN'T OFFICIALLY SUPPORTED. PLEASE UPGRADE TO NODE ^18.13.`));\n    // Kill the process if it isn't going to work correctly anyway\n    // If we've gotten this far we know we have a Node.js runtime so exit is defined. Override std-env type.\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n    std_env__WEBPACK_IMPORTED_MODULE_7__.process.exit?.(1);\n}\n\nfunction internalCreateBuilder(initDef = {}) {\n    const _def = {\n        // Default router config\n        routerConfig: {\n            image: {\n                maxFileSize: \"4MB\"\n            }\n        },\n        inputParser: {\n            parse: ()=>undefined,\n            _input: undefined,\n            _output: undefined\n        },\n        middleware: ()=>({}),\n        onUploadError: ()=>({}),\n        errorFormatter: initDef.errorFormatter ?? defaultErrorFormatter,\n        // Overload with properties passed in\n        ...initDef\n    };\n    return {\n        input (userParser) {\n            return internalCreateBuilder({\n                ..._def,\n                inputParser: userParser\n            });\n        },\n        middleware (userMiddleware) {\n            return internalCreateBuilder({\n                ..._def,\n                middleware: userMiddleware\n            });\n        },\n        onUploadComplete (userUploadComplete) {\n            return {\n                _def,\n                resolver: userUploadComplete\n            };\n        },\n        onUploadError (userOnUploadError) {\n            return internalCreateBuilder({\n                ..._def,\n                onUploadError: userOnUploadError\n            });\n        }\n    };\n}\nfunction createBuilder(opts) {\n    return (input)=>{\n        return internalCreateBuilder({\n            routerConfig: input,\n            ...opts\n        });\n    };\n}\n\n/**\n * Extension of the Blob class that simplifies setting the `name` and `customId` properties,\n * similar to the built-in File class from Node > 20.\n */ class UTFile extends Blob {\n    constructor(parts, name, options){\n        const optionsWithDefaults = {\n            ...options,\n            type: options?.type ?? ((0,_uploadthing_mime_types__WEBPACK_IMPORTED_MODULE_12__.lookup)(name) || \"application/octet-stream\"),\n            lastModified: options?.lastModified ?? Date.now()\n        };\n        super(parts, optionsWithDefaults);\n        this.name = name;\n        this.customId = optionsWithDefaults.customId;\n        this.lastModified = optionsWithDefaults.lastModified;\n    }\n}\n\nconst uploadPresignedPost = (file, presigned)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(`Uploading file ${file.name} using presigned POST URL`);\n        const formData = new FormData();\n        Object.entries(presigned.fields).forEach(([k, v])=>formData.append(k, v));\n        formData.append(\"file\", file); // File data **MUST GO LAST**\n        const res = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(presigned.url, {\n            method: \"POST\",\n            body: formData,\n            headers: new Headers({\n                Accept: \"application/xml\"\n            })\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapErrorCause(()=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(\"/v6/failureCallback\"), {\n                method: \"POST\",\n                body: JSON.stringify({\n                    fileKey: presigned.key,\n                    uploadId: null\n                }),\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(FailureCallbackResponse)))));\n        if (!res.ok) {\n            const text = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.promise(res.text);\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(`Failed to upload file ${file.name} to presigned POST URL. Response: ${text}`);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\",\n                message: \"Failed to upload file\",\n                cause: text\n            });\n        }\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"File\", file.name, \"uploaded successfully\");\n    });\n\nfunction guardServerOnly() {\n    if (typeof window !== \"undefined\") {\n        throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n            code: \"INTERNAL_SERVER_ERROR\",\n            message: \"The `utapi` can only be used on the server.\"\n        });\n    }\n}\nconst uploadFilesInternal = (input)=>getPresignedUrls(input).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((presigneds)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.forEach(presigneds, (file)=>uploadFile(file).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Upload failed:\", error)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.match({\n                onFailure: (error)=>({\n                        data: null,\n                        error: _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError.toObject(error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError ? error : new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                            message: \"Failed to upload file.\",\n                            code: \"BAD_REQUEST\",\n                            cause: error\n                        }))\n                    }),\n                onSuccess: (data)=>({\n                        data,\n                        error: null\n                    })\n            })), {\n            concurrency: 10\n        })));\n/**\n * FIXME: downloading everything into memory and then upload\n * isn't the best. We should support streams so we can download\n * just as much as we need at any time.\n */ const downloadFiles = (urls, downloadErrors)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.forEach(urls, (_url, idx)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n            let url = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.isObject)(_url) ? _url.url : _url;\n            if (typeof url === \"string\") {\n                // since dataurls will result in name being too long, tell the user\n                // to use uploadFiles instead.\n                if (url.startsWith(\"data:\")) {\n                    downloadErrors[idx] = _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError.toObject(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                        code: \"BAD_REQUEST\",\n                        message: \"Please use uploadFiles() for data URLs. uploadFilesFromUrl() is intended for use with remote URLs only.\"\n                    }));\n                    return null;\n                }\n            }\n            url = new URL(url);\n            const { name = url.pathname.split(\"/\").pop() ?? \"unknown-filename\", customId = undefined } = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.isObject)(_url) ? _url : {};\n            const response = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url);\n            if (!response.ok) {\n                downloadErrors[idx] = _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError.toObject(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Failed to download requested file.\",\n                    cause: response\n                }));\n                return undefined;\n            }\n            return yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.promise(()=>response.blob()).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((blob)=>new UTFile([\n                    blob\n                ], name, {\n                    customId\n                })));\n        }), {\n        concurrency: 10\n    });\nconst getPresignedUrls = (input)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        const { files, metadata, contentDisposition, acl } = input;\n        const fileData = files.map((file)=>({\n                name: file.name ?? \"unnamed-blob\",\n                type: file.type,\n                size: file.size,\n                ...\"customId\" in file ? {\n                    customId: file.customId\n                } : {}\n            }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Getting presigned URLs for files\", fileData);\n        const responseSchema = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n            data: PresignedURLResponse\n        });\n        const presigneds = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(\"/v6/uploadFiles\"), {\n            method: \"POST\",\n            cache: \"no-store\",\n            body: JSON.stringify({\n                files: fileData,\n                metadata,\n                contentDisposition,\n                acl\n            }),\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(responseSchema)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"ParseError\", (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.die(e)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"FetchError\", (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.die(e)));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Got presigned URLs:\", presigneds.data);\n        return files.map((file, i)=>({\n                file,\n                presigned: presigneds.data[i]\n            }));\n    });\nconst uploadFile = (input)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.gen(function*() {\n        const { file, presigned } = input;\n        if (\"urls\" in presigned) {\n            yield* uploadMultipart(file, presigned);\n        } else {\n            yield* uploadPresignedPost(file, presigned);\n        }\n        yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(`/v6/pollUpload/${presigned.key}`)).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(PollUploadResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tap(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Polled upload\", presigned.key)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((res)=>res.status === \"done\" ? effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed(undefined) : effect_Effect__WEBPACK_IMPORTED_MODULE_4__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError())), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.retry({\n            while: (err)=>err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.RetryError,\n            schedule: effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.exponential(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.millis(10), 4).pipe(// 10ms, 40ms, 160ms, 640ms...\n            effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.andThenEither(effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.spaced(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.seconds(1))), effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.compose(effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.elapsed), effect_Schedule__WEBPACK_IMPORTED_MODULE_5__.whileOutput(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.lessThanOrEqualTo(effect_Duration__WEBPACK_IMPORTED_MODULE_6__.minutes(1))))\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"RetryError\", (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.die(e)));\n        return {\n            key: presigned.key,\n            url: presigned.fileUrl,\n            appUrl: presigned.appUrl,\n            name: file.name,\n            size: file.size,\n            type: file.type,\n            customId: \"customId\" in file ? file.customId ?? null : null\n        };\n    });\nfunction parseTimeToSeconds(time) {\n    const match = time.toString().split(/(\\d+)/).filter(Boolean);\n    const num = Number(match[0]);\n    const unit = (match[1] ?? \"s\").trim().slice(0, 1);\n    const multiplier = {\n        s: 1,\n        m: 60,\n        h: 3600,\n        d: 86400\n    }[unit];\n    return num * multiplier;\n}\n\nclass UTApi {\n    constructor(opts){\n        this.requestUploadThing = (pathname, body, responseSchema)=>{\n            const url = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateUploadThingURL)(pathname);\n            effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runSync(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Requesting UploadThing:\", {\n                url,\n                body,\n                headers: this.defaultHeaders\n            }));\n            const headers = new Headers([\n                [\n                    \"Content-Type\",\n                    \"application/json\"\n                ]\n            ]);\n            for (const [key, value] of Object.entries(this.defaultHeaders)){\n                if (typeof value === \"string\") headers.set(key, value);\n            }\n            return (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url, {\n                method: \"POST\",\n                cache: \"no-store\",\n                body: JSON.stringify(body),\n                headers\n            }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.decodeUnknown(responseSchema)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"FetchError\", (err)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Request failed:\", err).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(()=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.die(err)))), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.catchTag(\"ParseError\", (err)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logError(\"Response parsing failed:\", err).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen(()=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.die(err)))), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tap((res)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"UploadThing response:\", res)));\n        };\n        this.executeAsync = (program, signal)=>program.pipe(withMinimalLogLevel(this.logLevel), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provide(ConsolaLogger), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, {\n                fetch: this.fetch,\n                baseHeaders: this.defaultHeaders\n            }), (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runPromise(e, signal ? {\n                    signal\n                } : undefined));\n        /**\n   * Request to delete files from UploadThing storage.\n   * @param {string | string[]} fileKeys\n   *\n   * @example\n   * await deleteFiles(\"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\");\n   *\n   * @example\n   * await deleteFiles([\"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\",\"1649353b-04ea-48a2-9db7-31de7f562c8d_image2.jpg\"])\n   *\n   * @example\n   * await deleteFiles(\"myCustomIdentifier\", { keyType: \"customId\" })\n   */ this.deleteFiles = async (keys, opts)=>{\n            guardServerOnly();\n            const { keyType = this.defaultKeyType } = opts ?? {};\n            class DeleteFileResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"DeleteFileResponse\")({\n                success: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Boolean,\n                deletedCount: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number\n            }) {\n            }\n            return await this.executeAsync(this.requestUploadThing(\"/v6/deleteFiles\", keyType === \"fileKey\" ? {\n                fileKeys: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(keys)\n            } : {\n                customIds: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(keys)\n            }, DeleteFileResponse));\n        };\n        /**\n   * Request file URLs from UploadThing storage.\n   * @param {string | string[]} fileKeys\n   *\n   * @example\n   * const data = await getFileUrls(\"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\");\n   * console.log(data); // [{key: \"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\", url: \"https://uploadthing.com/f/2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\"}]\n   *\n   * @example\n   * const data = await getFileUrls([\"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\",\"1649353b-04ea-48a2-9db7-31de7f562c8d_image2.jpg\"])\n   * console.log(data) // [{key: \"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\", url: \"https://uploadthing.com/f/2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\" },{key: \"1649353b-04ea-48a2-9db7-31de7f562c8d_image2.jpg\", url: \"https://uploadthing.com/f/1649353b-04ea-48a2-9db7-31de7f562c8d_image2.jpg\"}]\n   */ this.getFileUrls = async (keys, opts)=>{\n            guardServerOnly();\n            const { keyType = this.defaultKeyType } = opts ?? {};\n            class GetFileUrlResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"GetFileUrlResponse\")({\n                data: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Array(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n                    key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n                    url: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String\n                }))\n            }) {\n            }\n            return await this.executeAsync(this.requestUploadThing(\"/v6/getFileUrl\", keyType === \"fileKey\" ? {\n                fileKeys: keys\n            } : {\n                customIds: keys\n            }, GetFileUrlResponse));\n        };\n        /**\n   * Request file list from UploadThing storage.\n   * @param {object} opts\n   * @param {number} opts.limit The maximum number of files to return\n   * @param {number} opts.offset The number of files to skip\n   *\n   * @example\n   * const data = await listFiles({ limit: 1 });\n   * console.log(data); // { key: \"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\", id: \"2e0fdb64-9957-4262-8e45-f372ba903ac8\" }\n   */ this.listFiles = async (opts)=>{\n            guardServerOnly();\n            class ListFileResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"ListFileResponse\")({\n                hasMore: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Boolean,\n                files: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Array(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n                    id: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n                    customId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String),\n                    key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n                    name: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String,\n                    status: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Literal(\"Deletion Pending\", \"Failed\", \"Uploaded\", \"Uploading\")\n                }))\n            }) {\n            }\n            return await this.executeAsync(this.requestUploadThing(\"/v6/listFiles\", {\n                ...opts\n            }, ListFileResponse));\n        };\n        this.renameFiles = async (updates)=>{\n            guardServerOnly();\n            class RenameFileResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"RenameFileResponse\")({\n                success: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Boolean\n            }) {\n            }\n            return await this.executeAsync(this.requestUploadThing(\"/v6/renameFiles\", {\n                updates: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(updates)\n            }, RenameFileResponse));\n        };\n        /** @deprecated Use {@link renameFiles} instead. */ this.renameFile = this.renameFiles;\n        this.getUsageInfo = async ()=>{\n            guardServerOnly();\n            class GetUsageInfoResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"GetUsageInfoResponse\")({\n                totalBytes: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number,\n                appTotalBytes: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number,\n                filesUploaded: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number,\n                limitBytes: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Number\n            }) {\n            }\n            return await this.executeAsync(this.requestUploadThing(\"/v6/getUsageInfo\", {}, GetUsageInfoResponse));\n        };\n        /** Request a presigned url for a private file(s) */ this.getSignedURL = async (key, opts)=>{\n            guardServerOnly();\n            const expiresIn = opts?.expiresIn ? parseTimeToSeconds(opts.expiresIn) : undefined;\n            const { keyType = this.defaultKeyType } = opts ?? {};\n            if (opts?.expiresIn && isNaN(expiresIn)) {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"expiresIn must be a valid time string, for example '1d', '2 days', or a number of seconds.\"\n                });\n            }\n            if (expiresIn && expiresIn > 86400 * 7) {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"expiresIn must be less than 7 days (604800 seconds).\"\n                });\n            }\n            class GetSignedUrlResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Class(\"GetSignedUrlResponse\")({\n                url: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.String\n            }) {\n            }\n            return await this.executeAsync(this.requestUploadThing(\"/v6/requestFileAccess\", keyType === \"fileKey\" ? {\n                fileKey: key,\n                expiresIn\n            } : {\n                customId: key,\n                expiresIn\n            }, GetSignedUrlResponse));\n        };\n        /**\n   * Update the ACL of a file or set of files.\n   *\n   * @example\n   * // Make a single file public\n   * await utapi.updateACL(\"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\", \"public-read\");\n   *\n   * // Make multiple files private\n   * await utapi.updateACL(\n   *   [\n   *     \"2e0fdb64-9957-4262-8e45-f372ba903ac8_image.jpg\",\n   *     \"1649353b-04ea-48a2-9db7-31de7f562c8d_image2.jpg\",\n   *   ],\n   *   \"private\",\n   * );\n   */ this.updateACL = async (keys, acl, opts)=>{\n            guardServerOnly();\n            const { keyType = this.defaultKeyType } = opts ?? {};\n            const updates = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(keys).map((key)=>{\n                return keyType === \"fileKey\" ? {\n                    fileKey: key,\n                    acl\n                } : {\n                    customId: key,\n                    acl\n                };\n            });\n            const responseSchema = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Struct({\n                success: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_3__.Boolean\n            });\n            return await this.executeAsync(this.requestUploadThing(\"/v6/updateACL\", {\n                updates\n            }, responseSchema));\n        };\n        // Assert some stuff\n        guardServerOnly();\n        incompatibleNodeGuard();\n        const apiKey = getApiKeyOrThrow(opts?.apiKey);\n        this.fetch = opts?.fetch ?? globalThis.fetch;\n        this.defaultHeaders = {\n            \"x-uploadthing-api-key\": apiKey,\n            \"x-uploadthing-version\": version,\n            \"x-uploadthing-be-adapter\": \"server-sdk\",\n            \"x-uploadthing-fe-package\": undefined\n        };\n        this.defaultKeyType = opts?.defaultKeyType ?? \"fileKey\";\n        this.logLevel = opts?.logLevel;\n    }\n    async uploadFiles(files, opts) {\n        guardServerOnly();\n        const uploads = await this.executeAsync(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.flatMap(uploadFilesInternal({\n            files: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(files),\n            contentDisposition: opts?.contentDisposition ?? \"inline\",\n            metadata: opts?.metadata ?? {},\n            acl: opts?.acl\n        }), (ups)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.succeed(Array.isArray(files) ? ups : ups[0])).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.tap((res)=>effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Finished uploading:\", res))), opts?.signal);\n        return uploads;\n    }\n    async uploadFilesFromUrl(urls, opts) {\n        guardServerOnly();\n        const downloadErrors = {};\n        const uploads = await this.executeAsync(downloadFiles((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(urls), downloadErrors).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((files)=>files.filter((f)=>f != null)), effect_Effect__WEBPACK_IMPORTED_MODULE_4__.andThen((files)=>uploadFilesInternal({\n                files,\n                contentDisposition: opts?.contentDisposition ?? \"inline\",\n                metadata: opts?.metadata ?? {},\n                acl: opts?.acl\n            }))), opts?.signal);\n        /** Put it all back together, preserve the order of files */ const responses = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(urls).map((_, index)=>{\n            if (downloadErrors[index]) {\n                return {\n                    data: null,\n                    error: downloadErrors[index]\n                };\n            }\n            return uploads.shift();\n        });\n        /** Return single object or array based on input urls */ const uploadFileResponse = Array.isArray(urls) ? responses : responses[0];\n        effect_Effect__WEBPACK_IMPORTED_MODULE_4__.runSync(effect_Effect__WEBPACK_IMPORTED_MODULE_4__.logDebug(\"Finished uploading:\", uploadFileResponse));\n        return uploadFileResponse;\n    }\n}\n\nconst createUploadthing = (opts)=>createBuilder(opts);\n/** @internal */ const INTERNAL_DO_NOT_USE_createRouteHandlerCore = (opts, adapter)=>{\n    incompatibleNodeGuard();\n    const requestHandler = buildRequestHandler(opts, adapter);\n    const getBuildPerms = buildPermissionsInfoHandler(opts);\n    const POST = async (request)=>{\n        const req = request instanceof Request ? request : request.request;\n        const response = await runRequestHandlerAsync(requestHandler, {\n            req,\n            middlewareArgs: {\n                req,\n                event: undefined,\n                res: undefined\n            }\n        }, opts.config);\n        if (response.success === false) {\n            return Response.json(formatError(response.error, opts.router), {\n                status: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getStatusCodeFromError)(response.error),\n                headers: {\n                    \"x-uploadthing-version\": version\n                }\n            });\n        }\n        const res = Response.json(response.body, {\n            headers: {\n                \"x-uploadthing-version\": version\n            }\n        });\n        // @ts-expect-error - this is a custom property\n        res.cleanup = response.cleanup;\n        return res;\n    };\n    const GET = (request)=>{\n        return Response.json(getBuildPerms(), {\n            headers: {\n                \"x-uploadthing-version\": version\n            }\n        });\n    };\n    return {\n        GET,\n        POST\n    };\n};\nconst createRouteHandler = (opts)=>INTERNAL_DO_NOT_USE_createRouteHandlerCore(opts, \"server\");\nconst extractRouterConfig = (router)=>buildPermissionsInfoHandler({\n        router\n    })();\n/**\n * @deprecated Use {@link createRouteHandler} instead\n */ const createServerHandler = createRouteHandler;\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvc2VydmVyL2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMlo7QUFDcFc7QUFDWjtBQUNIO0FBQ0k7QUFDQTtBQUNZO0FBQ2hCO0FBQ1U7QUFDRDtBQUNQO0FBQ047QUFDZ0Y7QUFDckU7QUFDRTs7QUFFakQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUNBQWlDLDBEQUFTLElBQUkseUVBQXdCO0FBQ3RFLDBEQUFTLElBQUksMERBQVM7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHdEQUFPO0FBQ3hDLFVBQVUseURBQVE7QUFDbEIsVUFBVSx5REFBUTtBQUNsQixVQUFVLHlEQUFRO0FBQ2xCLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMseURBQVEsQ0FBQyx5REFBUTtBQUMvQixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLHlEQUFRO0FBQ2pCLFNBQVMseURBQVE7QUFDakIsWUFBWSx5REFBUTtBQUNwQixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyx3REFBTztBQUN2QyxTQUFTLHlEQUFRO0FBQ2pCLGNBQWMseURBQVE7QUFDdEIsY0FBYyx5REFBUTtBQUN0QixhQUFhLHlEQUFRO0FBQ3JCLFlBQVkseURBQVE7QUFDcEIsZ0JBQWdCLHlEQUFRO0FBQ3hCLGdCQUFnQix5REFBUTtBQUN4QjtBQUNBLGNBQWMseURBQVEsQ0FBQyx5REFBUTtBQUMvQixDQUFDO0FBQ0Q7QUFDQTtBQUNBLFVBQVUsd0RBQU8sQ0FBQyx5REFBUTtBQUMxQixjQUFjLHlEQUFRO0FBQ3RCLGVBQWUseURBQVE7QUFDdkIsZ0JBQWdCLHlEQUFRO0FBQ3hCLENBQUM7QUFDRDtBQUNBO0FBQ0EsU0FBUyx5REFB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LGtEQUFjLHlDQUF5QyxrREFBYztBQUN2SztBQUNBO0FBQ0EsOENBQThDO0FBQzlDO0FBQ0EsYUFBYTtBQUNiLHVGQUF1Riw0REFBTztBQUM5RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFFBQVEsa0RBQWMsQ0FBQyxtREFBZTtBQUN0QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0Esd0JBQXdCLDJFQUFzQjtBQUM5QztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0Esb0JBQW9CLDBCQUEwQjtBQUM5Qzs7QUFFc0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jYXNlY29icmEtZGV2Ly4vbm9kZV9tb2R1bGVzL3VwbG9hZHRoaW5nL3NlcnZlci9pbmRleC5qcz8yNjNmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbGlkQ29udGVudERpc3Bvc2l0aW9ucywgVmFsaWRBQ0xzLCBmZXRjaEVmZiwgZ2VuZXJhdGVVcGxvYWRUaGluZ1VSTCwgcGFyc2VSZXNwb25zZUpzb24sIFJldHJ5RXJyb3IsIFVwbG9hZFRoaW5nRXJyb3IsIHNpZ25QYXlsb2FkLCBpc09iamVjdCwgY29udGVudERpc3Bvc2l0aW9uLCBnZXRUeXBlRnJvbUZpbGVOYW1lLCBvYmplY3RLZXlzLCBJbnZhbGlkUm91dGVDb25maWdFcnJvciwgZmlsZVNpemVUb0J5dGVzLCBieXRlc1RvRmlsZVNpemUsIEZldGNoQ29udGV4dCwgZ2V0RnVsbEFwaVVybCwgdmVyaWZ5U2lnbmF0dXJlLCBwYXJzZVJlcXVlc3RKc29uLCBmaWxsSW5wdXRSb3V0ZUNvbmZpZywgYXNBcnJheSwgZ2V0U3RhdHVzQ29kZUZyb21FcnJvciB9IGZyb20gJ0B1cGxvYWR0aGluZy9zaGFyZWQnO1xuZXhwb3J0IHsgVXBsb2FkVGhpbmdFcnJvciB9IGZyb20gJ0B1cGxvYWR0aGluZy9zaGFyZWQnO1xuaW1wb3J0ICogYXMgUyBmcm9tICdAZWZmZWN0L3NjaGVtYS9TY2hlbWEnO1xuaW1wb3J0ICogYXMgRWZmZWN0IGZyb20gJ2VmZmVjdC9FZmZlY3QnO1xuaW1wb3J0ICogYXMgRHVyYXRpb24gZnJvbSAnZWZmZWN0L0R1cmF0aW9uJztcbmltcG9ydCAqIGFzIFNjaGVkdWxlIGZyb20gJ2VmZmVjdC9TY2hlZHVsZSc7XG5pbXBvcnQgeyBjcmVhdGVDb25zb2xhLCBMb2dMZXZlbHMgfSBmcm9tICdjb25zb2xhL2NvcmUnO1xuaW1wb3J0ICogYXMgTG9nZ2VyIGZyb20gJ2VmZmVjdC9Mb2dnZXInO1xuaW1wb3J0ICogYXMgRWZmZWN0TG9nTGV2ZWwgZnJvbSAnZWZmZWN0L0xvZ0xldmVsJztcbmltcG9ydCB7IHByb2Nlc3MsIGlzRGV2ZWxvcG1lbnQgfSBmcm9tICdzdGQtZW52JztcbmltcG9ydCAqIGFzIENvbnRleHQgZnJvbSAnZWZmZWN0L0NvbnRleHQnO1xuaW1wb3J0ICogYXMgRGF0YSBmcm9tICdlZmZlY3QvRGF0YSc7XG5pbXBvcnQgeyBpc0FjdGlvblR5cGUsIFZBTElEX0FDVElPTl9UWVBFUywgaXNVcGxvYWRUaGluZ0hvb2ssIFZBTElEX1VUX0hPT0tTLCBVVEZpbGVzIH0gZnJvbSAnLi4vaW50ZXJuYWwvdHlwZXMuanMnO1xuZXhwb3J0IHsgVVRGaWxlcyB9IGZyb20gJy4uL2ludGVybmFsL3R5cGVzLmpzJztcbmltcG9ydCB7IGxvb2t1cCB9IGZyb20gJ0B1cGxvYWR0aGluZy9taW1lLXR5cGVzJztcblxudmFyIHZlcnNpb24gPSBcIjYuMTMuM1wiO1xuXG5mdW5jdGlvbiBkZWZhdWx0RXJyb3JGb3JtYXR0ZXIoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGZvcm1hdEVycm9yKGVycm9yLCByb3V0ZXIpIHtcbiAgICBjb25zdCBlcnJvckZvcm1hdHRlciA9IHJvdXRlcltPYmplY3Qua2V5cyhyb3V0ZXIpWzBdXT8uX2RlZi5lcnJvckZvcm1hdHRlciA/PyBkZWZhdWx0RXJyb3JGb3JtYXR0ZXI7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtcmV0dXJuXG4gICAgcmV0dXJuIGVycm9yRm9ybWF0dGVyKGVycm9yKTtcbn1cblxuY29uc3QgQ29udGVudERpc3Bvc2l0aW9uU2NoZW1hID0gUy5MaXRlcmFsKC4uLlZhbGlkQ29udGVudERpc3Bvc2l0aW9ucyk7XG5TLkxpdGVyYWwoLi4uVmFsaWRBQ0xzKTtcbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBGaWxlIFR5cGUgSGllcmFyY2h5ID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gLyoqXG4gKiBQcm9wZXJ0aWVzIGZyb20gdGhlIHdlYiBGaWxlIG9iamVjdCwgdGhpcyBpcyB3aGF0IHRoZSBjbGllbnQgc2VuZHMgd2hlbiBpbml0aWF0aW5nIGFuIHVwbG9hZFxuICovIGNsYXNzIEZpbGVVcGxvYWREYXRhIGV4dGVuZHMgUy5DbGFzcyhcIkZpbGVVcGxvYWREYXRhXCIpKHtcbiAgICBuYW1lOiBTLlN0cmluZyxcbiAgICBzaXplOiBTLk51bWJlcixcbiAgICB0eXBlOiBTLlN0cmluZ1xufSkge1xufVxuLyoqXG4gKiBgLm1pZGRsZXdhcmUoKWAgY2FuIGFkZCBhIGN1c3RvbUlkIHRvIHRoZSBpbmNvbWluZyBmaWxlIGRhdGFcbiAqLyBjbGFzcyBGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZCBleHRlbmRzIEZpbGVVcGxvYWREYXRhLmV4dGVuZChcIkZpbGVVcGxvYWREYXRhV2l0aEN1c3RvbUlkXCIpKHtcbiAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpXG59KSB7XG59XG4vKipcbiAqIFdoZW4gZmlsZXMgYXJlIHVwbG9hZGVkLCB3ZSBnZXQgYmFja1xuICogLSBhIGtleVxuICogLSBhIGRpcmVjdCBVUkwgZm9yIHRoZSBmaWxlXG4gKiAtIGFuIGFwcC1zcGVjaWZpYyBVUkwgZm9yIHRoZSBmaWxlICh1c2VmdWwgZm9yIHNjb3BpbmcgZWcuIGZvciBvcHRpbWl6YXRpb24gYWxsb3dlZCBvcmlnaW5zKVxuICovIGNsYXNzIFVwbG9hZGVkRmlsZURhdGEgZXh0ZW5kcyBGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZC5leHRlbmQoXCJVcGxvYWRlZEZpbGVEYXRhXCIpKHtcbiAgICBrZXk6IFMuU3RyaW5nLFxuICAgIHVybDogUy5TdHJpbmcsXG4gICAgYXBwVXJsOiBTLlN0cmluZ1xufSkge1xufVxuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09IFNlcnZlciBSZXNwb25zZSBTY2hlbWFzID09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gY2xhc3MgUHJlc2lnbmVkQmFzZSBleHRlbmRzIFMuQ2xhc3MoXCJQcmVzaWduZWRCYXNlU2NoZW1hXCIpKHtcbiAgICBrZXk6IFMuU3RyaW5nLFxuICAgIGZpbGVOYW1lOiBTLlN0cmluZyxcbiAgICBmaWxlVHlwZTogUy5TdHJpbmcsXG4gICAgZmlsZVVybDogUy5TdHJpbmcsXG4gICAgYXBwVXJsOiBTLlN0cmluZyxcbiAgICBwb2xsaW5nSnd0OiBTLlN0cmluZyxcbiAgICBwb2xsaW5nVXJsOiBTLlN0cmluZyxcbiAgICBjb250ZW50RGlzcG9zaXRpb246IENvbnRlbnREaXNwb3NpdGlvblNjaGVtYSxcbiAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpXG59KSB7XG59XG5jbGFzcyBNUFVSZXNwb25zZSBleHRlbmRzIFByZXNpZ25lZEJhc2UuZXh0ZW5kKFwiTVBVUmVzcG9uc2VTY2hlbWFcIikoe1xuICAgIHVybHM6IFMuQXJyYXkoUy5TdHJpbmcpLFxuICAgIHVwbG9hZElkOiBTLlN0cmluZyxcbiAgICBjaHVua1NpemU6IFMuTnVtYmVyLFxuICAgIGNodW5rQ291bnQ6IFMuTnVtYmVyXG59KSB7XG59XG5jbGFzcyBQU1BSZXNwb25zZSBleHRlbmRzIFByZXNpZ25lZEJhc2UuZXh0ZW5kKFwiUFNQUmVzcG9uc2VTY2hlbWFcIikoe1xuICAgIHVybDogUy5TdHJpbmcsXG4gICAgZmllbGRzOiBTLlJlY29yZChTLlN0cmluZywgUy5TdHJpbmcpXG59KSB7XG59XG5jb25zdCBQcmVzaWduZWRVUkxSZXNwb25zZSA9IFMuQXJyYXkoUy5VbmlvbihQU1BSZXNwb25zZSwgTVBVUmVzcG9uc2UpKTtcbmNsYXNzIFBvbGxVcGxvYWRSZXNwb25zZSBleHRlbmRzIFMuQ2xhc3MoXCJQb2xsVXBsb2FkUmVzcG9uc2VcIikoe1xuICAgIHN0YXR1czogUy5TdHJpbmcsXG4gICAgZmlsZURhdGE6IFMub3B0aW9uYWwoUy5TdHJ1Y3Qoe1xuICAgICAgICBmaWxlS2V5OiBTLk51bGxPcihTLlN0cmluZyksXG4gICAgICAgIGZpbGVOYW1lOiBTLlN0cmluZyxcbiAgICAgICAgZmlsZVNpemU6IFMuTnVtYmVyLFxuICAgICAgICBmaWxlVHlwZTogUy5TdHJpbmcsXG4gICAgICAgIG1ldGFkYXRhOiBTLk51bGxPcihTLlN0cmluZyksXG4gICAgICAgIGN1c3RvbUlkOiBTLk51bGxPcihTLlN0cmluZyksXG4gICAgICAgIGNhbGxiYWNrVXJsOiBTLm9wdGlvbmFsKFMuU3RyaW5nKSxcbiAgICAgICAgY2FsbGJhY2tTbHVnOiBTLm9wdGlvbmFsKFMuU3RyaW5nKVxuICAgIH0pKVxufSkge1xufVxuY2xhc3MgRmFpbHVyZUNhbGxiYWNrUmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiRmFpbHVyZUNhbGxiYWNrUmVzcG9uc2VcIikoe1xuICAgIHN1Y2Nlc3M6IFMuQm9vbGVhbixcbiAgICBtZXNzYWdlOiBTLm9wdGlvbmFsKFMuU3RyaW5nKVxufSkge1xufVxuY2xhc3MgU2VydmVyQ2FsbGJhY2tQb3N0UmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiU2VydmVyQ2FsbGJhY2tQb3N0UmVzcG9uc2VcIikoe1xuICAgIHN0YXR1czogUy5TdHJpbmdcbn0pIHtcbn1cbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBDbGllbnQgQWN0aW9uIFBheWxvYWRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gY2xhc3MgVXBsb2FkQWN0aW9uUGF5bG9hZCBleHRlbmRzIFMuQ2xhc3MoXCJVcGxvYWRBY3Rpb25QYXlsb2FkXCIpKHtcbiAgICBmaWxlczogUy5BcnJheShGaWxlVXBsb2FkRGF0YSksXG4gICAgaW5wdXQ6IFMuVW5rbm93blxufSkge1xufVxuY2xhc3MgRmFpbHVyZUFjdGlvblBheWxvYWQgZXh0ZW5kcyBTLkNsYXNzKFwiRmFpbHVyZUFjdGlvblBheWxvYWRcIikoe1xuICAgIGZpbGVLZXk6IFMuU3RyaW5nLFxuICAgIHVwbG9hZElkOiBTLk51bGxPcihTLlN0cmluZyksXG4gICAgc3RvcmFnZVByb3ZpZGVyRXJyb3I6IFMub3B0aW9uYWwoUy5TdHJpbmcpLFxuICAgIGZpbGVOYW1lOiBTLlN0cmluZ1xufSkge1xufVxuY2xhc3MgTXVsdGlwYXJ0Q29tcGxldGVBY3Rpb25QYXlsb2FkIGV4dGVuZHMgUy5DbGFzcyhcIk11bHRpcGFydENvbXBsZXRlQWN0aW9uUGF5bG9hZFwiKSh7XG4gICAgZmlsZUtleTogUy5TdHJpbmcsXG4gICAgdXBsb2FkSWQ6IFMuU3RyaW5nLFxuICAgIGV0YWdzOiBTLkFycmF5KFMuU3RydWN0KHtcbiAgICAgICAgdGFnOiBTLlN0cmluZyxcbiAgICAgICAgcGFydE51bWJlcjogUy5OdW1iZXJcbiAgICB9KSlcbn0pIHtcbn1cblxuY29uc3QgaXNWYWxpZFJlc3BvbnNlID0gKHJlc3BvbnNlKT0+e1xuICAgIGlmICghcmVzcG9uc2Uub2spIHJldHVybiBmYWxzZTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID49IDQwMCkgcmV0dXJuIGZhbHNlO1xuICAgIGlmICghcmVzcG9uc2UuaGVhZGVycy5oYXMoXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIikpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5jb25zdCBjb25kaXRpb25hbERldlNlcnZlciA9IChwcmVzaWduZWQsIGFwaUtleSk9PntcbiAgICByZXR1cm4gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGZpbGUgPSB5aWVsZCogZmV0Y2hFZmYoZ2VuZXJhdGVVcGxvYWRUaGluZ1VSTChgL3Y2L3BvbGxVcGxvYWQvJHtwcmVzaWduZWQua2V5fWApKS5waXBlKEVmZmVjdC5hbmRUaGVuKHBhcnNlUmVzcG9uc2VKc29uKSwgRWZmZWN0LmFuZFRoZW4oUy5kZWNvZGVVbmtub3duKFBvbGxVcGxvYWRSZXNwb25zZSkpLCBFZmZlY3QuYW5kVGhlbigocmVzKT0+cmVzLnN0YXR1cyA9PT0gXCJkb25lXCIgJiYgcmVzLmZpbGVEYXRhID8gRWZmZWN0LnN1Y2NlZWQocmVzLmZpbGVEYXRhKSA6IEVmZmVjdC5mYWlsKG5ldyBSZXRyeUVycm9yKCkpKSwgRWZmZWN0LnJldHJ5KHtcbiAgICAgICAgICAgIHdoaWxlOiAoZXJyKT0+ZXJyIGluc3RhbmNlb2YgUmV0cnlFcnJvcixcbiAgICAgICAgICAgIHNjaGVkdWxlOiBTY2hlZHVsZS5leHBvbmVudGlhbCgxMCwgNCkucGlwZSgvLyAxMG1zLCA0MG1zLCAxNjBtcywgNjQwbXMuLi5cbiAgICAgICAgICAgIFNjaGVkdWxlLnVuaW9uKFNjaGVkdWxlLnNwYWNlZCgxMDAwKSksIFNjaGVkdWxlLmNvbXBvc2UoU2NoZWR1bGUuZWxhcHNlZCksIFNjaGVkdWxlLndoaWxlT3V0cHV0KER1cmF0aW9uLmxlc3NUaGFuT3JFcXVhbFRvKER1cmF0aW9uLm1pbnV0ZXMoMSkpKSlcbiAgICAgICAgfSksIEVmZmVjdC5jYXRjaFRhZyhcIlJldHJ5RXJyb3JcIiwgKCk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIlVQTE9BRF9GQUlMRURcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZpbGUgdG9vayB0b28gbG9uZyB0byB1cGxvYWRcIlxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgbGV0IGNhbGxiYWNrVXJsID0gZmlsZS5jYWxsYmFja1VybCArIGA/c2x1Zz0ke2ZpbGUuY2FsbGJhY2tTbHVnfWA7XG4gICAgICAgIGlmICghY2FsbGJhY2tVcmwuc3RhcnRzV2l0aChcImh0dHBcIikpIGNhbGxiYWNrVXJsID0gXCJodHRwOi8vXCIgKyBjYWxsYmFja1VybDtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dJbmZvKGBTSU1VTEFUSU5HIEZJTEUgVVBMT0FEIFdFQkhPT0sgQ0FMTEJBQ0tgLCBjYWxsYmFja1VybCk7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBzdGF0dXM6IFwidXBsb2FkZWRcIixcbiAgICAgICAgICAgIG1ldGFkYXRhOiBKU09OLnBhcnNlKGZpbGUubWV0YWRhdGEgPz8gXCJ7fVwiKSxcbiAgICAgICAgICAgIGZpbGU6IG5ldyBVcGxvYWRlZEZpbGVEYXRhKHtcbiAgICAgICAgICAgICAgICB1cmw6IHByZXNpZ25lZC5maWxlVXJsLFxuICAgICAgICAgICAgICAgIGFwcFVybDogcHJlc2lnbmVkLmFwcFVybCxcbiAgICAgICAgICAgICAgICBrZXk6IHByZXNpZ25lZC5rZXksXG4gICAgICAgICAgICAgICAgbmFtZTogZmlsZS5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICBzaXplOiBmaWxlLmZpbGVTaXplLFxuICAgICAgICAgICAgICAgIGN1c3RvbUlkOiBmaWxlLmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgIHR5cGU6IGZpbGUuZmlsZVR5cGVcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzaWduYXR1cmUgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICAgICAgdHJ5OiAoKT0+c2lnblBheWxvYWQocGF5bG9hZCwgYXBpS2V5KSxcbiAgICAgICAgICAgIGNhdGNoOiAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gc2lnbiBwYXlsb2FkXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrUmVzcG9uc2UgPSB5aWVsZCogZmV0Y2hFZmYoY2FsbGJhY2tVcmwsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBib2R5OiBwYXlsb2FkLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgIFwidXBsb2FkdGhpbmctaG9va1wiOiBcImNhbGxiYWNrXCIsXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiOiBzaWduYXR1cmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkucGlwZShFZmZlY3QuY2F0Y2hUYWcoXCJGZXRjaEVycm9yXCIsICgpPT5FZmZlY3Quc3VjY2VlZChuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgICAgIHN0YXR1czogNTAwXG4gICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgaWYgKGlzVmFsaWRSZXNwb25zZShjYWxsYmFja1Jlc3BvbnNlKSkge1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dJbmZvKFwiU3VjY2Vzc2Z1bGx5IHNpbXVsYXRlZCBjYWxsYmFjayBmb3IgZmlsZVwiLCBwcmVzaWduZWQua2V5KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IoYFxuRmFpbGVkIHRvIHNpbXVsYXRlIGNhbGxiYWNrIGZvciBmaWxlICcke2ZpbGUuZmlsZUtleX0nLiBJcyB5b3VyIHdlYmhvb2sgY29uZmlndXJlZCBjb3JyZWN0bHk/XG4gIC0gTWFrZSBzdXJlIHRoZSBVUkwgJyR7Y2FsbGJhY2tVcmx9JyBpcyBhY2Nlc3NpYmxlIHdpdGhvdXQgYW55IGF1dGhlbnRpY2F0aW9uLiBZb3UgY2FuIHZlcmlmeSB0aGlzIGJ5IHJ1bm5pbmcgJ2N1cmwgLVggUE9TVCAke2NhbGxiYWNrVXJsfScgaW4geW91ciB0ZXJtaW5hbFxuICAtIFN0aWxsIGZhY2luZyBpc3N1ZXM/IFJlYWQgaHR0cHM6Ly9kb2NzLnVwbG9hZHRoaW5nLmNvbS9mYXEgZm9yIGNvbW1vbiBpc3N1ZXNcbmAudHJpbSgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlsZTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IGNvbG9yaXplID0gKHN0ciwgbGV2ZWwpPT57XG4gICAgLy8gVE9ETzogTWF5YmUgY2hlY2sgaXMgc2hlbGwgc3VwcG9ydHMgY29sb3JzXG4gICAgc3dpdGNoKGxldmVsKXtcbiAgICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICAgIGNhc2UgXCJmYXRhbFwiOlxuICAgICAgICAgICAgcmV0dXJuIGBcXHgxYls0MW1cXHgxYlszMG0ke3N0cn1cXHgxYlswbWA7XG4gICAgICAgIGNhc2UgXCJ3YXJuXCI6XG4gICAgICAgICAgICByZXR1cm4gYFxceDFiWzQzbVxceDFiWzMwbSR7c3RyfVxceDFiWzBtYDtcbiAgICAgICAgY2FzZSBcImluZm9cIjpcbiAgICAgICAgY2FzZSBcImxvZ1wiOlxuICAgICAgICAgICAgcmV0dXJuIGBcXHgxYls0NG1cXHgxYlszMG0ke3N0cn1cXHgxYlswbWA7XG4gICAgICAgIGNhc2UgXCJkZWJ1Z1wiOlxuICAgICAgICAgICAgcmV0dXJuIGBcXHgxYls0N21cXHgxYlszMG0ke3N0cn1cXHgxYlswbWA7XG4gICAgICAgIGNhc2UgXCJ0cmFjZVwiOlxuICAgICAgICAgICAgcmV0dXJuIGBcXHgxYls0N21cXHgxYlszMG0ke3N0cn1cXHgxYlswbWA7XG4gICAgICAgIGNhc2UgXCJzdWNjZXNzXCI6XG4gICAgICAgICAgICByZXR1cm4gYFxceDFiWzQybVxceDFiWzMwbSR7c3RyfVxceDFiWzBtYDtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxufTtcbmNvbnN0IGljb25zID0ge1xuICAgIGZhdGFsOiBcIuKor1wiLFxuICAgIGVycm9yOiBcIuKor1wiLFxuICAgIHdhcm46IFwi4pqg77iPXCIsXG4gICAgaW5mbzogXCLihLlcIixcbiAgICBsb2c6IFwi4oS5XCIsXG4gICAgZGVidWc6IFwi4pqZXCIsXG4gICAgdHJhY2U6IFwi4oaSXCIsXG4gICAgc3VjY2VzczogXCLinJNcIlxufTtcbmZ1bmN0aW9uIGZvcm1hdFN0YWNrKHN0YWNrKSB7XG4gICAgY29uc3QgY3dkID0gXCJjd2RcIiBpbiBwcm9jZXNzICYmIHR5cGVvZiBwcm9jZXNzLmN3ZCA9PT0gXCJmdW5jdGlvblwiID8gcHJvY2Vzcy5jd2QoKSA6IFwiX19Vbmtub3duQ1dEX19cIjtcbiAgICByZXR1cm4gXCIgIFwiICsgc3RhY2suc3BsaXQoXCJcXG5cIikuc3BsaWNlKDEpLm1hcCgobCk9PmwudHJpbSgpLnJlcGxhY2UoXCJmaWxlOi8vXCIsIFwiXCIpLnJlcGxhY2UoY3dkICsgXCIvXCIsIFwiXCIpKS5qb2luKFwiXFxuICBcIik7XG59XG5mdW5jdGlvbiBmb3JtYXRBcmdzKGFyZ3MpIHtcbiAgICBjb25zdCBmbXRBcmdzID0gYXJncy5tYXAoKGFyZyk9PntcbiAgICAgICAgaWYgKGlzT2JqZWN0KGFyZykgJiYgdHlwZW9mIGFyZy5zdGFjayA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGFyZy5tZXNzYWdlICsgXCJcXG5cIiArIGZvcm1hdFN0YWNrKGFyZy5zdGFjayk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtcmV0dXJuXG4gICAgICAgIHJldHVybiBhcmc7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZtdEFyZ3MubWFwKChhcmcpPT57XG4gICAgICAgIGlmICh0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gYXJnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmcsIG51bGwsIDQpO1xuICAgIH0pO1xufVxuY29uc3QgbG9nZ2VyID0gY3JlYXRlQ29uc29sYSh7XG4gICAgcmVwb3J0ZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIGxvZzogKGxvZ09iaik9PntcbiAgICAgICAgICAgICAgICBjb25zdCB7IHR5cGUsIHRhZywgZGF0ZSwgYXJncyB9ID0gbG9nT2JqO1xuICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBpY29uc1t0eXBlXTtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2dQcmVmaXggPSBjb2xvcml6ZShgICR7aWNvbn0gJHt0YWd9ICR7ZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoKX0gYCwgdHlwZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSBmb3JtYXRBcmdzKGFyZ3MpLmpvaW4oXCIgXCIpIC8vIGNvbmNhdCBhbGwgYXJndW1lbnRzIHRvIG9uZSBzcGFjZS1zZXBhcmF0ZWQgc3RyaW5nIChsaWtlIGNvbnNvbGUgZG9lcylcbiAgICAgICAgICAgICAgICAuc3BsaXQoXCJcXG5cIikgLy8gc3BsaXQgYWxsIHRoZSBuZXdsaW5lcyAoZS5nLiBmcm9tIGxvZ2dlZCBKU09OLnN0cmluZ2lmaWVkIG9iamVjdHMpXG4gICAgICAgICAgICAgICAgLm1hcCgobCk9PmxvZ1ByZWZpeCArIFwiIFwiICsgbCkgLy8gcHJlcGVuZCB0aGUgbG9nIHByZWZpeCB0byBlYWNoIGxpbmVcbiAgICAgICAgICAgICAgICAuam9pbihcIlxcblwiKTsgLy8gam9pbiBhbGwgdGhlIGxpbmVzIGJhY2sgdG9nZXRoZXJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGxpbmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0sXG4gICAgZGVmYXVsdHM6IHtcbiAgICAgICAgdGFnOiBcIlVQTE9BRFRISU5HXCJcbiAgICB9XG59KTtcbmNvbnN0IGVmZmVjdExvZ2dlckxldmVsVG9Db25zb2xhTGV2ZWwgPSB7XG4gICAgQWxsOiBcInZlcmJvc2VcIixcbiAgICBGYXRhbDogXCJlcnJvclwiLFxuICAgIEVycm9yOiBcImVycm9yXCIsXG4gICAgSW5mbzogXCJpbmZvXCIsXG4gICAgRGVidWc6IFwiZGVidWdcIixcbiAgICBUcmFjZTogXCJ0cmFjZVwiLFxuICAgIFdhcm5pbmc6IFwid2FyblwiLFxuICAgIE5vbmU6IFwic2lsZW50XCJcbn07XG5jb25zdCB3aXRoTWluaW1hbExvZ0xldmVsID0gKGxldmVsID0gXCJpbmZvXCIpPT57XG4gICAgbG9nZ2VyLmxldmVsID0gTG9nTGV2ZWxzW2xldmVsXTtcbiAgICByZXR1cm4gTG9nZ2VyLndpdGhNaW5pbXVtTG9nTGV2ZWwoe1xuICAgICAgICBzaWxlbnQ6IEVmZmVjdExvZ0xldmVsLk5vbmUsXG4gICAgICAgIGVycm9yOiBFZmZlY3RMb2dMZXZlbC5FcnJvcixcbiAgICAgICAgd2FybjogRWZmZWN0TG9nTGV2ZWwuV2FybmluZyxcbiAgICAgICAgaW5mbzogRWZmZWN0TG9nTGV2ZWwuSW5mbyxcbiAgICAgICAgZGVidWc6IEVmZmVjdExvZ0xldmVsLkRlYnVnLFxuICAgICAgICB0cmFjZTogRWZmZWN0TG9nTGV2ZWwuVHJhY2UsXG4gICAgICAgIHZlcmJvc2U6IEVmZmVjdExvZ0xldmVsLkFsbFxuICAgIH1bbGV2ZWxdKTtcbn07XG5jb25zdCBDb25zb2xhTG9nZ2VyID0gTG9nZ2VyLnJlcGxhY2UoTG9nZ2VyLmRlZmF1bHRMb2dnZXIsIExvZ2dlci5tYWtlKCh7IGxvZ0xldmVsLCBtZXNzYWdlIH0pPT57XG4gICAgLy8gRklYTUU6IFByb2JhYmx5IGxvZyBvdGhlciBzdHVmZiB0aGFuIGp1c3QgbWVzc2FnZT9cbiAgICBsb2dnZXJbZWZmZWN0TG9nZ2VyTGV2ZWxUb0NvbnNvbGFMZXZlbFtsb2dMZXZlbC5fdGFnXV0obWVzc2FnZSk7XG59KSk7XG5cbmNvbnN0IHVwbG9hZE11bHRpcGFydCA9IChmaWxlLCBwcmVzaWduZWQpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhgVXBsb2FkaW5nIGZpbGUgJHtmaWxlLm5hbWV9IHdpdGggJHtwcmVzaWduZWQudXJscy5sZW5ndGh9IGNodW5rcyBvZiBzaXplICR7cHJlc2lnbmVkLmNodW5rU2l6ZX0gYnl0ZXMgZWFjaGApO1xuICAgICAgICBjb25zdCBldGFncyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChwcmVzaWduZWQudXJscywgKHVybCwgaW5kZXgpPT57XG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBwcmVzaWduZWQuY2h1bmtTaXplICogaW5kZXg7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSBNYXRoLm1pbihvZmZzZXQgKyBwcmVzaWduZWQuY2h1bmtTaXplLCBmaWxlLnNpemUpO1xuICAgICAgICAgICAgY29uc3QgY2h1bmsgPSBmaWxlLnNsaWNlKG9mZnNldCwgZW5kKTtcbiAgICAgICAgICAgIHJldHVybiB1cGxvYWRQYXJ0KHtcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgY2h1bms6IGNodW5rLFxuICAgICAgICAgICAgICAgIGNvbnRlbnREaXNwb3NpdGlvbjogcHJlc2lnbmVkLmNvbnRlbnREaXNwb3NpdGlvbixcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgbWF4UmV0cmllczogMTAsXG4gICAgICAgICAgICAgICAga2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgICAgIHVwbG9hZElkOiBwcmVzaWduZWQudXBsb2FkSWRcbiAgICAgICAgICAgIH0pLnBpcGUoRWZmZWN0LmFuZFRoZW4oKGV0YWcpPT4oe1xuICAgICAgICAgICAgICAgICAgICB0YWc6IGV0YWcsXG4gICAgICAgICAgICAgICAgICAgIHBhcnROdW1iZXI6IGluZGV4ICsgMVxuICAgICAgICAgICAgICAgIH0pKSwgRWZmZWN0LmNhdGNoVGFnKFwiUmV0cnlFcnJvclwiLCAoZSk9PkVmZmVjdC5kaWUoZSkpKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IFwiaW5oZXJpdFwiXG4gICAgICAgIH0pO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiRmlsZVwiLCBmaWxlLm5hbWUsIFwidXBsb2FkZWQgc3VjY2Vzc2Z1bGx5LlwiKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkNvbXBsZXRpbmcgbXVsdGlwYXJ0IHVwbG9hZC4uLlwiKTtcbiAgICAgICAgeWllbGQqIGNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkKHByZXNpZ25lZCwgZXRhZ3MpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiTXVsdGlwYXJ0IHVwbG9hZCBjb21wbGV0ZS5cIik7XG4gICAgfSk7XG4vKipcbiAqIFVzZWQgYnkgc2VydmVyIHVwbG9hZHMgd2hlcmUgcHJvZ3Jlc3MgaXMgbm90IG5lZWRlZC5cbiAqIFVzZXMgbm9ybWFsIGZldGNoIEFQSS5cbiAqLyBjb25zdCB1cGxvYWRQYXJ0ID0gKG9wdHMpPT5mZXRjaEVmZihvcHRzLnVybCwge1xuICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICAgIGJvZHk6IG9wdHMuY2h1bmssXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IG9wdHMuY29udGVudFR5cGUsXG4gICAgICAgICAgICBcIkNvbnRlbnQtRGlzcG9zaXRpb25cIjogY29udGVudERpc3Bvc2l0aW9uKG9wdHMuY29udGVudERpc3Bvc2l0aW9uLCBvcHRzLmZpbGVOYW1lKVxuICAgICAgICB9XG4gICAgfSkucGlwZShFZmZlY3QuYW5kVGhlbigocmVzKT0+cmVzLm9rICYmIHJlcy5oZWFkZXJzLmdldChcIkV0YWdcIikgPyBFZmZlY3Quc3VjY2VlZChyZXMuaGVhZGVycy5nZXQoXCJFdGFnXCIpKSA6IEVmZmVjdC5mYWlsKG5ldyBSZXRyeUVycm9yKCkpKSwgRWZmZWN0LnJldHJ5KHtcbiAgICAgICAgd2hpbGU6IChyZXMpPT5yZXMgaW5zdGFuY2VvZiBSZXRyeUVycm9yLFxuICAgICAgICBzY2hlZHVsZTogU2NoZWR1bGUuZXhwb25lbnRpYWwoRHVyYXRpb24ubWlsbGlzKDEwKSwgNCkucGlwZSgvLyAxMG1zLCA0MG1zLCAxNjBtcywgNjQwbXMuLi5cbiAgICAgICAgU2NoZWR1bGUuYW5kVGhlbkVpdGhlcihTY2hlZHVsZS5zcGFjZWQoRHVyYXRpb24uc2Vjb25kcygxKSkpLCBTY2hlZHVsZS5jb21wb3NlKFNjaGVkdWxlLmVsYXBzZWQpLCBTY2hlZHVsZS53aGlsZU91dHB1dChEdXJhdGlvbi5sZXNzVGhhbk9yRXF1YWxUbyhEdXJhdGlvbi5taW51dGVzKDEpKSkpLFxuICAgICAgICB0aW1lczogb3B0cy5tYXhSZXRyaWVzXG4gICAgfSksIEVmZmVjdC50YXBFcnJvclRhZyhcIlJldHJ5RXJyb3JcIiwgKCk9Pi8vIE1heCByZXRyaWVzIGV4Y2VlZGVkLCB0ZWxsIFVUIHNlcnZlciB0aGF0IHVwbG9hZCBmYWlsZWRcbiAgICAgICAgYWJvcnRNdWx0aXBhcnRVcGxvYWQoe1xuICAgICAgICAgICAga2V5OiBvcHRzLmtleSxcbiAgICAgICAgICAgIHVwbG9hZElkOiBvcHRzLnVwbG9hZElkXG4gICAgICAgIH0pLnBpcGUoRWZmZWN0LmFuZFRoZW4oKHJlcyk9PntcbiAgICAgICAgICAgIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIlVQTE9BRF9GQUlMRURcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHVwbG9hZCBmaWxlICR7b3B0cy5maWxlTmFtZX0gdG8gUzNgLFxuICAgICAgICAgICAgICAgIGNhdXNlOiByZXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSkpKTtcbmNvbnN0IGNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkID0gKHByZXNpZ25lZCwgZXRhZ3MpPT5mZXRjaEVmZihnZW5lcmF0ZVVwbG9hZFRoaW5nVVJMKFwiL3Y2L2NvbXBsZXRlTXVsdGlwYXJ0XCIpLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGZpbGVLZXk6IHByZXNpZ25lZC5rZXksXG4gICAgICAgICAgICB1cGxvYWRJZDogcHJlc2lnbmVkLnVwbG9hZElkLFxuICAgICAgICAgICAgZXRhZ3NcbiAgICAgICAgfSksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgIH1cbiAgICB9KS5waXBlKEVmZmVjdC5hbmRUaGVuKHBhcnNlUmVzcG9uc2VKc29uKSwgRWZmZWN0LmFuZFRoZW4oUy5kZWNvZGVVbmtub3duKFMuU3RydWN0KHtcbiAgICAgICAgc3VjY2VzczogUy5Cb29sZWFuLFxuICAgICAgICBtZXNzYWdlOiBTLm9wdGlvbmFsKFMuU3RyaW5nKVxuICAgIH0pKSksIEVmZmVjdC53aXRoU3BhbihcImNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkXCIsIHtcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgZXRhZ3MsXG4gICAgICAgICAgICBwcmVzaWduZWRcbiAgICAgICAgfVxuICAgIH0pKTtcbmNvbnN0IGFib3J0TXVsdGlwYXJ0VXBsb2FkID0gKHByZXNpZ25lZCk9PmZldGNoRWZmKGdlbmVyYXRlVXBsb2FkVGhpbmdVUkwoXCIvdjYvZmFpbHVyZUNhbGxiYWNrXCIpLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGZpbGVLZXk6IHByZXNpZ25lZC5rZXksXG4gICAgICAgICAgICB1cGxvYWRJZDogcHJlc2lnbmVkLnVwbG9hZElkXG4gICAgICAgIH0pLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9XG4gICAgfSkucGlwZShFZmZlY3QuYW5kVGhlbihwYXJzZVJlc3BvbnNlSnNvbiksIEVmZmVjdC5hbmRUaGVuKFMuZGVjb2RlVW5rbm93bihGYWlsdXJlQ2FsbGJhY2tSZXNwb25zZSkpLCBFZmZlY3Qud2l0aFNwYW4oXCJhYm9ydE11bHRpcGFydFVwbG9hZFwiLCB7XG4gICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgIHByZXNpZ25lZFxuICAgICAgICB9XG4gICAgfSkpO1xuXG5mdW5jdGlvbiBnZXRQYXJzZUZuKHBhcnNlcikge1xuICAgIGlmICh0eXBlb2YgcGFyc2VyLnBhcnNlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlci5wYXJzZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJzZXJcIik7XG59XG5cbmNvbnN0IGdldEFwaUtleSA9IChhcGlLZXkpPT57XG4gICAgaWYgKGFwaUtleSkgcmV0dXJuIGFwaUtleTtcbiAgICBpZiAocHJvY2Vzcy5lbnYuVVBMT0FEVEhJTkdfU0VDUkVUKSByZXR1cm4gcHJvY2Vzcy5lbnYuVVBMT0FEVEhJTkdfU0VDUkVUO1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG59O1xuY29uc3QgZ2V0QXBpS2V5T3JUaHJvdyA9IChhcGlLZXkpPT57XG4gICAgY29uc3Qga2V5ID0gZ2V0QXBpS2V5KGFwaUtleSk7XG4gICAgaWYgKCFrZXk/LnN0YXJ0c1dpdGgoXCJza19cIikpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJNSVNTSU5HX0VOVlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJNaXNzaW5nIG9yIGludmFsaWQgQVBJIGtleS4gQVBJIGtleXMgbXVzdCBzdGFydCB3aXRoIGBza19gLlwiXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4ga2V5O1xufTtcblxuY2xhc3MgRmlsZVNpemVNaXNtYXRjaCBleHRlbmRzIERhdGEuRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHR5cGUsIG1heCwgYWN0dWFsKXtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYFlvdSB1cGxvYWRlZCBhICR7dHlwZX0gZmlsZSB0aGF0IHdhcyAke2J5dGVzVG9GaWxlU2l6ZShhY3R1YWwpfSwgYnV0IHRoZSBsaW1pdCBmb3IgdGhhdCB0eXBlIGlzICR7bWF4fWA7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIHJlYXNvblxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGFnID0gXCJGaWxlU2l6ZU1pc21hdGNoXCI7XG4gICAgICAgIHRoaXMubmFtZSA9IFwiRmlsZVNpemVNaXNtYXRjaEVycm9yXCI7XG4gICAgfVxufVxuY2xhc3MgRmlsZUNvdW50TWlzbWF0Y2ggZXh0ZW5kcyBEYXRhLkVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlLCBib3VuZHR5cGUsIGJvdW5kLCBhY3R1YWwpe1xuICAgICAgICBjb25zdCByZWFzb24gPSBgWW91IHVwbG9hZGVkICR7YWN0dWFsfSBmaWxlKHMpIG9mIHR5cGUgJyR7dHlwZX0nLCBidXQgdGhlICR7Ym91bmR0eXBlfSBmb3IgdGhhdCB0eXBlIGlzICR7Ym91bmR9YDtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAgcmVhc29uXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90YWcgPSBcIkZpbGVDb3VudE1pc21hdGNoXCI7XG4gICAgICAgIHRoaXMubmFtZSA9IFwiRmlsZUNvdW50TWlzbWF0Y2hFcnJvclwiO1xuICAgIH1cbn1cbi8vIFZlcmlmeSB0aGF0IHRoZSB1cGxvYWRlZCBmaWxlcyBkb2Vzbid0IHZpb2xhdGUgdGhlIHJvdXRlIGNvbmZpZyxcbi8vIGUuZy4gdXBsb2FkaW5nIG1vcmUgdmlkZW9zIHRoYW4gYWxsb3dlZCwgb3IgYSBmaWxlIHRoYXQgaXMgbGFyZ2VyIHRoYW4gYWxsb3dlZC5cbi8vIFRoaXMgaXMgZG91YmxlLWNoZWNrZWQgb24gaW5mcmEgc2lkZSwgYnV0IHdlIHdhbnQgdG8gZmFpbCBlYXJseSB0byBhdm9pZCBuZXR3b3JrIGxhdGVuY3kuXG5jb25zdCBhc3NlcnRGaWxlc01lZXRDb25maWcgPSAoZmlsZXMsIHJvdXRlQ29uZmlnKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGNvdW50cyA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpe1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IHlpZWxkKiBnZXRUeXBlRnJvbUZpbGVOYW1lKGZpbGUubmFtZSwgb2JqZWN0S2V5cyhyb3V0ZUNvbmZpZykpO1xuICAgICAgICAgICAgY291bnRzW3R5cGVdID0gKGNvdW50c1t0eXBlXSA/PyAwKSArIDE7XG4gICAgICAgICAgICBjb25zdCBzaXplTGltaXQgPSByb3V0ZUNvbmZpZ1t0eXBlXT8ubWF4RmlsZVNpemU7XG4gICAgICAgICAgICBpZiAoIXNpemVMaW1pdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEludmFsaWRSb3V0ZUNvbmZpZ0Vycm9yKHR5cGUsIFwibWF4RmlsZVNpemVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzaXplTGltaXRCeXRlcyA9IHlpZWxkKiBmaWxlU2l6ZVRvQnl0ZXMoc2l6ZUxpbWl0KTtcbiAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPiBzaXplTGltaXRCeXRlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEZpbGVTaXplTWlzbWF0Y2godHlwZSwgc2l6ZUxpbWl0LCBmaWxlLnNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvcihjb25zdCBfa2V5IGluIGNvdW50cyl7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBfa2V5O1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0gcm91dGVDb25maWdba2V5XTtcbiAgICAgICAgICAgIGlmICghY29uZmlnKSByZXR1cm4geWllbGQqIG5ldyBJbnZhbGlkUm91dGVDb25maWdFcnJvcihrZXkpO1xuICAgICAgICAgICAgY29uc3QgY291bnQgPSBjb3VudHNba2V5XTtcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IGNvbmZpZy5taW5GaWxlQ291bnQ7XG4gICAgICAgICAgICBjb25zdCBtYXggPSBjb25maWcubWF4RmlsZUNvdW50O1xuICAgICAgICAgICAgaWYgKG1pbiA+IG1heCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBjb25maWcgZHVyaW5nIGZpbGUgY291bnQgLSBtaW5GaWxlQ291bnQgPiBtYXhGaWxlQ291bnRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGBtaW5GaWxlQ291bnQgbXVzdCBiZSBsZXNzIHRoYW4gbWF4RmlsZUNvdW50IGZvciBrZXkgJHtrZXl9LiBnb3Q6ICR7bWlufSA+ICR7bWF4fWBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb3VudCA8IG1pbikge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEZpbGVDb3VudE1pc21hdGNoKGtleSwgXCJtaW5pbXVtXCIsIG1pbiwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvdW50ID4gbWF4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgRmlsZUNvdW50TWlzbWF0Y2goa2V5LCBcIm1heGltdW1cIiwgbWF4LCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSk7XG5jbGFzcyBSZXF1ZXN0SW5wdXQgZXh0ZW5kcyAvKiogI19fUFVSRV9fICovIENvbnRleHQuVGFnKFwidXBsb2FkdGhpbmcvUmVxdWVzdElucHV0XCIpKCkge1xufVxuY29uc3QgcGFyc2VBbmRWYWxpZGF0ZVJlcXVlc3QgPSAoaW5wdXQsIG9wdHMsIGFkYXB0ZXIpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgY29uc3QgcmVxID0geWllbGQqIEVmZmVjdC5pc0VmZmVjdChpbnB1dC5yZXEpID8gaW5wdXQucmVxIDogRWZmZWN0LnN1Y2NlZWQoaW5wdXQucmVxKTtcbiAgICAgICAgLy8gR2V0IGlucHV0cyBmcm9tIHF1ZXJ5IGFuZCBwYXJhbXNcbiAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsKTtcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IHJlcS5oZWFkZXJzO1xuICAgICAgICBjb25zdCBwYXJhbXMgPSB1cmwuc2VhcmNoUGFyYW1zO1xuICAgICAgICBjb25zdCBhY3Rpb24gPSBwYXJhbXMuZ2V0KFwiYWN0aW9uVHlwZVwiKTtcbiAgICAgICAgY29uc3Qgc2x1ZyA9IHBhcmFtcy5nZXQoXCJzbHVnXCIpO1xuICAgICAgICBjb25zdCBob29rID0gaGVhZGVycy5nZXQoXCJ1cGxvYWR0aGluZy1ob29rXCIpO1xuICAgICAgICBjb25zdCB1dEZyb250ZW5kUGFja2FnZSA9IGhlYWRlcnMuZ2V0KFwieC11cGxvYWR0aGluZy1wYWNrYWdlXCIpID8/IFwidW5rbm93blwiO1xuICAgICAgICBjb25zdCBjbGllbnRWZXJzaW9uID0gaGVhZGVycy5nZXQoXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIik7XG4gICAgICAgIGNvbnN0IGFwaUtleSA9IGdldEFwaUtleShvcHRzLmNvbmZpZz8udXBsb2FkdGhpbmdTZWNyZXQpO1xuICAgICAgICBpZiAoY2xpZW50VmVyc2lvbiAhPSBudWxsICYmIGNsaWVudFZlcnNpb24gIT09IHZlcnNpb24pIHtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IoYENsaWVudCB2ZXJzaW9uIG1pc21hdGNoLiBTZXJ2ZXIgdmVyc2lvbjogJHt2ZXJzaW9ufSwgQ2xpZW50IHZlcnNpb246ICR7Y2xpZW50VmVyc2lvbn1gKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkNsaWVudCB2ZXJzaW9uIG1pc21hdGNoXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IGBTZXJ2ZXIgdmVyc2lvbjogJHt2ZXJzaW9ufSwgQ2xpZW50IHZlcnNpb246ICR7Y2xpZW50VmVyc2lvbn1gXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNsdWcpIHtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IoXCJObyBzbHVnIHByb3ZpZGVkIGluIHBhcmFtczpcIiwgcGFyYW1zKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIk5vIHNsdWcgcHJvdmlkZWQgaW4gcGFyYW1zXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzbHVnICYmIHR5cGVvZiBzbHVnICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgRXhwZWN0ZWQgc2x1ZyB0byBiZSBvZiB0eXBlICdzdHJpbmcnLCBnb3QgJyR7dHlwZW9mIHNsdWd9J2A7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJgc2x1Z2AgbXVzdCBiZSBhIHN0cmluZ1wiLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYXBpS2V5KSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgTm8gc2VjcmV0IHByb3ZpZGVkLCBwbGVhc2Ugc2V0IFVQTE9BRFRISU5HX1NFQ1JFVCBpbiB5b3VyIGVudiBmaWxlIG9yIGluIHRoZSBjb25maWdgO1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihtc2cpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJNSVNTSU5HX0VOVlwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBObyBzZWNyZXQgcHJvdmlkZWRgLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYXBpS2V5LnN0YXJ0c1dpdGgoXCJza19cIikpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBJbnZhbGlkIHNlY3JldCBwcm92aWRlZCwgVVBMT0FEVEhJTkdfU0VDUkVUIG11c3Qgc3RhcnQgd2l0aCAnc2tfJ2A7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIk1JU1NJTkdfRU5WXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIEFQSSBrZXkuIEFQSSBrZXlzIG11c3Qgc3RhcnQgd2l0aCAnc2tfJy5cIixcbiAgICAgICAgICAgICAgICBjYXVzZTogbXNnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXRGcm9udGVuZFBhY2thZ2UgJiYgdHlwZW9mIHV0RnJvbnRlbmRQYWNrYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgRXhwZWN0ZWQgeC11cGxvYWR0aGluZy1wYWNrYWdlIHRvIGJlIG9mIHR5cGUgJ3N0cmluZycsIGdvdCAnJHt0eXBlb2YgdXRGcm9udGVuZFBhY2thZ2V9J2A7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJgeC11cGxvYWR0aGluZy1wYWNrYWdlYCBtdXN0IGJlIGEgc3RyaW5nLiBlZy4gJ0B1cGxvYWR0aGluZy9yZWFjdCdcIixcbiAgICAgICAgICAgICAgICBjYXVzZTogbXNnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGxvYWRhYmxlID0gb3B0cy5yb3V0ZXJbc2x1Z107XG4gICAgICAgIGlmICghdXBsb2FkYWJsZSkge1xuICAgICAgICAgICAgY29uc3QgbXNnID0gYE5vIGZpbGUgcm91dGUgZm91bmQgZm9yIHNsdWcgJHtzbHVnfWA7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIk5PVF9GT1VORFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1zZ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjdGlvbiAmJiAhaXNBY3Rpb25UeXBlKGFjdGlvbikpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBFeHBlY3RlZCAke1ZBTElEX0FDVElPTl9UWVBFUy5tYXAoKHgpPT5gXCIke3h9XCJgKS5qb2luKFwiLCBcIikucmVwbGFjZSgvLCg/IS4qLCkvLCBcIiBvclwiKX0gYnV0IGdvdCBcIiR7YWN0aW9ufVwiYDtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IoXCJJbnZhbGlkIGFjdGlvbiB0eXBlXCIsIG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IGBJbnZhbGlkIGFjdGlvbiB0eXBlICR7YWN0aW9ufWAsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogbXNnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaG9vayAmJiAhaXNVcGxvYWRUaGluZ0hvb2soaG9vaykpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBFeHBlY3RlZCAke1ZBTElEX1VUX0hPT0tTLm1hcCgoeCk9PmBcIiR7eH1cImApLmpvaW4oXCIsIFwiKS5yZXBsYWNlKC8sKD8hLiosKS8sIFwiIG9yXCIpfSBidXQgZ290IFwiJHtob29rfVwiYDtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IoXCJJbnZhbGlkIHVwbG9hZHRoaW5nIGhvb2tcIiwgbXNnKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBjYXVzZTogYEludmFsaWQgdXBsb2FkdGhpbmcgaG9vayAke2hvb2t9YCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYWN0aW9uICYmICFob29rIHx8IGFjdGlvbiAmJiBob29rKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgRXhhY3RseSBvbmUgb2YgJ2FjdGlvblR5cGUnIG9yICd1cGxvYWR0aGluZy1ob29rJyBtdXN0IGJlIHByb3ZpZGVkYDtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IobXNnKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCLinJTvuI4gQWxsIHJlcXVlc3QgaW5wdXQgaXMgdmFsaWRcIik7XG4gICAgICAgIC8vIEZJWE1FOiBUaGlzIHNob3VsZCBwcm9iYWJseSBwcm92aWRlIHRoZSBmdWxsIGNvbnRleHQgYXQgb25jZSBpbnN0ZWFkIG9mXG4gICAgICAgIC8vIHBhcnRpYWxseSBpbiB0aGUgYHJ1blJlcXVlc3RIYW5kbGVyQXN5bmNgIGFuZCBwYXJ0aWFsbHkgaW4gaGVyZS4uLlxuICAgICAgICAvLyBSZWY6IGh0dHBzOi8vZGlzY29yZC5jb20vY2hhbm5lbHMvQG1lLzEyMDE5NzcxNTQ1Nzc4OTEzNjkvMTIwNzQ0MTgzOTk3MjU0ODY2OVxuICAgICAgICBjb25zdCBjb250ZXh0VmFsdWUgPSB5aWVsZCogRmV0Y2hDb250ZXh0O1xuICAgICAgICBjb250ZXh0VmFsdWUuYmFzZUhlYWRlcnNbXCJ4LXVwbG9hZHRoaW5nLWFwaS1rZXlcIl0gPSBhcGlLZXk7XG4gICAgICAgIGNvbnRleHRWYWx1ZS5iYXNlSGVhZGVyc1tcIngtdXBsb2FkdGhpbmctZmUtcGFja2FnZVwiXSA9IHV0RnJvbnRlbmRQYWNrYWdlO1xuICAgICAgICBjb250ZXh0VmFsdWUuYmFzZUhlYWRlcnNbXCJ4LXVwbG9hZHRoaW5nLWJlLWFkYXB0ZXJcIl0gPSBhZGFwdGVyO1xuICAgICAgICBjb25zdCB7IGlzRGV2ID0gaXNEZXZlbG9wbWVudCB9ID0gb3B0cy5jb25maWcgPz8ge307XG4gICAgICAgIGlmIChpc0RldikgeWllbGQqIEVmZmVjdC5sb2dJbmZvKFwiVXBsb2FkVGhpbmcgZGV2IHNlcnZlciBpcyBub3cgcnVubmluZyFcIik7XG4gICAgICAgIGNvbnN0IGJhc2UgPSB7XG4gICAgICAgICAgICByZXEsXG4gICAgICAgICAgICBjb25maWc6IG9wdHMuY29uZmlnID8/IHt9LFxuICAgICAgICAgICAgbWlkZGxld2FyZUFyZ3M6IGlucHV0Lm1pZGRsZXdhcmVBcmdzLFxuICAgICAgICAgICAgaXNEZXYsXG4gICAgICAgICAgICBhcGlLZXksXG4gICAgICAgICAgICBzbHVnLFxuICAgICAgICAgICAgdXBsb2FkYWJsZSxcbiAgICAgICAgICAgIGhvb2s6IG51bGwsXG4gICAgICAgICAgICBhY3Rpb246IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGFjdGlvbiA/IHtcbiAgICAgICAgICAgIC4uLmJhc2UsXG4gICAgICAgICAgICBhY3Rpb246IGFjdGlvblxuICAgICAgICB9IDoge1xuICAgICAgICAgICAgLi4uYmFzZSxcbiAgICAgICAgICAgIGhvb2s6IGhvb2tcbiAgICAgICAgfTtcbiAgICB9KTtcblxuY29uc3QgcmVzb2x2ZUNhbGxiYWNrVXJsID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgY29uc3QgeyBjb25maWcsIHJlcSwgaXNEZXYgfSA9IHlpZWxkKiBSZXF1ZXN0SW5wdXQ7XG4gICAgbGV0IGNhbGxiYWNrVXJsID0gbmV3IFVSTChyZXEudXJsKTtcbiAgICBpZiAoY29uZmlnPy5jYWxsYmFja1VybCkge1xuICAgICAgICBjYWxsYmFja1VybCA9IHlpZWxkKiBnZXRGdWxsQXBpVXJsKGNvbmZpZy5jYWxsYmFja1VybCk7XG4gICAgfSBlbHNlIGlmIChwcm9jZXNzLmVudi5VUExPQURUSElOR19VUkwpIHtcbiAgICAgICAgY2FsbGJhY2tVcmwgPSB5aWVsZCogZ2V0RnVsbEFwaVVybChwcm9jZXNzLmVudi5VUExPQURUSElOR19VUkwpO1xuICAgIH1cbiAgICBpZiAoaXNEZXYgfHwgIWNhbGxiYWNrVXJsLmhvc3QuaW5jbHVkZXMoXCJsb2NhbGhvc3RcIikpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrVXJsO1xuICAgIH1cbiAgICAvLyBQcm9kdWN0aW9uIGJ1aWxkcyBoYXZlIHRvIGhhdmUgYSBwdWJsaWMgVVJMIHNvIFVUIGNhbiBzZW5kIHdlYmhvb2tcbiAgICAvLyBQYXJzZSB0aGUgVVJMIGZyb20gdGhlIGhlYWRlcnNcbiAgICBsZXQgcGFyc2VkRnJvbUhlYWRlcnMgPSByZXEuaGVhZGVycy5nZXQoXCJvcmlnaW5cIikgPz8gcmVxLmhlYWRlcnMuZ2V0KFwicmVmZXJlclwiKSA/PyByZXEuaGVhZGVycy5nZXQoXCJob3N0XCIpID8/IHJlcS5oZWFkZXJzLmdldChcIngtZm9yd2FyZGVkLWhvc3RcIik7XG4gICAgaWYgKHBhcnNlZEZyb21IZWFkZXJzICYmICFwYXJzZWRGcm9tSGVhZGVycy5pbmNsdWRlcyhcImh0dHBcIikpIHtcbiAgICAgICAgcGFyc2VkRnJvbUhlYWRlcnMgPSAocmVxLmhlYWRlcnMuZ2V0KFwieC1mb3J3YXJkZWQtcHJvdG9cIikgPz8gXCJodHRwc1wiKSArIFwiOi8vXCIgKyBwYXJzZWRGcm9tSGVhZGVycztcbiAgICB9XG4gICAgaWYgKCFwYXJzZWRGcm9tSGVhZGVycyB8fCBwYXJzZWRGcm9tSGVhZGVycy5pbmNsdWRlcyhcImxvY2FsaG9zdFwiKSkge1xuICAgICAgICAvLyBEaWRuJ3QgZmluZCBhIHZhbGlkIFVSTCBpbiB0aGUgaGVhZGVycywgbG9nIGEgd2FybmluZyBhbmQgdXNlIHRoZSBvcmlnaW5hbCB1cmwgYW55d2F5XG4gICAgICAgIEVmZmVjdC5sb2dXYXJuaW5nKFwiWW91IGFyZSB1c2luZyBhIGxvY2FsaG9zdCBjYWxsYmFjayB1cmwgaW4gcHJvZHVjdGlvbiB3aGljaCBpcyBub3Qgc3VwcG9ydGVkLlwiLCBcIlJlYWQgbW9yZSBhbmQgbGVhcm4gaG93IHRvIGZpeCBpdCBoZXJlOiBodHRwczovL2RvY3MudXBsb2FkdGhpbmcuY29tL2ZhcSNteS1jYWxsYmFjay1ydW5zLWluLWRldmVsb3BtZW50LWJ1dC1ub3QtaW4tcHJvZHVjdGlvblwiKTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrVXJsO1xuICAgIH1cbiAgICByZXR1cm4geWllbGQqIGdldEZ1bGxBcGlVcmwocGFyc2VkRnJvbUhlYWRlcnMpO1xufSk7XG5cbi8qKlxuICogQWxsb3dzIGFkYXB0ZXJzIHRvIGJlIGZ1bGx5IGFzeW5jL2F3YWl0IGluc3RlYWQgb2YgcHJvdmlkaW5nIHNlcnZpY2VzIGFuZCBydW5uaW5nIEVmZmVjdCBwcm9ncmFtc1xuICovIGNvbnN0IHJ1blJlcXVlc3RIYW5kbGVyQXN5bmMgPSAoaGFuZGxlciwgYXJncywgY29uZmlnKT0+aGFuZGxlcihhcmdzKS5waXBlKHdpdGhNaW5pbWFsTG9nTGV2ZWwoY29uZmlnPy5sb2dMZXZlbCksIEVmZmVjdC5wcm92aWRlKENvbnNvbGFMb2dnZXIpLCBFZmZlY3QucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB7XG4gICAgICAgIGZldGNoOiBjb25maWc/LmZldGNoID8/IGdsb2JhbFRoaXMuZmV0Y2gsXG4gICAgICAgIGJhc2VIZWFkZXJzOiB7XG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uLFxuICAgICAgICAgICAgLy8gVGhlc2UgYXJlIGZpbGxlZCBpbiBsYXRlciBpbiBgcGFyc2VBbmRWYWxpZGF0ZVJlcXVlc3RgXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYXBpLWtleVwiOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYmUtYWRhcHRlclwiOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctZmUtcGFja2FnZVwiOiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgIH0pLCBhc0hhbmRsZXJPdXRwdXQsIEVmZmVjdC5ydW5Qcm9taXNlKTtcbmNvbnN0IGFzSGFuZGxlck91dHB1dCA9IChlZmZlY3QpPT5FZmZlY3QuY2F0Y2hBbGwoZWZmZWN0LCAoZXJyb3IpPT5FZmZlY3Quc3VjY2VlZCh7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yXG4gICAgICAgIH0pKTtcbmNvbnN0IGhhbmRsZVJlcXVlc3QgPSBSZXF1ZXN0SW5wdXQucGlwZShFZmZlY3QuYW5kVGhlbigoeyBhY3Rpb24sIGhvb2sgfSk9PntcbiAgICBpZiAoaG9vayA9PT0gXCJjYWxsYmFja1wiKSByZXR1cm4gaGFuZGxlQ2FsbGJhY2tSZXF1ZXN0O1xuICAgIHN3aXRjaChhY3Rpb24pe1xuICAgICAgICBjYXNlIFwidXBsb2FkXCI6XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlVXBsb2FkQWN0aW9uO1xuICAgICAgICBjYXNlIFwibXVsdGlwYXJ0LWNvbXBsZXRlXCI6XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlTXVsdGlwYXJ0Q29tcGxldGVBY3Rpb247XG4gICAgICAgIGNhc2UgXCJmYWlsdXJlXCI6XG4gICAgICAgICAgICByZXR1cm4gaGFuZGxlTXVsdGlwYXJ0RmFpbHVyZUFjdGlvbjtcbiAgICB9XG59KSwgRWZmZWN0Lm1hcCgob3V0cHV0KT0+KHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgLi4ub3V0cHV0XG4gICAgfSkpKTtcbmNvbnN0IGJ1aWxkUmVxdWVzdEhhbmRsZXIgPSAob3B0cywgYWRhcHRlcik9PihpbnB1dCk9PmhhbmRsZVJlcXVlc3QucGlwZShFZmZlY3QucHJvdmlkZVNlcnZpY2VFZmZlY3QoUmVxdWVzdElucHV0LCBwYXJzZUFuZFZhbGlkYXRlUmVxdWVzdChpbnB1dCwgb3B0cywgYWRhcHRlcikpLCBFZmZlY3QuY2F0Y2hUYWdzKHtcbiAgICAgICAgICAgIEludmFsaWRKc29uOiAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJBbiBlcnJvciBvY2N1cmVkIHdoaWxlIHBhcnNpbmcgaW5wdXQvb3V0cHV0XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBCYWRSZXF1ZXN0RXJyb3I6IChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlLmdldE1lc3NhZ2UoKSxcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGUuanNvblxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgRmV0Y2hFcnJvcjogKGUpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHR5cGVvZiBlLmVycm9yID09PSBcInN0cmluZ1wiID8gZS5lcnJvciA6IGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGUuZXJyb3JcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIFBhcnNlRXJyb3I6IChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkFuIGVycm9yIG9jY3VyZWQgd2hpbGUgcGFyc2luZyBpbnB1dC9vdXRwdXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KSwgRWZmZWN0LnRhcEVycm9yKChlKT0+RWZmZWN0LmxvZ0Vycm9yKGUubWVzc2FnZSkpKTtcbmNvbnN0IGhhbmRsZUNhbGxiYWNrUmVxdWVzdCA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgIGNvbnN0IHsgcmVxLCB1cGxvYWRhYmxlLCBhcGlLZXkgfSA9IHlpZWxkKiBSZXF1ZXN0SW5wdXQ7XG4gICAgY29uc3QgdmVyaWZpZWQgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICB0cnk6IGFzeW5jICgpPT52ZXJpZnlTaWduYXR1cmUoYXdhaXQgcmVxLmNsb25lKCkudGV4dCgpLCByZXEuaGVhZGVycy5nZXQoXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiKSwgYXBpS2V5KSxcbiAgICAgICAgY2F0Y2g6ICgpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBzaWduYXR1cmVcIlxuICAgICAgICAgICAgfSlcbiAgICB9KTtcbiAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiU2lnbmF0dXJlIHZlcmlmaWVkOlwiLCB2ZXJpZmllZCk7XG4gICAgaWYgKCF2ZXJpZmllZCkge1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKFwiSW52YWxpZCBzaWduYXR1cmVcIik7XG4gICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNpZ25hdHVyZVwiXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCByZXF1ZXN0SW5wdXQgPSB5aWVsZCogRWZmZWN0LmZsYXRNYXAocGFyc2VSZXF1ZXN0SnNvbihyZXEpLCBTLmRlY29kZVVua25vd24oUy5TdHJ1Y3Qoe1xuICAgICAgICBzdGF0dXM6IFMuU3RyaW5nLFxuICAgICAgICBmaWxlOiBVcGxvYWRlZEZpbGVEYXRhLFxuICAgICAgICBtZXRhZGF0YTogUy5SZWNvcmQoUy5TdHJpbmcsIFMuVW5rbm93bilcbiAgICB9KSkpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJIYW5kbGluZyBjYWxsYmFjayByZXF1ZXN0IHdpdGggaW5wdXQ6XCIsIHJlcXVlc3RJbnB1dCk7XG4gICAgY29uc3Qgc2VydmVyRGF0YSA9IHlpZWxkKiBFZmZlY3QudHJ5UHJvbWlzZSh7XG4gICAgICAgIHRyeTogYXN5bmMgKCk9PnVwbG9hZGFibGUucmVzb2x2ZXIoe1xuICAgICAgICAgICAgICAgIGZpbGU6IHJlcXVlc3RJbnB1dC5maWxlLFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiByZXF1ZXN0SW5wdXQubWV0YWRhdGFcbiAgICAgICAgICAgIH0pLFxuICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcnVuIG9uVXBsb2FkQ29tcGxldGVcIixcbiAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgIH0pXG4gICAgfSkucGlwZShFZmZlY3QudGFwRXJyb3IoKGVycm9yKT0+RWZmZWN0LmxvZ0Vycm9yKFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZENvbXBsZXRlLiBZb3UgcHJvYmFibHkgc2hvdWxkbid0IGJlIHRocm93aW5nIGVycm9ycyBoZXJlLlwiLCBlcnJvcikpKTtcbiAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICBmaWxlS2V5OiByZXF1ZXN0SW5wdXQuZmlsZS5rZXksXG4gICAgICAgIGNhbGxiYWNrRGF0YTogc2VydmVyRGF0YSA/PyBudWxsXG4gICAgfTtcbiAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiJ29uVXBsb2FkQ29tcGxldGUnIGNhbGxiYWNrIGZpbmlzaGVkLiBTZW5kaW5nIHJlc3BvbnNlIHRvIFVwbG9hZFRoaW5nOlwiLCBwYXlsb2FkKTtcbiAgICB5aWVsZCogZmV0Y2hFZmYoZ2VuZXJhdGVVcGxvYWRUaGluZ1VSTChcIi92Ni9zZXJ2ZXJDYWxsYmFja1wiKSwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfVxuICAgIH0pLnBpcGUoRWZmZWN0LmFuZFRoZW4ocGFyc2VSZXNwb25zZUpzb24pLCBFZmZlY3QuYW5kVGhlbihTLmRlY29kZVVua25vd24oU2VydmVyQ2FsbGJhY2tQb3N0UmVzcG9uc2UpKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYm9keTogbnVsbFxuICAgIH07XG59KTtcbmNvbnN0IHJ1blJvdXRlTWlkZGxld2FyZSA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkYWJsZSwgbWlkZGxld2FyZUFyZ3MgfSA9IHlpZWxkKiBSZXF1ZXN0SW5wdXQ7XG4gICAgICAgIGNvbnN0IHsgZmlsZXMsIGlucHV0IH0gPSBvcHRzO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUnVubmluZyBtaWRkbGV3YXJlXCIpO1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHlpZWxkKiBFZmZlY3QudHJ5UHJvbWlzZSh7XG4gICAgICAgICAgICB0cnk6IGFzeW5jICgpPT51cGxvYWRhYmxlLl9kZWYubWlkZGxld2FyZSh7XG4gICAgICAgICAgICAgICAgICAgIC4uLm1pZGRsZXdhcmVBcmdzLFxuICAgICAgICAgICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNhdGNoOiAoZXJyb3IpPT5lcnJvciBpbnN0YW5jZW9mIFVwbG9hZFRoaW5nRXJyb3IgPyBlcnJvciA6IG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcnVuIG1pZGRsZXdhcmVcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSkucGlwZShFZmZlY3QudGFwRXJyb3IoKGVycm9yKT0+RWZmZWN0LmxvZ0Vycm9yKFwiQW4gZXJyb3Igb2NjdXJlZCBpbiB5b3VyIG1pZGRsZXdhcmUgZnVuY3Rpb25cIiwgZXJyb3IpKSk7XG4gICAgICAgIGlmIChtZXRhZGF0YVtVVEZpbGVzXSAmJiBtZXRhZGF0YVtVVEZpbGVzXS5sZW5ndGggIT09IGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgbXNnID0gYEV4cGVjdGVkIGZpbGVzIG92ZXJyaWRlIHRvIGhhdmUgdGhlIHNhbWUgbGVuZ3RoIGFzIG9yaWdpbmFsIGZpbGVzLCBnb3QgJHttZXRhZGF0YVtVVEZpbGVzXS5sZW5ndGh9IGJ1dCBleHBlY3RlZCAke2ZpbGVzLmxlbmd0aH1gO1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihtc2cpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmlsZXMgb3ZlcnJpZGUgbXVzdCBoYXZlIHRoZSBzYW1lIGxlbmd0aCBhcyBmaWxlc1wiLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBtc2dcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIEF0dGFjaCBjdXN0b21JZHMgZnJvbSBtaWRkbGV3YXJlIHRvIHRoZSBmaWxlc1xuICAgICAgICBjb25zdCBmaWxlc1dpdGhDdXN0b21JZHMgPSB5aWVsZCogRWZmZWN0LmZvckVhY2goZmlsZXMsIChmaWxlLCBpZHgpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aGVpcnMgPSBtZXRhZGF0YVtVVEZpbGVzXT8uW2lkeF07XG4gICAgICAgICAgICAgICAgaWYgKHRoZWlycyAmJiB0aGVpcnMuc2l6ZSAhPT0gZmlsZS5zaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nV2FybmluZyhcIkZpbGUgc2l6ZSBtaXNtYXRjaC4gUmV2ZXJ0aW5nIHRvIG9yaWdpbmFsIHNpemVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoZWlycz8ubmFtZSA/PyBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSWQ6IHRoZWlycz8uY3VzdG9tSWRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWV0YWRhdGEsXG4gICAgICAgICAgICBmaWxlc1dpdGhDdXN0b21JZHNcbiAgICAgICAgfTtcbiAgICB9KTtcbmNvbnN0IGhhbmRsZVVwbG9hZEFjdGlvbiA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgIGNvbnN0IG9wdHMgPSB5aWVsZCogUmVxdWVzdElucHV0O1xuICAgIGNvbnN0IHsgZmlsZXMsIGlucHV0IH0gPSB5aWVsZCogRWZmZWN0LmZsYXRNYXAocGFyc2VSZXF1ZXN0SnNvbihvcHRzLnJlcSksIFMuZGVjb2RlVW5rbm93bihVcGxvYWRBY3Rpb25QYXlsb2FkKSk7XG4gICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIHVwbG9hZCByZXF1ZXN0IHdpdGggaW5wdXQ6XCIsIHtcbiAgICAgICAgZmlsZXMsXG4gICAgICAgIGlucHV0XG4gICAgfSk7XG4gICAgLy8gdmFsaWRhdGUgdGhlIGlucHV0XG4gICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlBhcnNpbmcgdXNlciBpbnB1dFwiKTtcbiAgICBjb25zdCBpbnB1dFBhcnNlciA9IG9wdHMudXBsb2FkYWJsZS5fZGVmLmlucHV0UGFyc2VyO1xuICAgIGNvbnN0IHBhcnNlZElucHV0ID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgdHJ5OiBhc3luYyAoKT0+Z2V0UGFyc2VGbihpbnB1dFBhcnNlcikoaW5wdXQpLFxuICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgaW5wdXRcIixcbiAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgIH0pXG4gICAgfSkucGlwZShFZmZlY3QudGFwRXJyb3IoKGVycm9yKT0+RWZmZWN0LmxvZ0Vycm9yKFwiQW4gZXJyb3Igb2NjdXJlZCB0cnlpbmcgdG8gcGFyc2UgaW5wdXRcIiwgZXJyb3IpKSk7XG4gICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIklucHV0IHBhcnNlZCBzdWNjZXNzZnVsbHlcIiwgcGFyc2VkSW5wdXQpO1xuICAgIGNvbnN0IHsgbWV0YWRhdGEsIGZpbGVzV2l0aEN1c3RvbUlkcyB9ID0geWllbGQqIHJ1blJvdXRlTWlkZGxld2FyZSh7XG4gICAgICAgIGlucHV0OiBwYXJzZWRJbnB1dCxcbiAgICAgICAgZmlsZXNcbiAgICB9KTtcbiAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUGFyc2luZyByb3V0ZSBjb25maWdcIiwgb3B0cy51cGxvYWRhYmxlLl9kZWYucm91dGVyQ29uZmlnKTtcbiAgICBjb25zdCBwYXJzZWRDb25maWcgPSB5aWVsZCogZmlsbElucHV0Um91dGVDb25maWcob3B0cy51cGxvYWRhYmxlLl9kZWYucm91dGVyQ29uZmlnKS5waXBlKEVmZmVjdC5jYXRjaFRhZyhcIkludmFsaWRSb3V0ZUNvbmZpZ1wiLCAoZXJyKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIGNvbmZpZ1wiLFxuICAgICAgICAgICAgY2F1c2U6IGVyclxuICAgICAgICB9KSkpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJSb3V0ZSBjb25maWcgcGFyc2VkIHN1Y2Nlc3NmdWxseVwiLCBwYXJzZWRDb25maWcpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJWYWxpZGF0aW5nIGZpbGVzIG1lZXQgdGhlIGNvbmZpZyByZXF1aXJlbWVudHNcIiwgZmlsZXMpO1xuICAgIHlpZWxkKiBhc3NlcnRGaWxlc01lZXRDb25maWcoZmlsZXMsIHBhcnNlZENvbmZpZykucGlwZShFZmZlY3QubWFwRXJyb3IoKGUpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBgSW52YWxpZCBjb25maWc6ICR7ZS5fdGFnfWAsXG4gICAgICAgICAgICBjYXVzZTogXCJyZWFzb25cIiBpbiBlID8gZS5yZWFzb24gOiBlLm1lc3NhZ2VcbiAgICAgICAgfSkpKTtcbiAgICBjb25zdCBjYWxsYmFja1VybCA9IHlpZWxkKiByZXNvbHZlQ2FsbGJhY2tVcmwucGlwZShFZmZlY3QudGFwRXJyb3IoKGVycm9yKT0+RWZmZWN0LmxvZ0Vycm9yKFwiRmFpbGVkIHRvIHJlc29sdmUgY2FsbGJhY2sgVVJMXCIsIGVycm9yKSksIEVmZmVjdC5jYXRjaFRhZyhcIkludmFsaWRVUkxcIiwgKGVycik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZVxuICAgICAgICB9KSkpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJSZXRyaWV2aW5nIHByZXNpZ25lZCBVUkxzIGZyb20gVXBsb2FkVGhpbmcuIENhbGxiYWNrIFVSTCBpczpcIiwgY2FsbGJhY2tVcmwuaHJlZik7XG4gICAgY29uc3QgcHJlc2lnbmVkVXJscyA9IHlpZWxkKiBmZXRjaEVmZihnZW5lcmF0ZVVwbG9hZFRoaW5nVVJMKFwiL3Y2L3ByZXBhcmVVcGxvYWRcIiksIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgZmlsZXM6IGZpbGVzV2l0aEN1c3RvbUlkcyxcbiAgICAgICAgICAgIHJvdXRlQ29uZmlnOiBwYXJzZWRDb25maWcsXG4gICAgICAgICAgICBtZXRhZGF0YSxcbiAgICAgICAgICAgIGNhbGxiYWNrVXJsOiBjYWxsYmFja1VybC5vcmlnaW4gKyBjYWxsYmFja1VybC5wYXRobmFtZSxcbiAgICAgICAgICAgIGNhbGxiYWNrU2x1Zzogb3B0cy5zbHVnXG4gICAgICAgIH0pLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICB9XG4gICAgfSkucGlwZShFZmZlY3QuYW5kVGhlbihwYXJzZVJlc3BvbnNlSnNvbiksIEVmZmVjdC5hbmRUaGVuKFMuZGVjb2RlVW5rbm93bihQcmVzaWduZWRVUkxSZXNwb25zZSkpKTtcbiAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiVXBsb2FkVGhpbmcgcmVzcG9uZGVkIHdpdGg6XCIsIHByZXNpZ25lZFVybHMpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJTZW5kaW5nIHByZXNpZ25lZCBVUkxzIHRvIGNsaWVudFwiKTtcbiAgICBsZXQgcHJvbWlzZSA9IHVuZGVmaW5lZDtcbiAgICBpZiAob3B0cy5pc0Rldikge1xuICAgICAgICBjb25zdCBmZXRjaENvbnRleHQgPSB5aWVsZCogRmV0Y2hDb250ZXh0O1xuICAgICAgICBwcm9taXNlID0gRWZmZWN0LmZvckVhY2gocHJlc2lnbmVkVXJscywgKHByZXNpZ25lZCk9PmNvbmRpdGlvbmFsRGV2U2VydmVyKHByZXNpZ25lZCwgb3B0cy5hcGlLZXkpLnBpcGUoRWZmZWN0LmVpdGhlciksIHtcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiAxMFxuICAgICAgICB9KS5waXBlKEVmZmVjdC5wcm92aWRlKENvbnNvbGFMb2dnZXIpLCBFZmZlY3QucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCBmZXRjaENvbnRleHQpLCBFZmZlY3QucnVuUHJvbWlzZSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGJvZHk6IHByZXNpZ25lZFVybHMsXG4gICAgICAgIGNsZWFudXA6IHByb21pc2VcbiAgICB9O1xufSk7XG5jb25zdCBoYW5kbGVNdWx0aXBhcnRDb21wbGV0ZUFjdGlvbiA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgIGNvbnN0IG9wdHMgPSB5aWVsZCogUmVxdWVzdElucHV0O1xuICAgIGNvbnN0IHJlcXVlc3RJbnB1dCA9IHlpZWxkKiBFZmZlY3QuZmxhdE1hcChwYXJzZVJlcXVlc3RKc29uKG9wdHMucmVxKSwgUy5kZWNvZGVVbmtub3duKE11bHRpcGFydENvbXBsZXRlQWN0aW9uUGF5bG9hZCkpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJIYW5kbGluZyBtdWx0aXBhcnQtY29tcGxldGUgcmVxdWVzdCB3aXRoIGlucHV0OlwiLCByZXF1ZXN0SW5wdXQpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJOb3RpZnlpbmcgVXBsb2FkVGhpbmcgdGhhdCBtdWx0aXBhcnQgdXBsb2FkIGlzIGNvbXBsZXRlXCIpO1xuICAgIGNvbnN0IGNvbXBsZXRpb25SZXNwb25zZSA9IHlpZWxkKiBjb21wbGV0ZU11bHRpcGFydFVwbG9hZCh7XG4gICAgICAgIGtleTogcmVxdWVzdElucHV0LmZpbGVLZXksXG4gICAgICAgIHVwbG9hZElkOiByZXF1ZXN0SW5wdXQudXBsb2FkSWRcbiAgICB9LCByZXF1ZXN0SW5wdXQuZXRhZ3MpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJVcGxvYWRUaGluZyByZXNwb25kZWQgd2l0aDpcIiwgY29tcGxldGlvblJlc3BvbnNlKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBib2R5OiBudWxsXG4gICAgfTtcbn0pO1xuY29uc3QgaGFuZGxlTXVsdGlwYXJ0RmFpbHVyZUFjdGlvbiA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgIGNvbnN0IHsgcmVxLCB1cGxvYWRhYmxlIH0gPSB5aWVsZCogUmVxdWVzdElucHV0O1xuICAgIGNvbnN0IHsgZmlsZUtleSwgdXBsb2FkSWQgfSA9IHlpZWxkKiBFZmZlY3QuZmxhdE1hcChwYXJzZVJlcXVlc3RKc29uKHJlcSksIFMuZGVjb2RlVW5rbm93bihGYWlsdXJlQWN0aW9uUGF5bG9hZCkpO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJIYW5kbGluZyBmYWlsdXJlIHJlcXVlc3Qgd2l0aCBpbnB1dDpcIiwge1xuICAgICAgICBmaWxlS2V5LFxuICAgICAgICB1cGxvYWRJZFxuICAgIH0pO1xuICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJOb3RpZnlpbmcgVXBsb2FkVGhpbmcgdGhhdCB1cGxvYWQgZmFpbGVkXCIpO1xuICAgIGNvbnN0IGZhaWx1cmVSZXNwb25zZSA9IHlpZWxkKiBhYm9ydE11bHRpcGFydFVwbG9hZCh7XG4gICAgICAgIGtleTogZmlsZUtleSxcbiAgICAgICAgdXBsb2FkSWRcbiAgICB9KTtcbiAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiVXBsb2FkVGhpbmcgcmVzcG9uZGVkIHdpdGg6XCIsIGZhaWx1cmVSZXNwb25zZSk7XG4gICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJ1bm5pbmcgJ29uVXBsb2FkRXJyb3InIGNhbGxiYWNrXCIpO1xuICAgIHlpZWxkKiBFZmZlY3QudHJ5KHtcbiAgICAgICAgdHJ5OiAoKT0+e1xuICAgICAgICAgICAgdXBsb2FkYWJsZS5fZGVmLm9uVXBsb2FkRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGVycm9yOiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiVVBMT0FEX0ZBSUxFRFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgVXBsb2FkIGZhaWxlZCBmb3IgJHtmaWxlS2V5fWBcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBmaWxlS2V5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgY2F0Y2g6IChlcnJvcik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZEVycm9yXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICB9KVxuICAgIH0pLnBpcGUoRWZmZWN0LnRhcEVycm9yKChlcnJvcik9PkVmZmVjdC5sb2dFcnJvcihcIkZhaWxlZCB0byBydW4gb25VcGxvYWRFcnJvci4gWW91IHByb2JhYmx5IHNob3VsZG4ndCBiZSB0aHJvd2luZyBlcnJvcnMgaGVyZS5cIiwgZXJyb3IpKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYm9keTogbnVsbFxuICAgIH07XG59KTtcbmNvbnN0IGJ1aWxkUGVybWlzc2lvbnNJbmZvSGFuZGxlciA9IChvcHRzKT0+e1xuICAgIHJldHVybiAoKT0+e1xuICAgICAgICBjb25zdCBwZXJtaXNzaW9ucyA9IG9iamVjdEtleXMob3B0cy5yb3V0ZXIpLm1hcCgoc2x1Zyk9PntcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gb3B0cy5yb3V0ZXJbc2x1Z107XG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSBFZmZlY3QucnVuU3luYyhmaWxsSW5wdXRSb3V0ZUNvbmZpZyhyb3V0ZS5fZGVmLnJvdXRlckNvbmZpZykpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzbHVnLFxuICAgICAgICAgICAgICAgIGNvbmZpZ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBwZXJtaXNzaW9ucztcbiAgICB9O1xufTtcblxuZnVuY3Rpb24gaW5jb21wYXRpYmxlTm9kZUd1YXJkKCkge1xuICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuO1xuICAgIGxldCBtYWpvcjtcbiAgICBsZXQgbWlub3I7XG4gICAgY29uc3QgbWF5YmVOb2RlVmVyc2lvbiA9IHByb2Nlc3MudmVyc2lvbnM/Lm5vZGU/LnNwbGl0KFwiLlwiKTtcbiAgICBpZiAobWF5YmVOb2RlVmVyc2lvbikge1xuICAgICAgICBbbWFqb3IsIG1pbm9yXSA9IG1heWJlTm9kZVZlcnNpb24ubWFwKCh2KT0+cGFyc2VJbnQodiwgMTApKTtcbiAgICB9XG4gICAgY29uc3QgbWF5YmVOb2RlUGF0aCA9IHByb2Nlc3MuZW52Py5OT0RFO1xuICAgIGlmICghbWFqb3IgJiYgbWF5YmVOb2RlUGF0aCkge1xuICAgICAgICBjb25zdCBub2RlVmVyc2lvbiA9IC92KFxcZCspXFwuKFxcZCspXFwuKFxcZCspLy5leGVjKG1heWJlTm9kZVBhdGgpPy5bMF07XG4gICAgICAgIGlmIChub2RlVmVyc2lvbikge1xuICAgICAgICAgICAgW21ham9yLCBtaW5vcl0gPSBub2RlVmVyc2lvbi5zdWJzdHJpbmcoMSkuc3BsaXQoXCIuXCIpLm1hcCgodik9PnBhcnNlSW50KHYsIDEwKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFtYWpvciB8fCAhbWlub3IpIHJldHVybjtcbiAgICAvLyBSZXF1aXJlIF4xOC4xMy4wXG4gICAgaWYgKG1ham9yID4gMTgpIHJldHVybjtcbiAgICBpZiAobWFqb3IgPT09IDE4ICYmIG1pbm9yID49IDEzKSByZXR1cm47XG4gICAgRWZmZWN0LnJ1blN5bmMoRWZmZWN0LmxvZ0Vycm9yKGBZT1UgQVJFIFVTSU5HIEEgTEVHQUNZICgke21ham9yfS4ke21pbm9yfSkgTk9ERSBWRVJTSU9OIFdISUNIIElTTidUIE9GRklDSUFMTFkgU1VQUE9SVEVELiBQTEVBU0UgVVBHUkFERSBUTyBOT0RFIF4xOC4xMy5gKSk7XG4gICAgLy8gS2lsbCB0aGUgcHJvY2VzcyBpZiBpdCBpc24ndCBnb2luZyB0byB3b3JrIGNvcnJlY3RseSBhbnl3YXlcbiAgICAvLyBJZiB3ZSd2ZSBnb3R0ZW4gdGhpcyBmYXIgd2Uga25vdyB3ZSBoYXZlIGEgTm9kZS5qcyBydW50aW1lIHNvIGV4aXQgaXMgZGVmaW5lZC4gT3ZlcnJpZGUgc3RkLWVudiB0eXBlLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLW1lbWJlci1hY2Nlc3MsIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtY2FsbFxuICAgIHByb2Nlc3MuZXhpdD8uKDEpO1xufVxuXG5mdW5jdGlvbiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoaW5pdERlZiA9IHt9KSB7XG4gICAgY29uc3QgX2RlZiA9IHtcbiAgICAgICAgLy8gRGVmYXVsdCByb3V0ZXIgY29uZmlnXG4gICAgICAgIHJvdXRlckNvbmZpZzoge1xuICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICBtYXhGaWxlU2l6ZTogXCI0TUJcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnB1dFBhcnNlcjoge1xuICAgICAgICAgICAgcGFyc2U6ICgpPT51bmRlZmluZWQsXG4gICAgICAgICAgICBfaW5wdXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIF9vdXRwdXQ6IHVuZGVmaW5lZFxuICAgICAgICB9LFxuICAgICAgICBtaWRkbGV3YXJlOiAoKT0+KHt9KSxcbiAgICAgICAgb25VcGxvYWRFcnJvcjogKCk9Pih7fSksXG4gICAgICAgIGVycm9yRm9ybWF0dGVyOiBpbml0RGVmLmVycm9yRm9ybWF0dGVyID8/IGRlZmF1bHRFcnJvckZvcm1hdHRlcixcbiAgICAgICAgLy8gT3ZlcmxvYWQgd2l0aCBwcm9wZXJ0aWVzIHBhc3NlZCBpblxuICAgICAgICAuLi5pbml0RGVmXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbnB1dCAodXNlclBhcnNlcikge1xuICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICAgICAgLi4uX2RlZixcbiAgICAgICAgICAgICAgICBpbnB1dFBhcnNlcjogdXNlclBhcnNlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG1pZGRsZXdhcmUgKHVzZXJNaWRkbGV3YXJlKSB7XG4gICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICAuLi5fZGVmLFxuICAgICAgICAgICAgICAgIG1pZGRsZXdhcmU6IHVzZXJNaWRkbGV3YXJlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRDb21wbGV0ZSAodXNlclVwbG9hZENvbXBsZXRlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIF9kZWYsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZXI6IHVzZXJVcGxvYWRDb21wbGV0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRFcnJvciAodXNlck9uVXBsb2FkRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgb25VcGxvYWRFcnJvcjogdXNlck9uVXBsb2FkRXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUJ1aWxkZXIob3B0cykge1xuICAgIHJldHVybiAoaW5wdXQpPT57XG4gICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgcm91dGVyQ29uZmlnOiBpbnB1dCxcbiAgICAgICAgICAgIC4uLm9wdHNcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cblxuLyoqXG4gKiBFeHRlbnNpb24gb2YgdGhlIEJsb2IgY2xhc3MgdGhhdCBzaW1wbGlmaWVzIHNldHRpbmcgdGhlIGBuYW1lYCBhbmQgYGN1c3RvbUlkYCBwcm9wZXJ0aWVzLFxuICogc2ltaWxhciB0byB0aGUgYnVpbHQtaW4gRmlsZSBjbGFzcyBmcm9tIE5vZGUgPiAyMC5cbiAqLyBjbGFzcyBVVEZpbGUgZXh0ZW5kcyBCbG9iIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJ0cywgbmFtZSwgb3B0aW9ucyl7XG4gICAgICAgIGNvbnN0IG9wdGlvbnNXaXRoRGVmYXVsdHMgPSB7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgdHlwZTogb3B0aW9ucz8udHlwZSA/PyAobG9va3VwKG5hbWUpIHx8IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIpLFxuICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBvcHRpb25zPy5sYXN0TW9kaWZpZWQgPz8gRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICBzdXBlcihwYXJ0cywgb3B0aW9uc1dpdGhEZWZhdWx0cyk7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuY3VzdG9tSWQgPSBvcHRpb25zV2l0aERlZmF1bHRzLmN1c3RvbUlkO1xuICAgICAgICB0aGlzLmxhc3RNb2RpZmllZCA9IG9wdGlvbnNXaXRoRGVmYXVsdHMubGFzdE1vZGlmaWVkO1xuICAgIH1cbn1cblxuY29uc3QgdXBsb2FkUHJlc2lnbmVkUG9zdCA9IChmaWxlLCBwcmVzaWduZWQpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhgVXBsb2FkaW5nIGZpbGUgJHtmaWxlLm5hbWV9IHVzaW5nIHByZXNpZ25lZCBQT1NUIFVSTGApO1xuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBPYmplY3QuZW50cmllcyhwcmVzaWduZWQuZmllbGRzKS5mb3JFYWNoKChbaywgdl0pPT5mb3JtRGF0YS5hcHBlbmQoaywgdikpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGZpbGUpOyAvLyBGaWxlIGRhdGEgKipNVVNUIEdPIExBU1QqKlxuICAgICAgICBjb25zdCByZXMgPSB5aWVsZCogZmV0Y2hFZmYocHJlc2lnbmVkLnVybCwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoe1xuICAgICAgICAgICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi94bWxcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSkucGlwZShFZmZlY3QudGFwRXJyb3JDYXVzZSgoKT0+ZmV0Y2hFZmYoZ2VuZXJhdGVVcGxvYWRUaGluZ1VSTChcIi92Ni9mYWlsdXJlQ2FsbGJhY2tcIiksIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUtleTogcHJlc2lnbmVkLmtleSxcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkSWQ6IG51bGxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkucGlwZShFZmZlY3QuYW5kVGhlbihwYXJzZVJlc3BvbnNlSnNvbiksIEVmZmVjdC5hbmRUaGVuKFMuZGVjb2RlVW5rbm93bihGYWlsdXJlQ2FsbGJhY2tSZXNwb25zZSkpKSkpO1xuICAgICAgICBpZiAoIXJlcy5vaykge1xuICAgICAgICAgICAgY29uc3QgdGV4dCA9IHlpZWxkKiBFZmZlY3QucHJvbWlzZShyZXMudGV4dCk7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKGBGYWlsZWQgdG8gdXBsb2FkIGZpbGUgJHtmaWxlLm5hbWV9IHRvIHByZXNpZ25lZCBQT1NUIFVSTC4gUmVzcG9uc2U6ICR7dGV4dH1gKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiVVBMT0FEX0ZBSUxFRFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHVwbG9hZCBmaWxlXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IHRleHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJGaWxlXCIsIGZpbGUubmFtZSwgXCJ1cGxvYWRlZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgfSk7XG5cbmZ1bmN0aW9uIGd1YXJkU2VydmVyT25seSgpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICB0aHJvdyBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJUaGUgYHV0YXBpYCBjYW4gb25seSBiZSB1c2VkIG9uIHRoZSBzZXJ2ZXIuXCJcbiAgICAgICAgfSk7XG4gICAgfVxufVxuY29uc3QgdXBsb2FkRmlsZXNJbnRlcm5hbCA9IChpbnB1dCk9PmdldFByZXNpZ25lZFVybHMoaW5wdXQpLnBpcGUoRWZmZWN0LmFuZFRoZW4oKHByZXNpZ25lZHMpPT5FZmZlY3QuZm9yRWFjaChwcmVzaWduZWRzLCAoZmlsZSk9PnVwbG9hZEZpbGUoZmlsZSkucGlwZShFZmZlY3QudGFwRXJyb3IoKGVycm9yKT0+RWZmZWN0LmxvZ0Vycm9yKFwiVXBsb2FkIGZhaWxlZDpcIiwgZXJyb3IpKSwgRWZmZWN0Lm1hdGNoKHtcbiAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IChlcnJvcik9Pih7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IFVwbG9hZFRoaW5nRXJyb3IudG9PYmplY3QoZXJyb3IgaW5zdGFuY2VvZiBVcGxvYWRUaGluZ0Vycm9yID8gZXJyb3IgOiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gdXBsb2FkIGZpbGUuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG9uU3VjY2VzczogKGRhdGEpPT4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KSksIHtcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiAxMFxuICAgICAgICB9KSkpO1xuLyoqXG4gKiBGSVhNRTogZG93bmxvYWRpbmcgZXZlcnl0aGluZyBpbnRvIG1lbW9yeSBhbmQgdGhlbiB1cGxvYWRcbiAqIGlzbid0IHRoZSBiZXN0LiBXZSBzaG91bGQgc3VwcG9ydCBzdHJlYW1zIHNvIHdlIGNhbiBkb3dubG9hZFxuICoganVzdCBhcyBtdWNoIGFzIHdlIG5lZWQgYXQgYW55IHRpbWUuXG4gKi8gY29uc3QgZG93bmxvYWRGaWxlcyA9ICh1cmxzLCBkb3dubG9hZEVycm9ycyk9PkVmZmVjdC5mb3JFYWNoKHVybHMsIChfdXJsLCBpZHgpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgIGxldCB1cmwgPSBpc09iamVjdChfdXJsKSA/IF91cmwudXJsIDogX3VybDtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdXJsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgLy8gc2luY2UgZGF0YXVybHMgd2lsbCByZXN1bHQgaW4gbmFtZSBiZWluZyB0b28gbG9uZywgdGVsbCB0aGUgdXNlclxuICAgICAgICAgICAgICAgIC8vIHRvIHVzZSB1cGxvYWRGaWxlcyBpbnN0ZWFkLlxuICAgICAgICAgICAgICAgIGlmICh1cmwuc3RhcnRzV2l0aChcImRhdGE6XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvd25sb2FkRXJyb3JzW2lkeF0gPSBVcGxvYWRUaGluZ0Vycm9yLnRvT2JqZWN0KG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiUGxlYXNlIHVzZSB1cGxvYWRGaWxlcygpIGZvciBkYXRhIFVSTHMuIHVwbG9hZEZpbGVzRnJvbVVybCgpIGlzIGludGVuZGVkIGZvciB1c2Ugd2l0aCByZW1vdGUgVVJMcyBvbmx5LlwiXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXJsID0gbmV3IFVSTCh1cmwpO1xuICAgICAgICAgICAgY29uc3QgeyBuYW1lID0gdXJsLnBhdGhuYW1lLnNwbGl0KFwiL1wiKS5wb3AoKSA/PyBcInVua25vd24tZmlsZW5hbWVcIiwgY3VzdG9tSWQgPSB1bmRlZmluZWQgfSA9IGlzT2JqZWN0KF91cmwpID8gX3VybCA6IHt9O1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCogZmV0Y2hFZmYodXJsKTtcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICBkb3dubG9hZEVycm9yc1tpZHhdID0gVXBsb2FkVGhpbmdFcnJvci50b09iamVjdChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gZG93bmxvYWQgcmVxdWVzdGVkIGZpbGUuXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiByZXNwb25zZVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBFZmZlY3QucHJvbWlzZSgoKT0+cmVzcG9uc2UuYmxvYigpKS5waXBlKEVmZmVjdC5hbmRUaGVuKChibG9iKT0+bmV3IFVURmlsZShbXG4gICAgICAgICAgICAgICAgICAgIGJsb2JcbiAgICAgICAgICAgICAgICBdLCBuYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUlkXG4gICAgICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfSksIHtcbiAgICAgICAgY29uY3VycmVuY3k6IDEwXG4gICAgfSk7XG5jb25zdCBnZXRQcmVzaWduZWRVcmxzID0gKGlucHV0KT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IHsgZmlsZXMsIG1ldGFkYXRhLCBjb250ZW50RGlzcG9zaXRpb24sIGFjbCB9ID0gaW5wdXQ7XG4gICAgICAgIGNvbnN0IGZpbGVEYXRhID0gZmlsZXMubWFwKChmaWxlKT0+KHtcbiAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUgPz8gXCJ1bm5hbWVkLWJsb2JcIixcbiAgICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgIC4uLlwiY3VzdG9tSWRcIiBpbiBmaWxlID8ge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21JZDogZmlsZS5jdXN0b21JZFxuICAgICAgICAgICAgICAgIH0gOiB7fVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiR2V0dGluZyBwcmVzaWduZWQgVVJMcyBmb3IgZmlsZXNcIiwgZmlsZURhdGEpO1xuICAgICAgICBjb25zdCByZXNwb25zZVNjaGVtYSA9IFMuU3RydWN0KHtcbiAgICAgICAgICAgIGRhdGE6IFByZXNpZ25lZFVSTFJlc3BvbnNlXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBwcmVzaWduZWRzID0geWllbGQqIGZldGNoRWZmKGdlbmVyYXRlVXBsb2FkVGhpbmdVUkwoXCIvdjYvdXBsb2FkRmlsZXNcIiksIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBjYWNoZTogXCJuby1zdG9yZVwiLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIGZpbGVzOiBmaWxlRGF0YSxcbiAgICAgICAgICAgICAgICBtZXRhZGF0YSxcbiAgICAgICAgICAgICAgICBjb250ZW50RGlzcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgYWNsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5waXBlKEVmZmVjdC5hbmRUaGVuKHBhcnNlUmVzcG9uc2VKc29uKSwgRWZmZWN0LmFuZFRoZW4oUy5kZWNvZGVVbmtub3duKHJlc3BvbnNlU2NoZW1hKSksIEVmZmVjdC5jYXRjaFRhZyhcIlBhcnNlRXJyb3JcIiwgKGUpPT5FZmZlY3QuZGllKGUpKSwgRWZmZWN0LmNhdGNoVGFnKFwiRmV0Y2hFcnJvclwiLCAoZSk9PkVmZmVjdC5kaWUoZSkpKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkdvdCBwcmVzaWduZWQgVVJMczpcIiwgcHJlc2lnbmVkcy5kYXRhKTtcbiAgICAgICAgcmV0dXJuIGZpbGVzLm1hcCgoZmlsZSwgaSk9Pih7XG4gICAgICAgICAgICAgICAgZmlsZSxcbiAgICAgICAgICAgICAgICBwcmVzaWduZWQ6IHByZXNpZ25lZHMuZGF0YVtpXVxuICAgICAgICAgICAgfSkpO1xuICAgIH0pO1xuY29uc3QgdXBsb2FkRmlsZSA9IChpbnB1dCk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCB7IGZpbGUsIHByZXNpZ25lZCB9ID0gaW5wdXQ7XG4gICAgICAgIGlmIChcInVybHNcIiBpbiBwcmVzaWduZWQpIHtcbiAgICAgICAgICAgIHlpZWxkKiB1cGxvYWRNdWx0aXBhcnQoZmlsZSwgcHJlc2lnbmVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHlpZWxkKiB1cGxvYWRQcmVzaWduZWRQb3N0KGZpbGUsIHByZXNpZ25lZCk7XG4gICAgICAgIH1cbiAgICAgICAgeWllbGQqIGZldGNoRWZmKGdlbmVyYXRlVXBsb2FkVGhpbmdVUkwoYC92Ni9wb2xsVXBsb2FkLyR7cHJlc2lnbmVkLmtleX1gKSkucGlwZShFZmZlY3QuYW5kVGhlbihwYXJzZVJlc3BvbnNlSnNvbiksIEVmZmVjdC5hbmRUaGVuKFMuZGVjb2RlVW5rbm93bihQb2xsVXBsb2FkUmVzcG9uc2UpKSwgRWZmZWN0LnRhcChFZmZlY3QubG9nRGVidWcoXCJQb2xsZWQgdXBsb2FkXCIsIHByZXNpZ25lZC5rZXkpKSwgRWZmZWN0LmFuZFRoZW4oKHJlcyk9PnJlcy5zdGF0dXMgPT09IFwiZG9uZVwiID8gRWZmZWN0LnN1Y2NlZWQodW5kZWZpbmVkKSA6IEVmZmVjdC5mYWlsKG5ldyBSZXRyeUVycm9yKCkpKSwgRWZmZWN0LnJldHJ5KHtcbiAgICAgICAgICAgIHdoaWxlOiAoZXJyKT0+ZXJyIGluc3RhbmNlb2YgUmV0cnlFcnJvcixcbiAgICAgICAgICAgIHNjaGVkdWxlOiBTY2hlZHVsZS5leHBvbmVudGlhbChEdXJhdGlvbi5taWxsaXMoMTApLCA0KS5waXBlKC8vIDEwbXMsIDQwbXMsIDE2MG1zLCA2NDBtcy4uLlxuICAgICAgICAgICAgU2NoZWR1bGUuYW5kVGhlbkVpdGhlcihTY2hlZHVsZS5zcGFjZWQoRHVyYXRpb24uc2Vjb25kcygxKSkpLCBTY2hlZHVsZS5jb21wb3NlKFNjaGVkdWxlLmVsYXBzZWQpLCBTY2hlZHVsZS53aGlsZU91dHB1dChEdXJhdGlvbi5sZXNzVGhhbk9yRXF1YWxUbyhEdXJhdGlvbi5taW51dGVzKDEpKSkpXG4gICAgICAgIH0pLCBFZmZlY3QuY2F0Y2hUYWcoXCJSZXRyeUVycm9yXCIsIChlKT0+RWZmZWN0LmRpZShlKSkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgdXJsOiBwcmVzaWduZWQuZmlsZVVybCxcbiAgICAgICAgICAgIGFwcFVybDogcHJlc2lnbmVkLmFwcFVybCxcbiAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgICAgIGN1c3RvbUlkOiBcImN1c3RvbUlkXCIgaW4gZmlsZSA/IGZpbGUuY3VzdG9tSWQgPz8gbnVsbCA6IG51bGxcbiAgICAgICAgfTtcbiAgICB9KTtcbmZ1bmN0aW9uIHBhcnNlVGltZVRvU2Vjb25kcyh0aW1lKSB7XG4gICAgY29uc3QgbWF0Y2ggPSB0aW1lLnRvU3RyaW5nKCkuc3BsaXQoLyhcXGQrKS8pLmZpbHRlcihCb29sZWFuKTtcbiAgICBjb25zdCBudW0gPSBOdW1iZXIobWF0Y2hbMF0pO1xuICAgIGNvbnN0IHVuaXQgPSAobWF0Y2hbMV0gPz8gXCJzXCIpLnRyaW0oKS5zbGljZSgwLCAxKTtcbiAgICBjb25zdCBtdWx0aXBsaWVyID0ge1xuICAgICAgICBzOiAxLFxuICAgICAgICBtOiA2MCxcbiAgICAgICAgaDogMzYwMCxcbiAgICAgICAgZDogODY0MDBcbiAgICB9W3VuaXRdO1xuICAgIHJldHVybiBudW0gKiBtdWx0aXBsaWVyO1xufVxuXG5jbGFzcyBVVEFwaSB7XG4gICAgY29uc3RydWN0b3Iob3B0cyl7XG4gICAgICAgIHRoaXMucmVxdWVzdFVwbG9hZFRoaW5nID0gKHBhdGhuYW1lLCBib2R5LCByZXNwb25zZVNjaGVtYSk9PntcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGdlbmVyYXRlVXBsb2FkVGhpbmdVUkwocGF0aG5hbWUpO1xuICAgICAgICAgICAgRWZmZWN0LnJ1blN5bmMoRWZmZWN0LmxvZ0RlYnVnKFwiUmVxdWVzdGluZyBVcGxvYWRUaGluZzpcIiwge1xuICAgICAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgICAgICBib2R5LFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuZGVmYXVsdEhlYWRlcnNcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycyhbXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiLFxuICAgICAgICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5kZWZhdWx0SGVhZGVycykpe1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIGhlYWRlcnMuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZldGNoRWZmKHVybCwge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgY2FjaGU6IFwibm8tc3RvcmVcIixcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICB9KS5waXBlKEVmZmVjdC5hbmRUaGVuKHBhcnNlUmVzcG9uc2VKc29uKSwgRWZmZWN0LmFuZFRoZW4oUy5kZWNvZGVVbmtub3duKHJlc3BvbnNlU2NoZW1hKSksIEVmZmVjdC5jYXRjaFRhZyhcIkZldGNoRXJyb3JcIiwgKGVycik9PkVmZmVjdC5sb2dFcnJvcihcIlJlcXVlc3QgZmFpbGVkOlwiLCBlcnIpLnBpcGUoRWZmZWN0LmFuZFRoZW4oKCk9PkVmZmVjdC5kaWUoZXJyKSkpKSwgRWZmZWN0LmNhdGNoVGFnKFwiUGFyc2VFcnJvclwiLCAoZXJyKT0+RWZmZWN0LmxvZ0Vycm9yKFwiUmVzcG9uc2UgcGFyc2luZyBmYWlsZWQ6XCIsIGVycikucGlwZShFZmZlY3QuYW5kVGhlbigoKT0+RWZmZWN0LmRpZShlcnIpKSkpLCBFZmZlY3QudGFwKChyZXMpPT5FZmZlY3QubG9nRGVidWcoXCJVcGxvYWRUaGluZyByZXNwb25zZTpcIiwgcmVzKSkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmV4ZWN1dGVBc3luYyA9IChwcm9ncmFtLCBzaWduYWwpPT5wcm9ncmFtLnBpcGUod2l0aE1pbmltYWxMb2dMZXZlbCh0aGlzLmxvZ0xldmVsKSwgRWZmZWN0LnByb3ZpZGUoQ29uc29sYUxvZ2dlciksIEVmZmVjdC5wcm92aWRlU2VydmljZShGZXRjaENvbnRleHQsIHtcbiAgICAgICAgICAgICAgICBmZXRjaDogdGhpcy5mZXRjaCxcbiAgICAgICAgICAgICAgICBiYXNlSGVhZGVyczogdGhpcy5kZWZhdWx0SGVhZGVyc1xuICAgICAgICAgICAgfSksIChlKT0+RWZmZWN0LnJ1blByb21pc2UoZSwgc2lnbmFsID8ge1xuICAgICAgICAgICAgICAgICAgICBzaWduYWxcbiAgICAgICAgICAgICAgICB9IDogdW5kZWZpbmVkKSk7XG4gICAgICAgIC8qKlxuICAgKiBSZXF1ZXN0IHRvIGRlbGV0ZSBmaWxlcyBmcm9tIFVwbG9hZFRoaW5nIHN0b3JhZ2UuXG4gICAqIEBwYXJhbSB7c3RyaW5nIHwgc3RyaW5nW119IGZpbGVLZXlzXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGF3YWl0IGRlbGV0ZUZpbGVzKFwiMmUwZmRiNjQtOTk1Ny00MjYyLThlNDUtZjM3MmJhOTAzYWM4X2ltYWdlLmpwZ1wiKTtcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYXdhaXQgZGVsZXRlRmlsZXMoW1wiMmUwZmRiNjQtOTk1Ny00MjYyLThlNDUtZjM3MmJhOTAzYWM4X2ltYWdlLmpwZ1wiLFwiMTY0OTM1M2ItMDRlYS00OGEyLTlkYjctMzFkZTdmNTYyYzhkX2ltYWdlMi5qcGdcIl0pXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGF3YWl0IGRlbGV0ZUZpbGVzKFwibXlDdXN0b21JZGVudGlmaWVyXCIsIHsga2V5VHlwZTogXCJjdXN0b21JZFwiIH0pXG4gICAqLyB0aGlzLmRlbGV0ZUZpbGVzID0gYXN5bmMgKGtleXMsIG9wdHMpPT57XG4gICAgICAgICAgICBndWFyZFNlcnZlck9ubHkoKTtcbiAgICAgICAgICAgIGNvbnN0IHsga2V5VHlwZSA9IHRoaXMuZGVmYXVsdEtleVR5cGUgfSA9IG9wdHMgPz8ge307XG4gICAgICAgICAgICBjbGFzcyBEZWxldGVGaWxlUmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiRGVsZXRlRmlsZVJlc3BvbnNlXCIpKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBTLkJvb2xlYW4sXG4gICAgICAgICAgICAgICAgZGVsZXRlZENvdW50OiBTLk51bWJlclxuICAgICAgICAgICAgfSkge1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUFzeW5jKHRoaXMucmVxdWVzdFVwbG9hZFRoaW5nKFwiL3Y2L2RlbGV0ZUZpbGVzXCIsIGtleVR5cGUgPT09IFwiZmlsZUtleVwiID8ge1xuICAgICAgICAgICAgICAgIGZpbGVLZXlzOiBhc0FycmF5KGtleXMpXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIGN1c3RvbUlkczogYXNBcnJheShrZXlzKVxuICAgICAgICAgICAgfSwgRGVsZXRlRmlsZVJlc3BvbnNlKSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgKiBSZXF1ZXN0IGZpbGUgVVJMcyBmcm9tIFVwbG9hZFRoaW5nIHN0b3JhZ2UuXG4gICAqIEBwYXJhbSB7c3RyaW5nIHwgc3RyaW5nW119IGZpbGVLZXlzXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGNvbnN0IGRhdGEgPSBhd2FpdCBnZXRGaWxlVXJscyhcIjJlMGZkYjY0LTk5NTctNDI2Mi04ZTQ1LWYzNzJiYTkwM2FjOF9pbWFnZS5qcGdcIik7XG4gICAqIGNvbnNvbGUubG9nKGRhdGEpOyAvLyBbe2tleTogXCIyZTBmZGI2NC05OTU3LTQyNjItOGU0NS1mMzcyYmE5MDNhYzhfaW1hZ2UuanBnXCIsIHVybDogXCJodHRwczovL3VwbG9hZHRoaW5nLmNvbS9mLzJlMGZkYjY0LTk5NTctNDI2Mi04ZTQ1LWYzNzJiYTkwM2FjOF9pbWFnZS5qcGdcIn1dXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGNvbnN0IGRhdGEgPSBhd2FpdCBnZXRGaWxlVXJscyhbXCIyZTBmZGI2NC05OTU3LTQyNjItOGU0NS1mMzcyYmE5MDNhYzhfaW1hZ2UuanBnXCIsXCIxNjQ5MzUzYi0wNGVhLTQ4YTItOWRiNy0zMWRlN2Y1NjJjOGRfaW1hZ2UyLmpwZ1wiXSlcbiAgICogY29uc29sZS5sb2coZGF0YSkgLy8gW3trZXk6IFwiMmUwZmRiNjQtOTk1Ny00MjYyLThlNDUtZjM3MmJhOTAzYWM4X2ltYWdlLmpwZ1wiLCB1cmw6IFwiaHR0cHM6Ly91cGxvYWR0aGluZy5jb20vZi8yZTBmZGI2NC05OTU3LTQyNjItOGU0NS1mMzcyYmE5MDNhYzhfaW1hZ2UuanBnXCIgfSx7a2V5OiBcIjE2NDkzNTNiLTA0ZWEtNDhhMi05ZGI3LTMxZGU3ZjU2MmM4ZF9pbWFnZTIuanBnXCIsIHVybDogXCJodHRwczovL3VwbG9hZHRoaW5nLmNvbS9mLzE2NDkzNTNiLTA0ZWEtNDhhMi05ZGI3LTMxZGU3ZjU2MmM4ZF9pbWFnZTIuanBnXCJ9XVxuICAgKi8gdGhpcy5nZXRGaWxlVXJscyA9IGFzeW5jIChrZXlzLCBvcHRzKT0+e1xuICAgICAgICAgICAgZ3VhcmRTZXJ2ZXJPbmx5KCk7XG4gICAgICAgICAgICBjb25zdCB7IGtleVR5cGUgPSB0aGlzLmRlZmF1bHRLZXlUeXBlIH0gPSBvcHRzID8/IHt9O1xuICAgICAgICAgICAgY2xhc3MgR2V0RmlsZVVybFJlc3BvbnNlIGV4dGVuZHMgUy5DbGFzcyhcIkdldEZpbGVVcmxSZXNwb25zZVwiKSh7XG4gICAgICAgICAgICAgICAgZGF0YTogUy5BcnJheShTLlN0cnVjdCh7XG4gICAgICAgICAgICAgICAgICAgIGtleTogUy5TdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogUy5TdHJpbmdcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIH0pIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBc3luYyh0aGlzLnJlcXVlc3RVcGxvYWRUaGluZyhcIi92Ni9nZXRGaWxlVXJsXCIsIGtleVR5cGUgPT09IFwiZmlsZUtleVwiID8ge1xuICAgICAgICAgICAgICAgIGZpbGVLZXlzOiBrZXlzXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIGN1c3RvbUlkczoga2V5c1xuICAgICAgICAgICAgfSwgR2V0RmlsZVVybFJlc3BvbnNlKSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgKiBSZXF1ZXN0IGZpbGUgbGlzdCBmcm9tIFVwbG9hZFRoaW5nIHN0b3JhZ2UuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBvcHRzLmxpbWl0IFRoZSBtYXhpbXVtIG51bWJlciBvZiBmaWxlcyB0byByZXR1cm5cbiAgICogQHBhcmFtIHtudW1iZXJ9IG9wdHMub2Zmc2V0IFRoZSBudW1iZXIgb2YgZmlsZXMgdG8gc2tpcFxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBjb25zdCBkYXRhID0gYXdhaXQgbGlzdEZpbGVzKHsgbGltaXQ6IDEgfSk7XG4gICAqIGNvbnNvbGUubG9nKGRhdGEpOyAvLyB7IGtleTogXCIyZTBmZGI2NC05OTU3LTQyNjItOGU0NS1mMzcyYmE5MDNhYzhfaW1hZ2UuanBnXCIsIGlkOiBcIjJlMGZkYjY0LTk5NTctNDI2Mi04ZTQ1LWYzNzJiYTkwM2FjOFwiIH1cbiAgICovIHRoaXMubGlzdEZpbGVzID0gYXN5bmMgKG9wdHMpPT57XG4gICAgICAgICAgICBndWFyZFNlcnZlck9ubHkoKTtcbiAgICAgICAgICAgIGNsYXNzIExpc3RGaWxlUmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiTGlzdEZpbGVSZXNwb25zZVwiKSh7XG4gICAgICAgICAgICAgICAgaGFzTW9yZTogUy5Cb29sZWFuLFxuICAgICAgICAgICAgICAgIGZpbGVzOiBTLkFycmF5KFMuU3RydWN0KHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFMuU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IFMuU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBTLlN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBTLkxpdGVyYWwoXCJEZWxldGlvbiBQZW5kaW5nXCIsIFwiRmFpbGVkXCIsIFwiVXBsb2FkZWRcIiwgXCJVcGxvYWRpbmdcIilcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIH0pIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBc3luYyh0aGlzLnJlcXVlc3RVcGxvYWRUaGluZyhcIi92Ni9saXN0RmlsZXNcIiwge1xuICAgICAgICAgICAgICAgIC4uLm9wdHNcbiAgICAgICAgICAgIH0sIExpc3RGaWxlUmVzcG9uc2UpKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZW5hbWVGaWxlcyA9IGFzeW5jICh1cGRhdGVzKT0+e1xuICAgICAgICAgICAgZ3VhcmRTZXJ2ZXJPbmx5KCk7XG4gICAgICAgICAgICBjbGFzcyBSZW5hbWVGaWxlUmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiUmVuYW1lRmlsZVJlc3BvbnNlXCIpKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBTLkJvb2xlYW5cbiAgICAgICAgICAgIH0pIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBc3luYyh0aGlzLnJlcXVlc3RVcGxvYWRUaGluZyhcIi92Ni9yZW5hbWVGaWxlc1wiLCB7XG4gICAgICAgICAgICAgICAgdXBkYXRlczogYXNBcnJheSh1cGRhdGVzKVxuICAgICAgICAgICAgfSwgUmVuYW1lRmlsZVJlc3BvbnNlKSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKiBAZGVwcmVjYXRlZCBVc2Uge0BsaW5rIHJlbmFtZUZpbGVzfSBpbnN0ZWFkLiAqLyB0aGlzLnJlbmFtZUZpbGUgPSB0aGlzLnJlbmFtZUZpbGVzO1xuICAgICAgICB0aGlzLmdldFVzYWdlSW5mbyA9IGFzeW5jICgpPT57XG4gICAgICAgICAgICBndWFyZFNlcnZlck9ubHkoKTtcbiAgICAgICAgICAgIGNsYXNzIEdldFVzYWdlSW5mb1Jlc3BvbnNlIGV4dGVuZHMgUy5DbGFzcyhcIkdldFVzYWdlSW5mb1Jlc3BvbnNlXCIpKHtcbiAgICAgICAgICAgICAgICB0b3RhbEJ5dGVzOiBTLk51bWJlcixcbiAgICAgICAgICAgICAgICBhcHBUb3RhbEJ5dGVzOiBTLk51bWJlcixcbiAgICAgICAgICAgICAgICBmaWxlc1VwbG9hZGVkOiBTLk51bWJlcixcbiAgICAgICAgICAgICAgICBsaW1pdEJ5dGVzOiBTLk51bWJlclxuICAgICAgICAgICAgfSkge1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUFzeW5jKHRoaXMucmVxdWVzdFVwbG9hZFRoaW5nKFwiL3Y2L2dldFVzYWdlSW5mb1wiLCB7fSwgR2V0VXNhZ2VJbmZvUmVzcG9uc2UpKTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqIFJlcXVlc3QgYSBwcmVzaWduZWQgdXJsIGZvciBhIHByaXZhdGUgZmlsZShzKSAqLyB0aGlzLmdldFNpZ25lZFVSTCA9IGFzeW5jIChrZXksIG9wdHMpPT57XG4gICAgICAgICAgICBndWFyZFNlcnZlck9ubHkoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cGlyZXNJbiA9IG9wdHM/LmV4cGlyZXNJbiA/IHBhcnNlVGltZVRvU2Vjb25kcyhvcHRzLmV4cGlyZXNJbikgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICBjb25zdCB7IGtleVR5cGUgPSB0aGlzLmRlZmF1bHRLZXlUeXBlIH0gPSBvcHRzID8/IHt9O1xuICAgICAgICAgICAgaWYgKG9wdHM/LmV4cGlyZXNJbiAmJiBpc05hTihleHBpcmVzSW4pKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiZXhwaXJlc0luIG11c3QgYmUgYSB2YWxpZCB0aW1lIHN0cmluZywgZm9yIGV4YW1wbGUgJzFkJywgJzIgZGF5cycsIG9yIGEgbnVtYmVyIG9mIHNlY29uZHMuXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChleHBpcmVzSW4gJiYgZXhwaXJlc0luID4gODY0MDAgKiA3KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiZXhwaXJlc0luIG11c3QgYmUgbGVzcyB0aGFuIDcgZGF5cyAoNjA0ODAwIHNlY29uZHMpLlwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGFzcyBHZXRTaWduZWRVcmxSZXNwb25zZSBleHRlbmRzIFMuQ2xhc3MoXCJHZXRTaWduZWRVcmxSZXNwb25zZVwiKSh7XG4gICAgICAgICAgICAgICAgdXJsOiBTLlN0cmluZ1xuICAgICAgICAgICAgfSkge1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUFzeW5jKHRoaXMucmVxdWVzdFVwbG9hZFRoaW5nKFwiL3Y2L3JlcXVlc3RGaWxlQWNjZXNzXCIsIGtleVR5cGUgPT09IFwiZmlsZUtleVwiID8ge1xuICAgICAgICAgICAgICAgIGZpbGVLZXk6IGtleSxcbiAgICAgICAgICAgICAgICBleHBpcmVzSW5cbiAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgY3VzdG9tSWQ6IGtleSxcbiAgICAgICAgICAgICAgICBleHBpcmVzSW5cbiAgICAgICAgICAgIH0sIEdldFNpZ25lZFVybFJlc3BvbnNlKSk7XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgKiBVcGRhdGUgdGhlIEFDTCBvZiBhIGZpbGUgb3Igc2V0IG9mIGZpbGVzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAvLyBNYWtlIGEgc2luZ2xlIGZpbGUgcHVibGljXG4gICAqIGF3YWl0IHV0YXBpLnVwZGF0ZUFDTChcIjJlMGZkYjY0LTk5NTctNDI2Mi04ZTQ1LWYzNzJiYTkwM2FjOF9pbWFnZS5qcGdcIiwgXCJwdWJsaWMtcmVhZFwiKTtcbiAgICpcbiAgICogLy8gTWFrZSBtdWx0aXBsZSBmaWxlcyBwcml2YXRlXG4gICAqIGF3YWl0IHV0YXBpLnVwZGF0ZUFDTChcbiAgICogICBbXG4gICAqICAgICBcIjJlMGZkYjY0LTk5NTctNDI2Mi04ZTQ1LWYzNzJiYTkwM2FjOF9pbWFnZS5qcGdcIixcbiAgICogICAgIFwiMTY0OTM1M2ItMDRlYS00OGEyLTlkYjctMzFkZTdmNTYyYzhkX2ltYWdlMi5qcGdcIixcbiAgICogICBdLFxuICAgKiAgIFwicHJpdmF0ZVwiLFxuICAgKiApO1xuICAgKi8gdGhpcy51cGRhdGVBQ0wgPSBhc3luYyAoa2V5cywgYWNsLCBvcHRzKT0+e1xuICAgICAgICAgICAgZ3VhcmRTZXJ2ZXJPbmx5KCk7XG4gICAgICAgICAgICBjb25zdCB7IGtleVR5cGUgPSB0aGlzLmRlZmF1bHRLZXlUeXBlIH0gPSBvcHRzID8/IHt9O1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlcyA9IGFzQXJyYXkoa2V5cykubWFwKChrZXkpPT57XG4gICAgICAgICAgICAgICAgcmV0dXJuIGtleVR5cGUgPT09IFwiZmlsZUtleVwiID8ge1xuICAgICAgICAgICAgICAgICAgICBmaWxlS2V5OiBrZXksXG4gICAgICAgICAgICAgICAgICAgIGFjbFxuICAgICAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUlkOiBrZXksXG4gICAgICAgICAgICAgICAgICAgIGFjbFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlU2NoZW1hID0gUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IFMuQm9vbGVhblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXN5bmModGhpcy5yZXF1ZXN0VXBsb2FkVGhpbmcoXCIvdjYvdXBkYXRlQUNMXCIsIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVzXG4gICAgICAgICAgICB9LCByZXNwb25zZVNjaGVtYSkpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBBc3NlcnQgc29tZSBzdHVmZlxuICAgICAgICBndWFyZFNlcnZlck9ubHkoKTtcbiAgICAgICAgaW5jb21wYXRpYmxlTm9kZUd1YXJkKCk7XG4gICAgICAgIGNvbnN0IGFwaUtleSA9IGdldEFwaUtleU9yVGhyb3cob3B0cz8uYXBpS2V5KTtcbiAgICAgICAgdGhpcy5mZXRjaCA9IG9wdHM/LmZldGNoID8/IGdsb2JhbFRoaXMuZmV0Y2g7XG4gICAgICAgIHRoaXMuZGVmYXVsdEhlYWRlcnMgPSB7XG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYXBpLWtleVwiOiBhcGlLZXksXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uLFxuICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWJlLWFkYXB0ZXJcIjogXCJzZXJ2ZXItc2RrXCIsXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctZmUtcGFja2FnZVwiOiB1bmRlZmluZWRcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5kZWZhdWx0S2V5VHlwZSA9IG9wdHM/LmRlZmF1bHRLZXlUeXBlID8/IFwiZmlsZUtleVwiO1xuICAgICAgICB0aGlzLmxvZ0xldmVsID0gb3B0cz8ubG9nTGV2ZWw7XG4gICAgfVxuICAgIGFzeW5jIHVwbG9hZEZpbGVzKGZpbGVzLCBvcHRzKSB7XG4gICAgICAgIGd1YXJkU2VydmVyT25seSgpO1xuICAgICAgICBjb25zdCB1cGxvYWRzID0gYXdhaXQgdGhpcy5leGVjdXRlQXN5bmMoRWZmZWN0LmZsYXRNYXAodXBsb2FkRmlsZXNJbnRlcm5hbCh7XG4gICAgICAgICAgICBmaWxlczogYXNBcnJheShmaWxlcyksXG4gICAgICAgICAgICBjb250ZW50RGlzcG9zaXRpb246IG9wdHM/LmNvbnRlbnREaXNwb3NpdGlvbiA/PyBcImlubGluZVwiLFxuICAgICAgICAgICAgbWV0YWRhdGE6IG9wdHM/Lm1ldGFkYXRhID8/IHt9LFxuICAgICAgICAgICAgYWNsOiBvcHRzPy5hY2xcbiAgICAgICAgfSksICh1cHMpPT5FZmZlY3Quc3VjY2VlZChBcnJheS5pc0FycmF5KGZpbGVzKSA/IHVwcyA6IHVwc1swXSkpLnBpcGUoRWZmZWN0LnRhcCgocmVzKT0+RWZmZWN0LmxvZ0RlYnVnKFwiRmluaXNoZWQgdXBsb2FkaW5nOlwiLCByZXMpKSksIG9wdHM/LnNpZ25hbCk7XG4gICAgICAgIHJldHVybiB1cGxvYWRzO1xuICAgIH1cbiAgICBhc3luYyB1cGxvYWRGaWxlc0Zyb21VcmwodXJscywgb3B0cykge1xuICAgICAgICBndWFyZFNlcnZlck9ubHkoKTtcbiAgICAgICAgY29uc3QgZG93bmxvYWRFcnJvcnMgPSB7fTtcbiAgICAgICAgY29uc3QgdXBsb2FkcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZUFzeW5jKGRvd25sb2FkRmlsZXMoYXNBcnJheSh1cmxzKSwgZG93bmxvYWRFcnJvcnMpLnBpcGUoRWZmZWN0LmFuZFRoZW4oKGZpbGVzKT0+ZmlsZXMuZmlsdGVyKChmKT0+ZiAhPSBudWxsKSksIEVmZmVjdC5hbmRUaGVuKChmaWxlcyk9PnVwbG9hZEZpbGVzSW50ZXJuYWwoe1xuICAgICAgICAgICAgICAgIGZpbGVzLFxuICAgICAgICAgICAgICAgIGNvbnRlbnREaXNwb3NpdGlvbjogb3B0cz8uY29udGVudERpc3Bvc2l0aW9uID8/IFwiaW5saW5lXCIsXG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IG9wdHM/Lm1ldGFkYXRhID8/IHt9LFxuICAgICAgICAgICAgICAgIGFjbDogb3B0cz8uYWNsXG4gICAgICAgICAgICB9KSkpLCBvcHRzPy5zaWduYWwpO1xuICAgICAgICAvKiogUHV0IGl0IGFsbCBiYWNrIHRvZ2V0aGVyLCBwcmVzZXJ2ZSB0aGUgb3JkZXIgb2YgZmlsZXMgKi8gY29uc3QgcmVzcG9uc2VzID0gYXNBcnJheSh1cmxzKS5tYXAoKF8sIGluZGV4KT0+e1xuICAgICAgICAgICAgaWYgKGRvd25sb2FkRXJyb3JzW2luZGV4XSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBkb3dubG9hZEVycm9yc1tpbmRleF1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVwbG9hZHMuc2hpZnQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8qKiBSZXR1cm4gc2luZ2xlIG9iamVjdCBvciBhcnJheSBiYXNlZCBvbiBpbnB1dCB1cmxzICovIGNvbnN0IHVwbG9hZEZpbGVSZXNwb25zZSA9IEFycmF5LmlzQXJyYXkodXJscykgPyByZXNwb25zZXMgOiByZXNwb25zZXNbMF07XG4gICAgICAgIEVmZmVjdC5ydW5TeW5jKEVmZmVjdC5sb2dEZWJ1ZyhcIkZpbmlzaGVkIHVwbG9hZGluZzpcIiwgdXBsb2FkRmlsZVJlc3BvbnNlKSk7XG4gICAgICAgIHJldHVybiB1cGxvYWRGaWxlUmVzcG9uc2U7XG4gICAgfVxufVxuXG5jb25zdCBjcmVhdGVVcGxvYWR0aGluZyA9IChvcHRzKT0+Y3JlYXRlQnVpbGRlcihvcHRzKTtcbi8qKiBAaW50ZXJuYWwgKi8gY29uc3QgSU5URVJOQUxfRE9fTk9UX1VTRV9jcmVhdGVSb3V0ZUhhbmRsZXJDb3JlID0gKG9wdHMsIGFkYXB0ZXIpPT57XG4gICAgaW5jb21wYXRpYmxlTm9kZUd1YXJkKCk7XG4gICAgY29uc3QgcmVxdWVzdEhhbmRsZXIgPSBidWlsZFJlcXVlc3RIYW5kbGVyKG9wdHMsIGFkYXB0ZXIpO1xuICAgIGNvbnN0IGdldEJ1aWxkUGVybXMgPSBidWlsZFBlcm1pc3Npb25zSW5mb0hhbmRsZXIob3B0cyk7XG4gICAgY29uc3QgUE9TVCA9IGFzeW5jIChyZXF1ZXN0KT0+e1xuICAgICAgICBjb25zdCByZXEgPSByZXF1ZXN0IGluc3RhbmNlb2YgUmVxdWVzdCA/IHJlcXVlc3QgOiByZXF1ZXN0LnJlcXVlc3Q7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcnVuUmVxdWVzdEhhbmRsZXJBc3luYyhyZXF1ZXN0SGFuZGxlciwge1xuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgbWlkZGxld2FyZUFyZ3M6IHtcbiAgICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgICAgZXZlbnQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByZXM6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBvcHRzLmNvbmZpZyk7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuIFJlc3BvbnNlLmpzb24oZm9ybWF0RXJyb3IocmVzcG9uc2UuZXJyb3IsIG9wdHMucm91dGVyKSwge1xuICAgICAgICAgICAgICAgIHN0YXR1czogZ2V0U3RhdHVzQ29kZUZyb21FcnJvcihyZXNwb25zZS5lcnJvciksXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzID0gUmVzcG9uc2UuanNvbihyZXNwb25zZS5ib2R5LCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogdmVyc2lvblxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIHRoaXMgaXMgYSBjdXN0b20gcHJvcGVydHlcbiAgICAgICAgcmVzLmNsZWFudXAgPSByZXNwb25zZS5jbGVhbnVwO1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH07XG4gICAgY29uc3QgR0VUID0gKHJlcXVlc3QpPT57XG4gICAgICAgIHJldHVybiBSZXNwb25zZS5qc29uKGdldEJ1aWxkUGVybXMoKSwge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IHZlcnNpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBHRVQsXG4gICAgICAgIFBPU1RcbiAgICB9O1xufTtcbmNvbnN0IGNyZWF0ZVJvdXRlSGFuZGxlciA9IChvcHRzKT0+SU5URVJOQUxfRE9fTk9UX1VTRV9jcmVhdGVSb3V0ZUhhbmRsZXJDb3JlKG9wdHMsIFwic2VydmVyXCIpO1xuY29uc3QgZXh0cmFjdFJvdXRlckNvbmZpZyA9IChyb3V0ZXIpPT5idWlsZFBlcm1pc3Npb25zSW5mb0hhbmRsZXIoe1xuICAgICAgICByb3V0ZXJcbiAgICB9KSgpO1xuLyoqXG4gKiBAZGVwcmVjYXRlZCBVc2Uge0BsaW5rIGNyZWF0ZVJvdXRlSGFuZGxlcn0gaW5zdGVhZFxuICovIGNvbnN0IGNyZWF0ZVNlcnZlckhhbmRsZXIgPSBjcmVhdGVSb3V0ZUhhbmRsZXI7XG5cbmV4cG9ydCB7IElOVEVSTkFMX0RPX05PVF9VU0VfY3JlYXRlUm91dGVIYW5kbGVyQ29yZSwgVVRBcGksIFVURmlsZSwgY3JlYXRlUm91dGVIYW5kbGVyLCBjcmVhdGVTZXJ2ZXJIYW5kbGVyLCBjcmVhdGVVcGxvYWR0aGluZywgZXh0cmFjdFJvdXRlckNvbmZpZyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/server/index.js\n");

/***/ })

};
;